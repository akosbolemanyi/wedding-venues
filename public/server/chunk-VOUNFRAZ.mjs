import './polyfills.server.mjs';
import{d as Dv,e as Nv,g as It,m as Ov,n as kv,o as xv,q as Mv,r as Pv,s as Lv,t as Fv,u as Bv,v as qv,w as Uv,x as Vv,y as zv}from"./chunk-FKSMKC2P.mjs";import{A as Rd,I as mv,N as Xo,O as Zo,S as el,Uc as Sv,c as fv,h as pv,ib as vv,m as ma,n as Ad,na as gv,qa as ga,r as zt,ta as yv,xa as Ke}from"./chunk-DXOQOJXE.mjs";import{b as Tv,d as wv,e as ya,f as Dd,g as _v,h as Ev,j as Nd,k as Ae,l as tl,m as rn,n as bv,o as Cv,p as Iv,q as Av,s as Rv,u as Od,v as kd}from"./chunk-TFIXUW7O.mjs";import{a as Jo,b as Cd,c as ce,f as R,h as hv,i as Id,j as _}from"./chunk-H6KHSOBK.mjs";var oe=R(At=>{"use strict";Object.defineProperty(At,"__esModule",{value:!0});At.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=At.DEFAULT_MAX_SEND_MESSAGE_LENGTH=At.Propagate=At.LogVerbosity=At.Status=void 0;var Kv=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(Kv||(At.Status=Kv={})),Wv=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(Wv||(At.LogVerbosity=Wv={})),$v=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}($v||(At.Propagate=$v={}));At.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;At.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var Md=R(($U,MI)=>{MI.exports={name:"@grpc/grpc-js",version:"1.9.14",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var Re=R(lt=>{"use strict";var Pd,Ld,Fd,Bd;Object.defineProperty(lt,"__esModule",{value:!0});lt.isTracerEnabled=lt.trace=lt.log=lt.setLoggerVerbosity=lt.setLogger=lt.getLogger=void 0;var Yn=oe(),PI=ce("process"),LI=Md().version,FI={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},Wr=FI,Pi=Yn.LogVerbosity.ERROR,BI=(Ld=(Pd=process.env.GRPC_NODE_VERBOSITY)!==null&&Pd!==void 0?Pd:process.env.GRPC_VERBOSITY)!==null&&Ld!==void 0?Ld:"";switch(BI.toUpperCase()){case"DEBUG":Pi=Yn.LogVerbosity.DEBUG;break;case"INFO":Pi=Yn.LogVerbosity.INFO;break;case"ERROR":Pi=Yn.LogVerbosity.ERROR;break;case"NONE":Pi=Yn.LogVerbosity.NONE;break;default:}var qI=()=>Wr;lt.getLogger=qI;var UI=n=>{Wr=n};lt.setLogger=UI;var VI=n=>{Pi=n};lt.setLoggerVerbosity=VI;var zI=(n,...e)=>{let t;if(n>=Pi){switch(n){case Yn.LogVerbosity.DEBUG:t=Wr.debug;break;case Yn.LogVerbosity.INFO:t=Wr.info;break;case Yn.LogVerbosity.ERROR:t=Wr.error;break}t||(t=Wr.error),t&&t.bind(Wr)(...e)}};lt.log=zI;var GI=(Bd=(Fd=process.env.GRPC_NODE_TRACE)!==null&&Fd!==void 0?Fd:process.env.GRPC_TRACE)!==null&&Bd!==void 0?Bd:"",qd=new Set,Hv=new Set;for(let n of GI.split(","))n.startsWith("-")?Hv.add(n.substring(1)):qd.add(n);var jI=qd.has("all");function KI(n,e,t){Qv(e)&&(0,lt.log)(n,new Date().toISOString()+" | v"+LI+" "+PI.pid+" | "+e+" | "+t)}lt.trace=KI;function Qv(n){return!Hv.has(n)&&(jI||qd.has(n))}lt.isTracerEnabled=Qv});var nl=R(Li=>{"use strict";Object.defineProperty(Li,"__esModule",{value:!0});Li.getErrorCode=Li.getErrorMessage=void 0;function WI(n){return n instanceof Error?n.message:String(n)}Li.getErrorMessage=WI;function $I(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}Li.getErrorCode=$I});var ct=R(il=>{"use strict";Object.defineProperty(il,"__esModule",{value:!0});il.Metadata=void 0;var HI=Re(),QI=oe(),YI=nl(),JI=/^[0-9a-z_.-]+$/,XI=/^[ -~]*$/;function ZI(n){return JI.test(n)}function eA(n){return XI.test(n)}function Jv(n){return n.endsWith("-bin")}function tA(n){return!n.startsWith("grpc-")}function rl(n){return n.toLowerCase()}function Yv(n,e){if(!ZI(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(Jv(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!eA(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var Ud=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=rl(e),Yv(e,t),this.internalRepr.set(e,[t])}add(e,t){e=rl(e),Yv(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=rl(e),this.internalRepr.delete(e)}get(e){return e=rl(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(a=>Buffer.isBuffer(a)?Buffer.from(a):a);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(nA);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{Jv(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(tA(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let a=`Failed to add metadata entry ${r}: ${i}. ${(0,YI.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,HI.log)(QI.LogVerbosity.ERROR,a)}}return t}};il.Metadata=Ud;var nA=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var Kd=R(sl=>{"use strict";Object.defineProperty(sl,"__esModule",{value:!0});sl.CallCredentials=void 0;var jd=ct();function rA(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var Fi=class n{static createFromMetadataGenerator(e){return new zd(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;rA(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,a)=>{e.getRequestMetadata(t.service_url,(o,l)=>{if(o){a(o);return}if(!l){a(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let a=new jd.Metadata;for(let o of Object.keys(s))a.add(o,s[o]);r(null,a)},s=>{r(s)})})}static createEmpty(){return new Gd}};sl.CallCredentials=Fi;var Vd=class n extends Fi{constructor(e){super(),this.creds=e}generateMetadata(e){return _(this,null,function*(){let t=new jd.Metadata,r=yield Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},zd=class n extends Fi{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new Vd([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},Gd=class n extends Fi{generateMetadata(e){return Promise.resolve(new jd.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var $d=R(Bi=>{"use strict";Object.defineProperty(Bi,"__esModule",{value:!0});Bi.getDefaultRootsData=Bi.CIPHER_SUITES=void 0;var iA=ce("fs");Bi.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var Xv=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,Wd=null;function sA(){return Xv?(Wd===null&&(Wd=iA.readFileSync(Xv)),Wd):null}Bi.getDefaultRootsData=sA});var ll=R(ol=>{"use strict";Object.defineProperty(ol,"__esModule",{value:!0});ol.ChannelCredentials=void 0;var aA=ce("tls"),oA=Kd(),Zv=$d();function Hd(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var qi=class{constructor(e){this.callCredentials=e||oA.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(Hd(e,"Root certificate"),Hd(t,"Private key"),Hd(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let a=(0,aA.createSecureContext)({ca:(s=e??(0,Zv.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:Zv.CIPHER_SUITES});return new al(a,i??{})}static createFromSecureContext(e,t){return new al(e,t??{})}static createInsecure(){return new Qd}};ol.ChannelCredentials=qi;var Qd=class n extends qi{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},al=class n extends qi{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new Yd(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},Yd=class n extends qi{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var Xn=R(tt=>{"use strict";Object.defineProperty(tt,"__esModule",{value:!0});tt.validateLoadBalancingConfig=tt.getFirstUsableConfig=tt.isLoadBalancerNameRegistered=tt.createLoadBalancer=tt.registerDefaultLoadBalancerType=tt.registerLoadBalancerType=tt.createChildChannelControlHelper=void 0;function lA(n,e){var t,r,i,s,a,o,l,c,u,d;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(o=(a=e.requestReresolution)===null||a===void 0?void 0:a.bind(e))!==null&&o!==void 0?o:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(d=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&d!==void 0?d:n.removeChannelzChild.bind(n)}}tt.createChildChannelControlHelper=lA;var Jn={},Jd=null;function cA(n,e,t){Jn[n]={LoadBalancer:e,LoadBalancingConfig:t}}tt.registerLoadBalancerType=cA;function uA(n){Jd=n}tt.registerDefaultLoadBalancerType=uA;function dA(n,e){let t=n.getLoadBalancerName();return t in Jn?new Jn[t].LoadBalancer(e):null}tt.createLoadBalancer=dA;function hA(n){return n in Jn}tt.isLoadBalancerNameRegistered=hA;function fA(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in Jn)return t;return e&&Jd?new Jn[Jd].LoadBalancingConfig:null}tt.getFirstUsableConfig=fA;function pA(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in Jn)return Jn[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}tt.validateLoadBalancingConfig=pA});var Xd=R(Zn=>{"use strict";Object.defineProperty(Zn,"__esModule",{value:!0});Zn.extractAndSelectServiceConfig=Zn.validateServiceConfig=Zn.validateRetryThrottling=void 0;var mA=ce("os"),cl=oe(),gA=Xn(),ul=/^\d+(\.\d{1,9})?s$/,yA="node";function vA(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function SA(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!ul.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!ul.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(cl.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(cl.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function TA(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!ul.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(cl.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(cl.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function wA(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push(vA(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&ul.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=SA(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=TA(n.hedgingPolicy));return t}function eS(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}Zn.validateRetryThrottling=eS;function tS(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,gA.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(wA(r));"retryThrottling"in n&&(e.retryThrottling=eS(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}Zn.validateServiceConfig=tS;function _A(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:tS(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function EA(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=_A(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===mA.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===yA&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function bA(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return EA(i,e)}return null}Zn.extractAndSelectServiceConfig=bA});var Rt=R(dl=>{"use strict";Object.defineProperty(dl,"__esModule",{value:!0});dl.ConnectivityState=void 0;var nS=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(nS||(dl.ConnectivityState=nS={}))});var Tt=R(er=>{"use strict";Object.defineProperty(er,"__esModule",{value:!0});er.uriToString=er.splitHostPort=er.parseUri=void 0;var CA=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function IA(n){let e=CA.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}er.parseUri=IA;var rS=/^\d+$/;function AA(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return rS.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?rS.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}er.splitHostPort=AA;function RA(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}er.uriToString=RA});var sn=R(Dt=>{"use strict";Object.defineProperty(Dt,"__esModule",{value:!0});Dt.mapUriDefaultScheme=Dt.getDefaultAuthority=Dt.createResolver=Dt.registerDefaultScheme=Dt.registerResolver=void 0;var eh=Tt(),Ui={},Zd=null;function DA(n,e){Ui[n]=e}Dt.registerResolver=DA;function NA(n){Zd=n}Dt.registerDefaultScheme=NA;function OA(n,e,t){if(n.scheme!==void 0&&n.scheme in Ui)return new Ui[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,eh.uriToString)(n)}`)}Dt.createResolver=OA;function kA(n){if(n.scheme!==void 0&&n.scheme in Ui)return Ui[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,eh.uriToString)(n)}`)}Dt.getDefaultAuthority=kA;function xA(n){return n.scheme===void 0||!(n.scheme in Ui)?Zd!==null?{scheme:Zd,authority:void 0,path:(0,eh.uriToString)(n)}:null:n}Dt.mapUriDefaultScheme=xA});var nr=R(tr=>{"use strict";Object.defineProperty(tr,"__esModule",{value:!0});tr.QueuePicker=tr.UnavailablePicker=tr.PickResultType=void 0;var MA=ct(),PA=oe(),hl=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(hl||(tr.PickResultType=hl={})),th=class{constructor(e){this.status=Object.assign({code:PA.Status.UNAVAILABLE,details:"No connection established",metadata:new MA.Metadata},e)}pick(e){return{pickResultType:hl.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};tr.UnavailablePicker=th;var nh=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:hl.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};tr.QueuePicker=nh});var va=R(fl=>{"use strict";Object.defineProperty(fl,"__esModule",{value:!0});fl.BackoffTimeout=void 0;var LA=1e3,FA=1.6,BA=12e4,qA=.2;function UA(n,e){return Math.random()*(e-n)+n}var rh=class{constructor(e,t){this.callback=e,this.initialDelay=LA,this.multiplier=FA,this.maxDelay=BA,this.jitter=qA,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+UA(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};fl.BackoffTimeout=rh});var ml=R(pl=>{"use strict";Object.defineProperty(pl,"__esModule",{value:!0});pl.ChildLoadBalancerHandler=void 0;var VA=Xn(),zA=Rt(),GA="child_load_balancer_helper",ih=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===zA.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),a=(0,VA.createLoadBalancer)(t,s);s.setChild(a),this.currentChild===null?(this.currentChild=a,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=a,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return GA}};pl.ChildLoadBalancerHandler=ih});var sS=R(gl=>{"use strict";Object.defineProperty(gl,"__esModule",{value:!0});gl.ResolvingLoadBalancer=void 0;var jA=Xn(),KA=Xd(),mt=Rt(),WA=sn(),Vi=nr(),$A=va(),sh=oe(),HA=ct(),QA=Re(),YA=oe(),JA=Tt(),XA=ml(),ZA="resolving_load_balancer";function iS(n){QA.trace(YA.LogVerbosity.DEBUG,ZA,n)}var eR=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function tR(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function nR(n,e,t,r){for(let i of t)if(tR(n,e,i,r))return i;return null}function rR(n){return function(t,r){var i,s;let a=t.split("/").filter(c=>c.length>0),o=(i=a[0])!==null&&i!==void 0?i:"",l=(s=a[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of eR){let u=nR(o,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:sh.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:sh.Status.OK,dynamicFilterFactories:[]}}}var ah=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=mt.ConnectivityState.IDLE,this.latestChildPicker=new Vi.QueuePicker(this),this.currentState=mt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,KA.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(mt.ConnectivityState.IDLE,new Vi.QueuePicker(this)),this.childLoadBalancer=new XA.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(iS("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(o,l)=>{this.latestChildState=o,this.latestChildPicker=l,this.updateState(o,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,WA.createResolver)(e,{onSuccessfulResolution:(o,l,c,u,d)=>{var f;this.backoffTimeout.stop(),this.backoffTimeout.reset();let v=null;l===null?c===null?(this.previousServiceConfig=null,v=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):v=this.previousServiceConfig:(v=l,this.previousServiceConfig=l);let b=(f=v?.loadBalancingConfig)!==null&&f!==void 0?f:[],I=(0,jA.getFirstUsableConfig)(b,!0);if(I===null){this.handleResolutionFailure({code:sh.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new HA.Metadata});return}this.childLoadBalancer.updateAddressList(o,I,d);let A=v??this.defaultServiceConfig;this.onSuccessfulResolution(A,u??rR(A))},onError:o=>{this.handleResolutionFailure(o)}},r);let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new $A.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},a),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===mt.ConnectivityState.IDLE&&this.updateState(mt.ConnectivityState.CONNECTING,new Vi.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){iS((0,JA.uriToString)(this.target)+" "+mt.ConnectivityState[this.currentState]+" -> "+mt.ConnectivityState[e]),e===mt.ConnectivityState.IDLE&&(t=new Vi.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===mt.ConnectivityState.IDLE&&(this.updateState(mt.ConnectivityState.TRANSIENT_FAILURE,new Vi.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===mt.ConnectivityState.IDLE||this.currentState===mt.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=mt.ConnectivityState.IDLE,this.latestChildPicker=new Vi.QueuePicker(this),this.currentState=mt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};gl.ResolvingLoadBalancer=ah});var aS=R(zi=>{"use strict";Object.defineProperty(zi,"__esModule",{value:!0});zi.channelOptionsEqual=zi.recognizedOptions=void 0;zi.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function iR(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}zi.channelOptionsEqual=iR});var on=R(an=>{"use strict";Object.defineProperty(an,"__esModule",{value:!0});an.stringToSubchannelAddress=an.subchannelAddressToString=an.subchannelAddressEqual=an.isTcpSubchannelAddress=void 0;var sR=ce("net");function Sa(n){return"port"in n}an.isTcpSubchannelAddress=Sa;function aR(n,e){return!n&&!e?!0:!n||!e?!1:Sa(n)?Sa(e)&&n.host===e.host&&n.port===e.port:!Sa(e)&&n.path===e.path}an.subchannelAddressEqual=aR;function oR(n){return Sa(n)?n.host+":"+n.port:n.path}an.subchannelAddressToString=oR;var lR=443;function cR(n,e){return(0,sR.isIP)(n)?{host:n,port:e??lR}:{path:n}}an.stringToSubchannelAddress=cR});var yl=R(Gi=>{"use strict";Object.defineProperty(Gi,"__esModule",{value:!0});Gi.addAdminServicesToServer=Gi.registerAdminService=void 0;var oS=[];function uR(n,e){oS.push({getServiceDefinition:n,getHandlers:e})}Gi.registerAdminService=uR;function dR(n){for(let{getServiceDefinition:e,getHandlers:t}of oS)n.addService(e(),t())}Gi.addAdminServicesToServer=dR});var lS=R(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});Nt.ClientDuplexStreamImpl=Nt.ClientWritableStreamImpl=Nt.ClientReadableStreamImpl=Nt.ClientUnaryCallImpl=Nt.callErrorFromStatus=void 0;var hR=ce("events"),dh=ce("stream"),Ta=oe();function fR(n,e){let t=`${n.code} ${Ta.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}Nt.callErrorFromStatus=fR;var oh=class extends hR.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Ta.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};Nt.ClientUnaryCallImpl=oh;var lh=class extends dh.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Ta.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};Nt.ClientReadableStreamImpl=lh;var ch=class extends dh.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Ta.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},a=Number(t);Number.isNaN(a)||(s.flags=a),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Nt.ClientWritableStreamImpl=ch;var uh=class extends dh.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Ta.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},a=Number(t);Number.isNaN(a)||(s.flags=a),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Nt.ClientDuplexStreamImpl=uh});var cS=R(ji=>{"use strict";Object.defineProperty(ji,"__esModule",{value:!0});ji.InterceptingListenerImpl=ji.isInterceptingListener=void 0;function pR(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}ji.isInterceptingListener=pR;var hh=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};ji.InterceptingListenerImpl=hh});var Sh=R(Ot=>{"use strict";Object.defineProperty(Ot,"__esModule",{value:!0});Ot.getInterceptingCall=Ot.InterceptingCall=Ot.RequesterBuilder=Ot.ListenerBuilder=Ot.InterceptorConfigurationError=void 0;var mR=ct(),uS=cS(),dS=oe(),hS=nl(),_a=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};Ot.InterceptorConfigurationError=_a;var ph=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};Ot.ListenerBuilder=ph;var mh=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};Ot.RequesterBuilder=mh;var fh={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},wa={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},gh=class{constructor(e,t){var r,i,s,a;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:wa.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:wa.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:wa.halfClose,cancel:(a=t.cancel)!==null&&a!==void 0?a:wa.cancel}:this.requester=wa}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,a,o,l;let c={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:u=>{},onReceiveMessage:(a=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&a!==void 0?a:u=>{},onReceiveStatus:(l=(o=t?.onReceiveStatus)===null||o===void 0?void 0:o.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,d)=>{var f,v,b;this.processingMetadata=!1;let I;if((0,uS.isInterceptingListener)(d))I=d;else{let A={onReceiveMetadata:(f=d.onReceiveMetadata)!==null&&f!==void 0?f:fh.onReceiveMetadata,onReceiveMessage:(v=d.onReceiveMessage)!==null&&v!==void 0?v:fh.onReceiveMessage,onReceiveStatus:(b=d.onReceiveStatus)!==null&&b!==void 0?b:fh.onReceiveStatus};I=new uS.InterceptingListenerImpl(A,c)}this.nextCall.start(u,I),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};Ot.InterceptingCall=gh;function gR(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,a=t.host,o=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,a,o,l);return c&&u.setCredentials(c),u}var vl=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(dS.Status.INTERNAL,`Request message serialization failure: ${(0,hS.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let a;try{a=this.methodDefinition.responseDeserialize(i)}catch(o){r={code:dS.Status.INTERNAL,details:`Response message parsing error: ${(0,hS.getErrorMessage)(o)}`,metadata:new mR.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,a)},onReceiveStatus:i=>{var s,a;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(a=t?.onReceiveStatus)===null||a===void 0||a.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},yh=class extends vl{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,a={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:o=>{},onReceiveMessage:o=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,o)},onReceiveStatus:o=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,o)}};super.start(e,a),this.call.startRead()}},vh=class extends vl{};function yR(n,e,t){let r=gR(n,t.path,e);return t.responseStream?new vh(r,t):new yh(r,t)}function vR(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new _a("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new _a("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(o=>o(e))).filter(o=>o):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(o=>o(e))).filter(o=>o);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((o,l)=>c=>l(c,o),o=>yR(r,o,e))(s)}Ot.getInterceptingCall=vR});var _h=R(Tl=>{"use strict";Object.defineProperty(Tl,"__esModule",{value:!0});Tl.Client=void 0;var ln=lS(),SR=Eh(),TR=Rt(),rr=oe(),Ki=ct(),Sl=Sh(),Gt=Symbol(),Wi=Symbol(),$i=Symbol(),Nn=Symbol();function Th(n){return typeof n=="function"}function Hi(n){return n.stack.split(`
`).slice(1).join(`
`)}var wh=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[Wi]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[$i]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[Wi].length>0&&this[$i].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[Nn]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[Gt]=r.channelOverride;else if(r.channelFactoryOverride){let a=r.channelFactoryOverride;delete r.channelFactoryOverride,this[Gt]=a(e,t,r)}else this[Gt]=new SR.ChannelImplementation(e,t,r)}close(){this[Gt].close()}getChannel(){return this[Gt]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[Gt].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===TR.ConnectivityState.READY)t();else try{this[Gt].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(Th(e))return{metadata:new Ki.Metadata,options:{},callback:e};if(Th(t))return e instanceof Ki.Metadata?{metadata:e,options:{},callback:t}:{metadata:new Ki.Metadata,options:e,callback:t};if(!(e instanceof Ki.Metadata&&t instanceof Object&&Th(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,a,o){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,a,o),d={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},f={argument:i,metadata:u.metadata,call:new ln.ClientUnaryCallImpl,channel:this[Gt],methodDefinition:d,callOptions:u.options,callback:u.callback};this[Nn]&&(f=this[Nn](f));let v=f.call,b={clientInterceptors:this[Wi],clientInterceptorProviders:this[$i],callInterceptors:(l=f.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=f.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},I=(0,Sl.getInterceptingCall)(b,f.methodDefinition,f.callOptions,f.channel);v.call=I;let A=null,M=!1,D=new Error;return I.start(f.metadata,{onReceiveMetadata:B=>{v.emit("metadata",B)},onReceiveMessage(B){A!==null&&I.cancelWithStatus(rr.Status.INTERNAL,"Too many responses received"),A=B},onReceiveStatus(B){if(!M){if(M=!0,B.code===rr.Status.OK)if(A===null){let P=Hi(D);f.callback((0,ln.callErrorFromStatus)({code:rr.Status.INTERNAL,details:"No message received",metadata:B.metadata},P))}else f.callback(null,A);else{let P=Hi(D);f.callback((0,ln.callErrorFromStatus)(B,P))}D=null,v.emit("status",B)}}}),I.sendMessage(i),I.halfClose(),v}makeClientStreamRequest(e,t,r,i,s,a){var o,l;let c=this.checkOptionalUnaryResponseArguments(i,s,a),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},d={metadata:c.metadata,call:new ln.ClientWritableStreamImpl(t),channel:this[Gt],methodDefinition:u,callOptions:c.options,callback:c.callback};this[Nn]&&(d=this[Nn](d));let f=d.call,v={clientInterceptors:this[Wi],clientInterceptorProviders:this[$i],callInterceptors:(o=d.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},b=(0,Sl.getInterceptingCall)(v,d.methodDefinition,d.callOptions,d.channel);f.call=b;let I=null,A=!1,M=new Error;return b.start(d.metadata,{onReceiveMetadata:D=>{f.emit("metadata",D)},onReceiveMessage(D){I!==null&&b.cancelWithStatus(rr.Status.INTERNAL,"Too many responses received"),I=D},onReceiveStatus(D){if(!A){if(A=!0,D.code===rr.Status.OK)if(I===null){let B=Hi(M);d.callback((0,ln.callErrorFromStatus)({code:rr.Status.INTERNAL,details:"No message received",metadata:D.metadata},B))}else d.callback(null,I);else{let B=Hi(M);d.callback((0,ln.callErrorFromStatus)(D,B))}M=null,f.emit("status",D)}}}),f}checkMetadataAndOptions(e,t){let r,i;return e instanceof Ki.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new Ki.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,a){var o,l;let c=this.checkMetadataAndOptions(s,a),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},d={argument:i,metadata:c.metadata,call:new ln.ClientReadableStreamImpl(r),channel:this[Gt],methodDefinition:u,callOptions:c.options};this[Nn]&&(d=this[Nn](d));let f=d.call,v={clientInterceptors:this[Wi],clientInterceptorProviders:this[$i],callInterceptors:(o=d.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},b=(0,Sl.getInterceptingCall)(v,d.methodDefinition,d.callOptions,d.channel);f.call=b;let I=!1,A=new Error;return b.start(d.metadata,{onReceiveMetadata(M){f.emit("metadata",M)},onReceiveMessage(M){f.push(M)},onReceiveStatus(M){if(!I){if(I=!0,f.push(null),M.code!==rr.Status.OK){let D=Hi(A);f.emit("error",(0,ln.callErrorFromStatus)(M,D))}A=null,f.emit("status",M)}}}),b.sendMessage(i),b.halfClose(),f}makeBidiStreamRequest(e,t,r,i,s){var a,o;let l=this.checkMetadataAndOptions(i,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},u={metadata:l.metadata,call:new ln.ClientDuplexStreamImpl(t,r),channel:this[Gt],methodDefinition:c,callOptions:l.options};this[Nn]&&(u=this[Nn](u));let d=u.call,f={clientInterceptors:this[Wi],clientInterceptorProviders:this[$i],callInterceptors:(a=u.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(o=u.callOptions.interceptor_providers)!==null&&o!==void 0?o:[]},v=(0,Sl.getInterceptingCall)(f,u.methodDefinition,u.callOptions,u.channel);d.call=v;let b=!1,I=new Error;return v.start(u.metadata,{onReceiveMetadata(A){d.emit("metadata",A)},onReceiveMessage(A){d.push(A)},onReceiveStatus(A){if(!b){if(b=!0,d.push(null),A.code!==rr.Status.OK){let M=Hi(I);d.emit("error",(0,ln.callErrorFromStatus)(A,M))}I=null,d.emit("status",A)}}}),d}};Tl.Client=wh});var Ch=R(Qi=>{"use strict";Object.defineProperty(Qi,"__esModule",{value:!0});Qi.loadPackageDefinition=Qi.makeClientConstructor=void 0;var Ea=_h(),wR={unary:Ea.Client.prototype.makeUnaryRequest,server_stream:Ea.Client.prototype.makeServerStreamRequest,client_stream:Ea.Client.prototype.makeClientStreamRequest,bidi:Ea.Client.prototype.makeBidiStreamRequest};function bh(n){return["__proto__","prototype","constructor"].includes(n)}function fS(n,e,t){t||(t={});class r extends Ea.Client{}return Object.keys(n).forEach(i=>{if(bh(i))return;let s=n[i],a;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?a="bidi":a="client_stream":s.responseStream?a="server_stream":a="unary";let o=s.requestSerialize,l=s.responseDeserialize,c=_R(wR[a],s.path,o,l);r.prototype[i]=c,Object.assign(r.prototype[i],s),s.originalName&&!bh(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}Qi.makeClientConstructor=fS;function _R(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function ER(n){return"format"in n}function bR(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(o=>bh(o)))continue;let s=i[i.length-1],a=e;for(let o of i.slice(0,-1))a[o]||(a[o]={}),a=a[o];ER(r)?a[s]=r:a[s]=fS(r,s,{})}return e}Qi.loadPackageDefinition=bR});var BS=R((S4,FS)=>{"use strict";var CR=1/0,IR="[object Symbol]",AR=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,RR=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,_l="\\ud800-\\udfff",wS="\\u0300-\\u036f\\ufe20-\\ufe23",_S="\\u20d0-\\u20f0",ES="\\u2700-\\u27bf",bS="a-z\\xdf-\\xf6\\xf8-\\xff",DR="\\xac\\xb1\\xd7\\xf7",NR="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",OR="\\u2000-\\u206f",kR=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",CS="A-Z\\xc0-\\xd6\\xd8-\\xde",IS="\\ufe0e\\ufe0f",AS=DR+NR+OR+kR,Ah="['\u2019]",xR="["+_l+"]",pS="["+AS+"]",wl="["+wS+_S+"]",RS="\\d+",MR="["+ES+"]",DS="["+bS+"]",NS="[^"+_l+AS+RS+ES+bS+CS+"]",Ih="\\ud83c[\\udffb-\\udfff]",PR="(?:"+wl+"|"+Ih+")",OS="[^"+_l+"]",Rh="(?:\\ud83c[\\udde6-\\uddff]){2}",Dh="[\\ud800-\\udbff][\\udc00-\\udfff]",Yi="["+CS+"]",kS="\\u200d",mS="(?:"+DS+"|"+NS+")",LR="(?:"+Yi+"|"+NS+")",gS="(?:"+Ah+"(?:d|ll|m|re|s|t|ve))?",yS="(?:"+Ah+"(?:D|LL|M|RE|S|T|VE))?",xS=PR+"?",MS="["+IS+"]?",FR="(?:"+kS+"(?:"+[OS,Rh,Dh].join("|")+")"+MS+xS+")*",PS=MS+xS+FR,BR="(?:"+[MR,Rh,Dh].join("|")+")"+PS,qR="(?:"+[OS+wl+"?",wl,Rh,Dh,xR].join("|")+")",UR=RegExp(Ah,"g"),VR=RegExp(wl,"g"),zR=RegExp(Ih+"(?="+Ih+")|"+qR+PS,"g"),GR=RegExp([Yi+"?"+DS+"+"+gS+"(?="+[pS,Yi,"$"].join("|")+")",LR+"+"+yS+"(?="+[pS,Yi+mS,"$"].join("|")+")",Yi+"?"+mS+"+"+gS,Yi+"+"+yS,RS,BR].join("|"),"g"),jR=RegExp("["+kS+_l+wS+_S+IS+"]"),KR=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,WR={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},$R=typeof global=="object"&&global&&global.Object===Object&&global,HR=typeof self=="object"&&self&&self.Object===Object&&self,QR=$R||HR||Function("return this")();function YR(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function JR(n){return n.split("")}function XR(n){return n.match(AR)||[]}function ZR(n){return function(e){return n?.[e]}}var eD=ZR(WR);function LS(n){return jR.test(n)}function tD(n){return KR.test(n)}function nD(n){return LS(n)?rD(n):JR(n)}function rD(n){return n.match(zR)||[]}function iD(n){return n.match(GR)||[]}var sD=Object.prototype,aD=sD.toString,vS=QR.Symbol,SS=vS?vS.prototype:void 0,TS=SS?SS.toString:void 0;function oD(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function lD(n){if(typeof n=="string")return n;if(fD(n))return TS?TS.call(n):"";var e=n+"";return e=="0"&&1/n==-CR?"-0":e}function cD(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:oD(n,e,t)}function uD(n){return function(e){e=El(e);var t=LS(e)?nD(e):void 0,r=t?t[0]:e.charAt(0),i=t?cD(t,1).join(""):e.slice(1);return r[n]()+i}}function dD(n){return function(e){return YR(vD(gD(e).replace(UR,"")),n,"")}}function hD(n){return!!n&&typeof n=="object"}function fD(n){return typeof n=="symbol"||hD(n)&&aD.call(n)==IR}function El(n){return n==null?"":lD(n)}var pD=dD(function(n,e,t){return e=e.toLowerCase(),n+(t?mD(e):e)});function mD(n){return yD(El(n).toLowerCase())}function gD(n){return n=El(n),n&&n.replace(RR,eD).replace(VR,"")}var yD=uD("toUpperCase");function vD(n,e,t){return n=El(n),e=t?void 0:e,e===void 0?tD(n)?iD(n):XR(n):n.match(e)||[]}FS.exports=pD});var Nh=R((T4,qS)=>{"use strict";qS.exports=SD;function SD(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(o,l){t[r]=function(u){if(s)if(s=!1,u)l(u);else{for(var d=new Array(arguments.length-1),f=0;f<d.length;)d[f++]=arguments[f];o.apply(null,d)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var GS=R(zS=>{"use strict";var bl=zS;bl.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var Ji=new Array(64),VS=new Array(123);for(jt=0;jt<64;)VS[Ji[jt]=jt<26?jt+65:jt<52?jt+71:jt<62?jt-4:jt-59|43]=jt++;var jt;bl.encode=function(e,t,r){for(var i=null,s=[],a=0,o=0,l;t<r;){var c=e[t++];switch(o){case 0:s[a++]=Ji[c>>2],l=(c&3)<<4,o=1;break;case 1:s[a++]=Ji[l|c>>4],l=(c&15)<<2,o=2;break;case 2:s[a++]=Ji[l|c>>6],s[a++]=Ji[c&63],o=0;break}a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0)}return o&&(s[a++]=Ji[l],s[a++]=61,o===1&&(s[a++]=61)),i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))};var US="invalid encoding";bl.decode=function(e,t,r){for(var i=r,s=0,a,o=0;o<e.length;){var l=e.charCodeAt(o++);if(l===61&&s>1)break;if((l=VS[l])===void 0)throw Error(US);switch(s){case 0:a=l,s=1;break;case 1:t[r++]=a<<2|(l&48)>>4,a=l,s=2;break;case 2:t[r++]=(a&15)<<4|(l&60)>>2,a=l,s=3;break;case 3:t[r++]=(a&3)<<6|l,s=0;break}}if(s===1)throw Error(US);return r-i};bl.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var KS=R((_4,jS)=>{"use strict";jS.exports=Cl;function Cl(){this._listeners={}}Cl.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};Cl.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};Cl.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var XS=R((E4,JS)=>{"use strict";JS.exports=WS(WS);function WS(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function a(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function o(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=r?a:o,n.readFloatBE=r?o:a}():function(){function e(r,i,s,a){var o=i<0?1:0;if(o&&(i=-i),i===0)r(1/i>0?0:2147483648,s,a);else if(isNaN(i))r(2143289344,s,a);else if(i>34028234663852886e22)r((o<<31|2139095040)>>>0,s,a);else if(i<11754943508222875e-54)r((o<<31|Math.round(i/1401298464324817e-60))>>>0,s,a);else{var l=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((o<<31|l+127<<23|c)>>>0,s,a)}}n.writeFloatLE=e.bind(null,$S),n.writeFloatBE=e.bind(null,HS);function t(r,i,s){var a=r(i,s),o=(a>>31)*2+1,l=a>>>23&255,c=a&8388607;return l===255?c?NaN:o*(1/0):l===0?o*1401298464324817e-60*c:o*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,QS),n.readFloatBE=t.bind(null,YS)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function a(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function o(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=r?a:o,n.readDoubleBE=r?o:a}():function(){function e(r,i,s,a,o,l){var c=a<0?1:0;if(c&&(a=-a),a===0)r(0,o,l+i),r(1/a>0?0:2147483648,o,l+s);else if(isNaN(a))r(0,o,l+i),r(2146959360,o,l+s);else if(a>17976931348623157e292)r(0,o,l+i),r((c<<31|2146435072)>>>0,o,l+s);else{var u;if(a<22250738585072014e-324)u=a/5e-324,r(u>>>0,o,l+i),r((c<<31|u/4294967296)>>>0,o,l+s);else{var d=Math.floor(Math.log(a)/Math.LN2);d===1024&&(d=1023),u=a*Math.pow(2,-d),r(u*4503599627370496>>>0,o,l+i),r((c<<31|d+1023<<20|u*1048576&1048575)>>>0,o,l+s)}}}n.writeDoubleLE=e.bind(null,$S,0,4),n.writeDoubleBE=e.bind(null,HS,4,0);function t(r,i,s,a,o){var l=r(a,o+i),c=r(a,o+s),u=(c>>31)*2+1,d=c>>>20&2047,f=4294967296*(c&1048575)+l;return d===2047?f?NaN:u*(1/0):d===0?u*5e-324*f:u*Math.pow(2,d-1075)*(f+4503599627370496)}n.readDoubleLE=t.bind(null,QS,0,4),n.readDoubleBE=t.bind(null,YS,4,0)}(),n}function $S(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function HS(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function QS(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function YS(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var Oh=R((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var eT=R(ZS=>{"use strict";var kh=ZS;kh.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};kh.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,a=[],o=0,l;t<r;)l=e[t++],l<128?a[o++]=l:l>191&&l<224?a[o++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,a[o++]=55296+(l>>10),a[o++]=56320+(l&1023)):a[o++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,a)),o=0);return s?(o&&s.push(String.fromCharCode.apply(String,a.slice(0,o))),s.join("")):String.fromCharCode.apply(String,a.slice(0,o))};kh.write=function(e,t,r){for(var i=r,s,a,o=0;o<e.length;++o)s=e.charCodeAt(o),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((a=e.charCodeAt(o+1))&64512)===56320?(s=65536+((s&1023)<<10)+(a&1023),++o,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var nT=R((C4,tT)=>{"use strict";tT.exports=TD;function TD(n,e,t){var r=t||8192,i=r>>>1,s=null,a=r;return function(l){if(l<1||l>i)return n(l);a+l>r&&(s=n(r),a=0);var c=e.call(s,a,a+=l);return a&7&&(a=(a|7)+1),c}}});var iT=R((I4,rT)=>{"use strict";rT.exports=We;var ba=cn();function We(n,e){this.lo=n>>>0,this.hi=e>>>0}var $r=We.zero=new We(0,0);$r.toNumber=function(){return 0};$r.zzEncode=$r.zzDecode=function(){return this};$r.length=function(){return 1};var wD=We.zeroHash="\0\0\0\0\0\0\0\0";We.fromNumber=function(e){if(e===0)return $r;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new We(r,i)};We.from=function(e){if(typeof e=="number")return We.fromNumber(e);if(ba.isString(e))if(ba.Long)e=ba.Long.fromString(e);else return We.fromNumber(parseInt(e,10));return e.low||e.high?new We(e.low>>>0,e.high>>>0):$r};We.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};We.prototype.toLong=function(e){return ba.Long?new ba.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var ir=String.prototype.charCodeAt;We.fromHash=function(e){return e===wD?$r:new We((ir.call(e,0)|ir.call(e,1)<<8|ir.call(e,2)<<16|ir.call(e,3)<<24)>>>0,(ir.call(e,4)|ir.call(e,5)<<8|ir.call(e,6)<<16|ir.call(e,7)<<24)>>>0)};We.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};We.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};We.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};We.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var cn=R(xh=>{"use strict";var W=xh;W.asPromise=Nh();W.base64=GS();W.EventEmitter=KS();W.float=XS();W.inquire=Oh();W.utf8=eT();W.pool=nT();W.LongBits=iT();W.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);W.global=W.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||xh;W.emptyArray=Object.freeze?Object.freeze([]):[];W.emptyObject=Object.freeze?Object.freeze({}):{};W.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};W.isString=function(e){return typeof e=="string"||e instanceof String};W.isObject=function(e){return e&&typeof e=="object"};W.isset=W.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};W.Buffer=function(){try{var n=W.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();W._Buffer_from=null;W._Buffer_allocUnsafe=null;W.newBuffer=function(e){return typeof e=="number"?W.Buffer?W._Buffer_allocUnsafe(e):new W.Array(e):W.Buffer?W._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};W.Array=typeof Uint8Array<"u"?Uint8Array:Array;W.Long=W.global.dcodeIO&&W.global.dcodeIO.Long||W.global.Long||W.inquire("long");W.key2Re=/^true|false|0|1$/;W.key32Re=/^-?(?:0|[1-9][0-9]*)$/;W.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;W.longToHash=function(e){return e?W.LongBits.from(e).toHash():W.LongBits.zeroHash};W.longFromHash=function(e,t){var r=W.LongBits.fromHash(e);return W.Long?W.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function sT(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}W.merge=sT;W.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function aT(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&sT(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}W.newError=aT;W.ProtocolError=aT("ProtocolError");W.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};W.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};W.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};W._configure=function(){var n=W.Buffer;if(!n){W._Buffer_from=W._Buffer_allocUnsafe=null;return}W._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},W._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var Al=R((R4,uT)=>{"use strict";uT.exports=ae;var kt=cn(),Mh,Il=kt.LongBits,oT=kt.base64,lT=kt.utf8;function Ca(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function Lh(){}function _D(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function ae(){this.len=0,this.head=new Ca(Lh,0,0),this.tail=this.head,this.states=null}var cT=function(){return kt.Buffer?function(){return(ae.create=function(){return new Mh})()}:function(){return new ae}};ae.create=cT();ae.alloc=function(e){return new kt.Array(e)};kt.Array!==Array&&(ae.alloc=kt.pool(ae.alloc,kt.Array.prototype.subarray));ae.prototype._push=function(e,t,r){return this.tail=this.tail.next=new Ca(e,t,r),this.len+=t,this};function Fh(n,e,t){e[t]=n&255}function ED(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function Bh(n,e){this.len=n,this.next=void 0,this.val=e}Bh.prototype=Object.create(Ca.prototype);Bh.prototype.fn=ED;ae.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Bh((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};ae.prototype.int32=function(e){return e<0?this._push(qh,10,Il.fromNumber(e)):this.uint32(e)};ae.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function qh(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}ae.prototype.uint64=function(e){var t=Il.from(e);return this._push(qh,t.length(),t)};ae.prototype.int64=ae.prototype.uint64;ae.prototype.sint64=function(e){var t=Il.from(e).zzEncode();return this._push(qh,t.length(),t)};ae.prototype.bool=function(e){return this._push(Fh,1,e?1:0)};function Ph(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}ae.prototype.fixed32=function(e){return this._push(Ph,4,e>>>0)};ae.prototype.sfixed32=ae.prototype.fixed32;ae.prototype.fixed64=function(e){var t=Il.from(e);return this._push(Ph,4,t.lo)._push(Ph,4,t.hi)};ae.prototype.sfixed64=ae.prototype.fixed64;ae.prototype.float=function(e){return this._push(kt.float.writeFloatLE,4,e)};ae.prototype.double=function(e){return this._push(kt.float.writeDoubleLE,8,e)};var bD=kt.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};ae.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Fh,1,0);if(kt.isString(e)){var r=ae.alloc(t=oT.length(e));oT.decode(e,r,0),e=r}return this.uint32(t)._push(bD,t,e)};ae.prototype.string=function(e){var t=lT.length(e);return t?this.uint32(t)._push(lT.write,t,e):this._push(Fh,1,0)};ae.prototype.fork=function(){return this.states=new _D(this),this.head=this.tail=new Ca(Lh,0,0),this.len=0,this};ae.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Ca(Lh,0,0),this.len=0),this};ae.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};ae.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};ae._configure=function(n){Mh=n,ae.create=cT(),Mh._configure()}});var fT=R((D4,hT)=>{"use strict";hT.exports=un;var dT=Al();(un.prototype=Object.create(dT.prototype)).constructor=un;var sr=cn();function un(){dT.call(this)}un._configure=function(){un.alloc=sr._Buffer_allocUnsafe,un.writeBytesBuffer=sr.Buffer&&sr.Buffer.prototype instanceof Uint8Array&&sr.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};un.prototype.bytes=function(e){sr.isString(e)&&(e=sr._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(un.writeBytesBuffer,t,e),this};function CD(n,e,t){n.length<40?sr.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}un.prototype.string=function(e){var t=sr.Buffer.byteLength(e);return this.uint32(t),t&&this._push(CD,t,e),this};un._configure()});var Dl=R((N4,vT)=>{"use strict";vT.exports=ke;var Kt=cn(),Vh,gT=Kt.LongBits,ID=Kt.utf8;function Wt(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function ke(n){this.buf=n,this.pos=0,this.len=n.length}var pT=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new ke(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new ke(e);throw Error("illegal buffer")},yT=function(){return Kt.Buffer?function(t){return(ke.create=function(i){return Kt.Buffer.isBuffer(i)?new Vh(i):pT(i)})(t)}:pT};ke.create=yT();ke.prototype._slice=Kt.Array.prototype.subarray||Kt.Array.prototype.slice;ke.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Wt(this,10);return e}}();ke.prototype.int32=function(){return this.uint32()|0};ke.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function Uh(){var n=new gT(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Wt(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw Wt(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}ke.prototype.bool=function(){return this.uint32()!==0};function Rl(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}ke.prototype.fixed32=function(){if(this.pos+4>this.len)throw Wt(this,4);return Rl(this.buf,this.pos+=4)};ke.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Wt(this,4);return Rl(this.buf,this.pos+=4)|0};function mT(){if(this.pos+8>this.len)throw Wt(this,8);return new gT(Rl(this.buf,this.pos+=4),Rl(this.buf,this.pos+=4))}ke.prototype.float=function(){if(this.pos+4>this.len)throw Wt(this,4);var e=Kt.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};ke.prototype.double=function(){if(this.pos+8>this.len)throw Wt(this,4);var e=Kt.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};ke.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw Wt(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=Kt.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};ke.prototype.string=function(){var e=this.bytes();return ID.read(e,0,e.length)};ke.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Wt(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Wt(this);while(this.buf[this.pos++]&128);return this};ke.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};ke._configure=function(n){Vh=n,ke.create=yT(),Vh._configure();var e=Kt.Long?"toLong":"toNumber";Kt.merge(ke.prototype,{int64:function(){return Uh.call(this)[e](!1)},uint64:function(){return Uh.call(this)[e](!0)},sint64:function(){return Uh.call(this).zzDecode()[e](!1)},fixed64:function(){return mT.call(this)[e](!0)},sfixed64:function(){return mT.call(this)[e](!1)}})}});var _T=R((O4,wT)=>{"use strict";wT.exports=Hr;var TT=Dl();(Hr.prototype=Object.create(TT.prototype)).constructor=Hr;var ST=cn();function Hr(n){TT.call(this,n)}Hr._configure=function(){ST.Buffer&&(Hr.prototype._slice=ST.Buffer.prototype.slice)};Hr.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Hr._configure()});var bT=R((k4,ET)=>{"use strict";ET.exports=Ia;var zh=cn();(Ia.prototype=Object.create(zh.EventEmitter.prototype)).constructor=Ia;function Ia(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");zh.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}Ia.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var a=this;if(!s)return zh.asPromise(n,a,e,t,r,i);if(!a.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return a.rpcImpl(e,t[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,c){if(l)return a.emit("error",l,e),s(l);if(c===null){a.end(!0);return}if(!(c instanceof r))try{c=r[a.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return a.emit("error",u,e),s(u)}return a.emit("data",c,e),s(null,c)})}catch(o){a.emit("error",o,e),setTimeout(function(){s(o)},0);return}};Ia.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var Gh=R(CT=>{"use strict";var AD=CT;AD.Service=bT()});var jh=R((M4,IT)=>{"use strict";IT.exports={}});var DT=R(RT=>{"use strict";var gt=RT;gt.build="minimal";gt.Writer=Al();gt.BufferWriter=fT();gt.Reader=Dl();gt.BufferReader=_T();gt.util=cn();gt.rpc=Gh();gt.roots=jh();gt.configure=AT;function AT(){gt.util._configure(),gt.Writer._configure(gt.BufferWriter),gt.Reader._configure(gt.BufferReader)}AT()});var OT=R((L4,NT)=>{"use strict";NT.exports=Kh;function Kh(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var a=i();if(Kh.verbose&&console.log("codegen: "+a),a="return "+a,s){for(var o=Object.keys(s),l=new Array(o.length+1),c=new Array(o.length),u=0;u<o.length;)l[u]=o[u],c[u]=s[o[u++]];return l[u]=a,Function.apply(null,l).apply(null,c)}return Function(a)()}for(var d=new Array(arguments.length-1),f=0;f<d.length;)d[f]=arguments[++f];if(f=0,s=s.replace(/%([%dfijs])/g,function(b,I){var A=d[f++];switch(I){case"d":case"f":return String(Number(A));case"i":return String(Math.floor(A));case"j":return JSON.stringify(A);case"s":return String(A)}return"%"}),f!==d.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}Kh.verbose=!1});var xT=R((F4,kT)=>{"use strict";kT.exports=Aa;var RD=Nh(),DD=Oh(),Wh=DD("fs");function Aa(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&Wh&&Wh.readFile?Wh.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?Aa.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):Aa.xhr(n,e,t):RD(Aa,this,n,e)}Aa.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var a=i.response;if(!a){a=[];for(var o=0;o<i.responseText.length;++o)a.push(i.responseText.charCodeAt(o)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(a):a)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var LT=R(PT=>{"use strict";var Hh=PT,MT=Hh.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},$h=Hh.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=MT(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};Hh.resolve=function(e,t,r){return r||(t=$h(t)),MT(t)?t:(r||(e=$h(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?$h(e+"/"+t):t)}});var Qr=R(FT=>{"use strict";var Ra=FT,ND=$e(),OD=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function Da(n,e){var t=0,r={};for(e|=0;t<n.length;)r[OD[t+e]]=n[t++];return r}Ra.basic=Da([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);Ra.defaults=Da([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",ND.emptyArray,null]);Ra.long=Da([0,0,0,1,1],7);Ra.mapKey=Da([0,0,0,5,5,0,0,0,1,1,0,2],2);Ra.packed=Da([1,5,0,0,0,5,5,0,0,0,1,1,0])});var ar=R((U4,UT)=>{"use strict";UT.exports=xt;var Nl=Yr();((xt.prototype=Object.create(Nl.prototype)).constructor=xt).className="Field";var BT=$t(),qT=Qr(),qe=$e(),Qh,kD=/^required|optional|repeated$/;xt.fromJSON=function(e,t){return new xt(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function xt(n,e,t,r,i,s,a){if(qe.isObject(r)?(a=i,s=r,r=i=void 0):qe.isObject(i)&&(a=s,s=i,i=void 0),Nl.call(this,n,s),!qe.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!qe.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!kD.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!qe.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.required=r==="required",this.optional=!this.required,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=qe.Long?qT.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=a}Object.defineProperty(xt.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});xt.prototype.setOption=function(e,t,r){return e==="packed"&&(this._packed=null),Nl.prototype.setOption.call(this,e,t,r)};xt.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return qe.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};xt.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=qT.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof Qh?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof BT&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof BT))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=qe.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;qe.base64.test(this.typeDefault)?qe.base64.decode(this.typeDefault,e=qe.newBuffer(qe.base64.length(this.typeDefault)),0):qe.utf8.write(this.typeDefault,e=qe.newBuffer(qe.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=qe.emptyObject:this.repeated?this.defaultValue=qe.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof Qh&&(this.parent.ctor.prototype[this.name]=this.defaultValue),Nl.prototype.resolve.call(this)};xt.d=function(e,t,r,i){return typeof t=="function"?t=qe.decorateType(t).name:t&&typeof t=="object"&&(t=qe.decorateEnum(t).name),function(a,o){qe.decorateType(a.constructor).add(new xt(o,e,t,r,{default:i}))}};xt._configure=function(e){Qh=e}});var Xi=R((V4,GT)=>{"use strict";GT.exports=Mt;var kl=Yr();((Mt.prototype=Object.create(kl.prototype)).constructor=Mt).className="OneOf";var VT=ar(),Ol=$e();function Mt(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),kl.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}Mt.fromJSON=function(e,t){return new Mt(e,t.oneof,t.options,t.comment)};Mt.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Ol.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function zT(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}Mt.prototype.add=function(e){if(!(e instanceof VT))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,zT(this),this};Mt.prototype.remove=function(e){if(!(e instanceof VT))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};Mt.prototype.onAdd=function(e){kl.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}zT(this)};Mt.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);kl.prototype.onRemove.call(this,e)};Mt.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){Ol.decorateType(i.constructor).add(new Mt(s,e)),Object.defineProperty(i,s,{get:Ol.oneOfGetter(e),set:Ol.oneOfSetter(e)})}}});var ts=R((z4,$T)=>{"use strict";$T.exports=le;var Yh=Yr();((le.prototype=Object.create(Yh.prototype)).constructor=le).className="Namespace";var jT=ar(),xl=$e(),xD=Xi(),Zi,Na,es;le.fromJSON=function(e,t){return new le(e,t.options).addJSON(t.nested)};function KT(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}le.arrayToJSON=KT;le.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};le.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function le(n,e){Yh.call(this,n,e),this.nested=void 0,this._nestedArray=null}function WT(n){return n._nestedArray=null,n}Object.defineProperty(le.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=xl.toArray(this.nested))}});le.prototype.toJSON=function(e){return xl.toObject(["options",this.options,"nested",KT(this.nestedArray,e)])};le.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?Zi.fromJSON:s.values!==void 0?es.fromJSON:s.methods!==void 0?Na.fromJSON:s.id!==void 0?jT.fromJSON:le.fromJSON)(r[i],s));return this};le.prototype.get=function(e){return this.nested&&this.nested[e]||null};le.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof es)return this.nested[e].values;throw Error("no such enum: "+e)};le.prototype.add=function(e){if(!(e instanceof jT&&e.extend!==void 0||e instanceof Zi||e instanceof xD||e instanceof es||e instanceof Na||e instanceof le))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof le&&e instanceof le&&!(t instanceof Zi||t instanceof Na)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),WT(this)};le.prototype.remove=function(e){if(!(e instanceof Yh))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),WT(this)};le.prototype.define=function(e,t){if(xl.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof le))throw Error("path conflicts with non-namespace objects")}else r.add(r=new le(i))}return t&&r.addJSON(t),r};le.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof le?e[t++].resolveAll():e[t++].resolve();return this.resolve()};le.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),xl.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(e.length===1){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof le&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof le&&(i=this._nestedArray[s].lookup(e,t,!0)))return i;return this.parent===null||r?null:this.parent.lookup(e,t)};le.prototype.lookupType=function(e){var t=this.lookup(e,[Zi]);if(!t)throw Error("no such type: "+e);return t};le.prototype.lookupEnum=function(e){var t=this.lookup(e,[es]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};le.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[Zi,es]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};le.prototype.lookupService=function(e){var t=this.lookup(e,[Na]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};le._configure=function(n,e,t){Zi=n,Na=e,es=t}});var Ml=R((G4,HT)=>{"use strict";HT.exports=On;var Jh=ar();((On.prototype=Object.create(Jh.prototype)).constructor=On).className="MapField";var MD=Qr(),Oa=$e();function On(n,e,t,r,i,s){if(Jh.call(this,n,e,r,void 0,void 0,i,s),!Oa.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}On.fromJSON=function(e,t){return new On(e,t.id,t.keyType,t.type,t.options,t.comment)};On.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Oa.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};On.prototype.resolve=function(){if(this.resolved)return this;if(MD.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return Jh.prototype.resolve.call(this)};On.d=function(e,t,r){return typeof r=="function"?r=Oa.decorateType(r).name:r&&typeof r=="object"&&(r=Oa.decorateEnum(r).name),function(s,a){Oa.decorateType(s.constructor).add(new On(a,e,t,r))}}});var Pl=R((j4,QT)=>{"use strict";QT.exports=Jr;var Xh=Yr();((Jr.prototype=Object.create(Xh.prototype)).constructor=Jr).className="Method";var ns=$e();function Jr(n,e,t,r,i,s,a,o,l){if(ns.isObject(i)?(a=i,i=s=void 0):ns.isObject(s)&&(a=s,s=void 0),!(e===void 0||ns.isString(e)))throw TypeError("type must be a string");if(!ns.isString(t))throw TypeError("requestType must be a string");if(!ns.isString(r))throw TypeError("responseType must be a string");Xh.call(this,n,a),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=o,this.parsedOptions=l}Jr.fromJSON=function(e,t){return new Jr(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};Jr.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return ns.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};Jr.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),Xh.prototype.resolve.call(this))}});var Ll=R((K4,JT)=>{"use strict";JT.exports=Pt;var or=ts();((Pt.prototype=Object.create(or.prototype)).constructor=Pt).className="Service";var Zh=Pl(),ka=$e(),PD=Gh();function Pt(n,e){or.call(this,n,e),this.methods={},this._methodsArray=null}Pt.fromJSON=function(e,t){var r=new Pt(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(Zh.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r};Pt.prototype.toJSON=function(e){var t=or.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return ka.toObject(["options",t&&t.options||void 0,"methods",or.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(Pt.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=ka.toArray(this.methods))}});function YT(n){return n._methodsArray=null,n}Pt.prototype.get=function(e){return this.methods[e]||or.prototype.get.call(this,e)};Pt.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return or.prototype.resolve.call(this)};Pt.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof Zh?(this.methods[e.name]=e,e.parent=this,YT(this)):or.prototype.add.call(this,e)};Pt.prototype.remove=function(e){if(e instanceof Zh){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,YT(this)}return or.prototype.remove.call(this,e)};Pt.prototype.create=function(e,t,r){for(var i=new PD.Service(e,t,r),s=0,a;s<this.methodsArray.length;++s){var o=ka.lcFirst((a=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[o]=ka.codegen(["r","c"],ka.isReserved(o)?o+"_":o)("return this.rpcCall(m,q,s,r,c)")({m:a,q:a.resolvedRequestType.ctor,s:a.resolvedResponseType.ctor})}return i}});var Fl=R((W4,XT)=>{"use strict";XT.exports=dn;var LD=cn();function dn(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}dn.create=function(e){return this.$type.create(e)};dn.encode=function(e,t){return this.$type.encode(e,t)};dn.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};dn.decode=function(e){return this.$type.decode(e)};dn.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};dn.verify=function(e){return this.$type.verify(e)};dn.fromObject=function(e){return this.$type.fromObject(e)};dn.toObject=function(e,t){return this.$type.toObject(e,t)};dn.prototype.toJSON=function(){return this.$type.toObject(this,LD.toJSONOptions)}});var ef=R(($4,ew)=>{"use strict";ew.exports=qD;var FD=$t(),kn=Qr(),ZT=$e();function BD(n){return"missing required '"+n.name+"'"}function qD(n){var e=ZT.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(o){return o.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof FD?"int32":r.type,s="m"+ZT.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),kn.defaults[r.keyType]!==void 0?e("k=%j",kn.defaults[r.keyType]):e("k=null"),kn.defaults[i]!==void 0?e("value=%j",kn.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),kn.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),kn.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),kn.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),kn.basic[i]===void 0?e(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):kn.basic[i]===void 0?e(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var a=n._fieldsArray[t];a.required&&e("if(!m.hasOwnProperty(%j))",a.name)("throw util.ProtocolError(%j,{instance:m})",BD(a))}return e("return m")}});var rf=R((H4,tw)=>{"use strict";tw.exports=zD;var UD=$t(),tf=$e();function Lt(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function nf(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof UD){n("switch(%s){",r)("default:")("return%j",Lt(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",Lt(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",Lt(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",Lt(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",Lt(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",Lt(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",Lt(e,"buffer"));break}return n}function VD(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",Lt(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",Lt(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",Lt(e,"boolean key"));break}return n}function zD(n){var e=tf.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),a="m"+tf.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",a,s.name),s.map)e("if(!util.isObject(%s))",a)("return%j",Lt(s,"object"))("var k=Object.keys(%s)",a)("for(var i=0;i<k.length;++i){"),VD(e,s,"k[i]"),nf(e,s,i,a+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",a)("return%j",Lt(s,"array"))("for(var i=0;i<%s.length;++i){",a),nf(e,s,i,a+"[i]")("}");else{if(s.partOf){var o=tf.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",o)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",o)}nf(e,s,i,a)}s.optional&&e("}")}return e("return null")}});var of=R(rw=>{"use strict";var nw=rw,xa=$t(),hn=$e();function sf(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof xa){n("switch(d%s){",r);for(var s=e.resolvedType.values,a=Object.keys(s),o=0;o<a.length;++o)s[a[o]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",a[o])("case %i:",s[a[o]])("m%s=%j",r,s[a[o]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}nw.fromObject=function(e){var t=e.fieldsArray,r=hn.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),a=hn.safeProp(s.name);s.map?(r("if(d%s){",a)('if(typeof d%s!=="object")',a)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",a)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",a),sf(r,s,i,a+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",a)("if(!Array.isArray(d%s))",a)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",a)("for(var i=0;i<d%s.length;++i){",a),sf(r,s,i,a+"[i]")("}")("}")):(s.resolvedType instanceof xa||r("if(d%s!=null){",a),sf(r,s,i,a),s.resolvedType instanceof xa||r("}"))}return r("return m")};function af(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof xa?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}nw.toObject=function(e){var t=e.fieldsArray.slice().sort(hn.compareFieldsById);if(!t.length)return hn.codegen()("return {}");for(var r=hn.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],a=[],o=0;o<t.length;++o)t[o].partOf||(t[o].resolve().repeated?i:t[o].map?s:a).push(t[o]);if(i.length){for(r("if(o.arrays||o.defaults){"),o=0;o<i.length;++o)r("d%s=[]",hn.safeProp(i[o].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),o=0;o<s.length;++o)r("d%s={}",hn.safeProp(s[o].name));r("}")}if(a.length){for(r("if(o.defaults){"),o=0;o<a.length;++o){var l=a[o],c=hn.safeProp(l.name);if(l.resolvedType instanceof xa)r("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,l.typeDefault)}r("}")}var d=!1;for(o=0;o<t.length;++o){var l=t[o],f=e._fieldsArray.indexOf(l),c=hn.safeProp(l.name);l.map?(d||(d=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),af(r,l,f,c+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),af(r,l,f,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),af(r,l,f,c),l.partOf&&r("if(o.oneofs)")("d%s=%j",hn.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var lf=R(iw=>{"use strict";var GD=iw,jD=Fl();GD[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof jD){var a=n.$type.toObject(n,e),o=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+o,a["@type"]=i,a}return this.toObject(n,e)}}});var Ul=R((J4,aw)=>{"use strict";aw.exports=me;var Ht=ts();((me.prototype=Object.create(Ht.prototype)).constructor=me).className="Type";var KD=$t(),df=Xi(),Bl=ar(),WD=Ml(),$D=Ll(),cf=Fl(),uf=Dl(),HD=Al(),nt=$e(),QD=hf(),YD=ef(),JD=rf(),sw=of(),XD=lf();function me(n,e){Ht.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(me.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=nt.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=nt.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=me.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof cf||((n.prototype=new cf).constructor=n,nt.merge(n.prototype,e)),n.$type=n.prototype.$type=this,nt.merge(n,cf,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:nt.oneOfGetter(this._oneofsArray[t].oneof),set:nt.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});me.generateConstructor=function(e){for(var t=nt.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",nt.safeProp(i.name)):i.repeated&&t("this%s=[]",nt.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function ql(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}me.fromJSON=function(e,t){var r=new me(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?WD.fromJSON:Bl.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add(df.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var a=t.nested[i[s]];r.add((a.id!==void 0?Bl.fromJSON:a.fields!==void 0?me.fromJSON:a.values!==void 0?KD.fromJSON:a.methods!==void 0?$D.fromJSON:Ht.fromJSON)(i[s],a))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r};me.prototype.toJSON=function(e){var t=Ht.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return nt.toObject(["options",t&&t.options||void 0,"oneofs",Ht.arrayToJSON(this.oneofsArray,e),"fields",Ht.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};me.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return Ht.prototype.resolveAll.call(this)};me.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};me.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof Bl&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),ql(this)}return e instanceof df?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),ql(this)):Ht.prototype.add.call(this,e)};me.prototype.remove=function(e){if(e instanceof Bl&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),ql(this)}if(e instanceof df){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),ql(this)}return Ht.prototype.remove.call(this,e)};me.prototype.isReservedId=function(e){return Ht.isReservedId(this.reserved,e)};me.prototype.isReservedName=function(e){return Ht.isReservedName(this.reserved,e)};me.prototype.create=function(e){return new this.ctor(e)};me.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=QD(this)({Writer:HD,types:t,util:nt}),this.decode=YD(this)({Reader:uf,types:t,util:nt}),this.verify=JD(this)({types:t,util:nt}),this.fromObject=sw.fromObject(this)({types:t,util:nt}),this.toObject=sw.toObject(this)({types:t,util:nt});var i=XD[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};me.prototype.encode=function(e,t){return this.setup().encode(e,t)};me.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};me.prototype.decode=function(e,t){return this.setup().decode(e,t)};me.prototype.decodeDelimited=function(e){return e instanceof uf||(e=uf.create(e)),this.decode(e,e.uint32())};me.prototype.verify=function(e){return this.setup().verify(e)};me.prototype.fromObject=function(e){return this.setup().fromObject(e)};me.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};me.d=function(e){return function(r){nt.decorateType(r,e)}}});var Gl=R((X4,dw)=>{"use strict";dw.exports=wt;var zl=ts();((wt.prototype=Object.create(zl.prototype)).constructor=wt).className="Root";var pf=ar(),lw=$t(),ZD=Xi(),lr=$e(),cw,ff,Ma;function wt(n){zl.call(this,"",n),this.deferred=[],this.files=[]}wt.fromJSON=function(e,t){return t||(t=new wt),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};wt.prototype.resolvePath=lr.path.resolve;wt.prototype.fetch=lr.fetch;function uw(){}wt.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return lr.asPromise(n,i,e,t);var s=r===uw;function a(v,b){if(r){if(s)throw v;var I=r;r=null,I(v,b)}}function o(v){var b=v.lastIndexOf("google/protobuf/");if(b>-1){var I=v.substring(b);if(I in Ma)return I}return null}function l(v,b){try{if(lr.isString(b)&&b.charAt(0)==="{"&&(b=JSON.parse(b)),!lr.isString(b))i.setOptions(b.options).addJSON(b.nested);else{ff.filename=v;var I=ff(b,i,t),A,M=0;if(I.imports)for(;M<I.imports.length;++M)(A=o(I.imports[M])||i.resolvePath(v,I.imports[M]))&&c(A);if(I.weakImports)for(M=0;M<I.weakImports.length;++M)(A=o(I.weakImports[M])||i.resolvePath(v,I.weakImports[M]))&&c(A,!0)}}catch(D){a(D)}!s&&!u&&a(null,i)}function c(v,b){if(v=o(v)||v,!(i.files.indexOf(v)>-1)){if(i.files.push(v),v in Ma){s?l(v,Ma[v]):(++u,setTimeout(function(){--u,l(v,Ma[v])}));return}if(s){var I;try{I=lr.fs.readFileSync(v).toString("utf8")}catch(A){b||a(A);return}l(v,I)}else++u,i.fetch(v,function(A,M){if(--u,!!r){if(A){b?u||a(null,i):a(A);return}l(v,M)}})}}var u=0;lr.isString(e)&&(e=[e]);for(var d=0,f;d<e.length;++d)(f=i.resolvePath("",e[d]))&&c(f);if(s)return i;u||a(null,i)};wt.prototype.loadSync=function(e,t){if(!lr.isNode)throw Error("not supported");return this.load(e,t,uw)};wt.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return zl.prototype.resolveAll.call(this)};var Vl=/^[A-Z]/;function ow(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new pf(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}wt.prototype._handleAdd=function(e){if(e instanceof pf)e.extend!==void 0&&!e.extensionField&&(ow(this,e)||this.deferred.push(e));else if(e instanceof lw)Vl.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof ZD)){if(e instanceof cw)for(var t=0;t<this.deferred.length;)ow(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);Vl.test(e.name)&&(e.parent[e.name]=e)}};wt.prototype._handleRemove=function(e){if(e instanceof pf){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof lw)Vl.test(e.name)&&delete e.parent[e.name];else if(e instanceof zl){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);Vl.test(e.name)&&delete e.parent[e.name]}};wt._configure=function(n,e,t){cw=n,ff=e,Ma=t}});var $e=R((Z4,fw)=>{"use strict";var xe=fw.exports=cn(),hw=jh(),mf,gf;xe.codegen=OT();xe.fetch=xT();xe.path=LT();xe.fs=xe.inquire("fs");xe.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};xe.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var eN=/\\/g,tN=/"/g;xe.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};xe.safeProp=function(e){return!/^[$\w_]+$/.test(e)||xe.isReserved(e)?'["'+e.replace(eN,"\\\\").replace(tN,'\\"')+'"]':"."+e};xe.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var nN=/_([a-z])/g;xe.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(nN,function(t,r){return r.toUpperCase()})};xe.compareFieldsById=function(e,t){return e.id-t.id};xe.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(xe.decorateRoot.remove(e.$type),e.$type.name=t,xe.decorateRoot.add(e.$type)),e.$type;mf||(mf=Ul());var r=new mf(t||e.name);return xe.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var rN=0;xe.decorateEnum=function(e){if(e.$type)return e.$type;gf||(gf=$t());var t=new gf("Enum"+rN++,e);return xe.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};xe.setProperty=function(e,t,r){function i(s,a,o){var l=a.shift();if(l==="__proto__"||l==="prototype")return s;if(a.length>0)s[l]=i(s[l]||{},a,o);else{var c=s[l];c&&(o=[].concat(c).concat(o)),s[l]=o}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),i(e,t,r)};Object.defineProperty(xe,"decorateRoot",{get:function(){return hw.decorated||(hw.decorated=new(Gl()))}})});var Yr=R((eV,pw)=>{"use strict";pw.exports=_t;_t.className="ReflectionObject";var jl=$e(),Kl;function _t(n,e){if(!jl.isString(n))throw TypeError("name must be a string");if(e&&!jl.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(_t.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});_t.prototype.toJSON=function(){throw Error()};_t.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Kl&&t._handleAdd(this)};_t.prototype.onRemove=function(e){var t=e.root;t instanceof Kl&&t._handleRemove(this),this.parent=null,this.resolved=!1};_t.prototype.resolve=function(){return this.resolved?this:(this.root instanceof Kl&&(this.resolved=!0),this)};_t.prototype.getOption=function(e){if(this.options)return this.options[e]};_t.prototype.setOption=function(e,t,r){return(!r||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};_t.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var a=s[e];jl.setProperty(a,r,t)}else s={},s[e]=jl.setProperty({},r,t),i.push(s)}else{var o={};o[e]=t,i.push(o)}return this};_t.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};_t.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};_t._configure=function(n){Kl=n}});var $t=R((tV,yw)=>{"use strict";yw.exports=fn;var mw=Yr();((fn.prototype=Object.create(mw.prototype)).constructor=fn).className="Enum";var gw=ts(),Wl=$e();function fn(n,e,t,r,i,s){if(mw.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this.reserved=void 0,e)for(var a=Object.keys(e),o=0;o<a.length;++o)typeof e[a[o]]=="number"&&(this.valuesById[this.values[a[o]]=e[a[o]]]=a[o])}fn.fromJSON=function(e,t){var r=new fn(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r};fn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Wl.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};fn.prototype.add=function(e,t,r,i){if(!Wl.isString(e))throw TypeError("name must be a string");if(!Wl.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};fn.prototype.remove=function(e){if(!Wl.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};fn.prototype.isReservedId=function(e){return gw.isReservedId(this.reserved,e)};fn.prototype.isReservedName=function(e){return gw.isReservedName(this.reserved,e)}});var hf=R((nV,Sw)=>{"use strict";Sw.exports=sN;var iN=$t(),yf=Qr(),vf=$e();function vw(n,e,t,r){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function sN(n){for(var e=vf.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(vf.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),a=n._fieldsArray.indexOf(s),o=s.resolvedType instanceof iN?"int32":s.type,l=yf.basic[o];r="m"+vf.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|yf.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",a,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,o,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&yf.packed[o]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",o,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?vw(e,s,a,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,o,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?vw(e,s,a,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,o,r))}return e("return w")}});var ww=R((rV,Tw)=>{"use strict";var ne=Tw.exports=DT();ne.build="light";function aN(n,e,t){return typeof e=="function"?(t=e,e=new ne.Root):e||(e=new ne.Root),e.load(n,t)}ne.load=aN;function oN(n,e){return e||(e=new ne.Root),e.loadSync(n)}ne.loadSync=oN;ne.encoder=hf();ne.decoder=ef();ne.verifier=rf();ne.converter=of();ne.ReflectionObject=Yr();ne.Namespace=ts();ne.Root=Gl();ne.Enum=$t();ne.Type=Ul();ne.Field=ar();ne.OneOf=Xi();ne.MapField=Ml();ne.Service=Ll();ne.Method=Pl();ne.Message=Fl();ne.wrappers=lf();ne.types=Qr();ne.util=$e();ne.ReflectionObject._configure(ne.Root);ne.Namespace._configure(ne.Type,ne.Service,ne.Enum);ne.Root._configure(ne.Type);ne.Field._configure(ne.Type)});var Tf=R((iV,bw)=>{"use strict";bw.exports=Ew;var Sf=/[\s{}=;:[\],'"()<>]/g,lN=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,cN=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,uN=/^ *[*/]+ */,dN=/^\s*\*?\/*/,hN=/\n/g,fN=/\s/,pN=/\\(.?)/g,mN={0:"\0",r:"\r",n:`
`,t:"	"};function _w(n){return n.replace(pN,function(e,t){switch(t){case"\\":case"":return t;default:return mN[t]||""}})}Ew.unescape=_w;function Ew(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,a={},o=[],l=null;function c(P){return Error("illegal "+P+" (line "+i+")")}function u(){var P=l==="'"?cN:lN;P.lastIndex=t-1;var j=P.exec(n);if(!j)throw c("string");return t=P.lastIndex,A(l),l=null,_w(j[1])}function d(P){return n.charAt(P)}function f(P,j,Q){var T={type:n.charAt(P++),lineEmpty:!1,leading:Q},g;e?g=2:g=3;var y=P-g,S;do if(--y<0||(S=n.charAt(y))===`
`){T.lineEmpty=!0;break}while(S===" "||S==="	");for(var p=n.substring(P,j).split(hN),w=0;w<p.length;++w)p[w]=p[w].replace(e?dN:uN,"").trim();T.text=p.join(`
`).trim(),a[i]=T,s=i}function v(P){var j=b(P),Q=n.substring(P,j),T=/^\s*\/\//.test(Q);return T}function b(P){for(var j=P;j<r&&d(j)!==`
`;)j++;return j}function I(){if(o.length>0)return o.shift();if(l)return u();var P,j,Q,T,g,y=t===0;do{if(t===r)return null;for(P=!1;fN.test(Q=d(t));)if(Q===`
`&&(y=!0,++i),++t===r)return null;if(d(t)==="/"){if(++t===r)throw c("comment");if(d(t)==="/")if(e){if(T=t,g=!1,v(t-1)){g=!0;do if(t=b(t),t===r||(t++,!y))break;while(v(t))}else t=Math.min(r,b(t)+1);g&&(f(T,t,y),y=!0),i++,P=!0}else{for(g=d(T=t+1)==="/";d(++t)!==`
`;)if(t===r)return null;++t,g&&(f(T,t-1,y),y=!0),++i,P=!0}else if((Q=d(t))==="*"){T=t+1,g=e||d(T)==="*";do{if(Q===`
`&&++i,++t===r)throw c("comment");j=Q,Q=d(t)}while(j!=="*"||Q!=="/");++t,g&&(f(T,t-2,y),y=!0),P=!0}else return"/"}}while(P);var S=t;Sf.lastIndex=0;var p=Sf.test(d(S++));if(!p)for(;S<r&&!Sf.test(d(S));)++S;var w=n.substring(t,t=S);return(w==='"'||w==="'")&&(l=w),w}function A(P){o.push(P)}function M(){if(!o.length){var P=I();if(P===null)return null;A(P)}return o[0]}function D(P,j){var Q=M(),T=Q===P;if(T)return I(),!0;if(!j)throw c("token '"+Q+"', '"+P+"' expected");return!1}function B(P){var j=null,Q;return P===void 0?(Q=a[i-1],delete a[i-1],Q&&(e||Q.type==="*"||Q.lineEmpty)&&(j=Q.leading?Q.text:null)):(s<P&&M(),Q=a[P],delete a[P],Q&&!Q.lineEmpty&&(e||Q.type==="/")&&(j=Q.leading?null:Q.text)),j}return Object.defineProperty({next:I,peek:M,push:A,skip:D,cmnt:B},"line",{get:function(){return i}})}});var Nw=R((sV,Dw)=>{"use strict";Dw.exports=xn;xn.filename=null;xn.defaults={keepCase:!1};var gN=Tf(),Cw=Gl(),Iw=Ul(),Aw=ar(),yN=Ml(),Rw=Xi(),vN=$t(),SN=Ll(),TN=Pl(),wf=Qr(),_f=$e(),wN=/^[1-9][0-9]*$/,_N=/^-?[1-9][0-9]*$/,EN=/^0[x][0-9a-fA-F]+$/,bN=/^-?0[x][0-9a-fA-F]+$/,CN=/^0[0-7]+$/,IN=/^-?0[0-7]+$/,AN=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,pn=/^[a-zA-Z_][a-zA-Z_0-9]*$/,mn=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,RN=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function xn(n,e,t){e instanceof Cw||(t=e,e=new Cw),t||(t=xn.defaults);var r=t.preferTrailingComment||!1,i=gN(n,t.alternateCommentMode||!1),s=i.next,a=i.push,o=i.peek,l=i.skip,c=i.cmnt,u=!0,d,f,v,b,I=!1,A=e,M=t.keepCase?function(O){return O}:_f.camelCase;function D(O,k,L){var H=xn.filename;return L||(xn.filename=null),Error("illegal "+(k||"token")+" '"+O+"' ("+(H?H+", ":"")+"line "+i.line+")")}function B(){var O=[],k;do{if((k=s())!=='"'&&k!=="'")throw D(k);O.push(s()),l(k),k=o()}while(k==='"'||k==="'");return O.join("")}function P(O){var k=s();switch(k){case"'":case'"':return a(k),B();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return Q(k,!0)}catch{if(O&&mn.test(k))return k;throw D(k,"value")}}function j(O,k){var L,H;do k&&((L=o())==='"'||L==="'")?O.push(B()):O.push([H=T(s()),l("to",!0)?T(s()):H]);while(l(",",!0));var G={options:void 0};G.setOption=function(Z,Ee){this.options===void 0&&(this.options={}),this.options[Z]=Ee},w(G,function(Ee){if(Ee==="option")pe(G,Ee),l(";");else throw D(Ee)},function(){Xe(G)})}function Q(O,k){var L=1;switch(O.charAt(0)==="-"&&(L=-1,O=O.substring(1)),O){case"inf":case"INF":case"Inf":return L*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(wN.test(O))return L*parseInt(O,10);if(EN.test(O))return L*parseInt(O,16);if(CN.test(O))return L*parseInt(O,8);if(AN.test(O))return L*parseFloat(O);throw D(O,"number",k)}function T(O,k){switch(O){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!k&&O.charAt(0)==="-")throw D(O,"id");if(_N.test(O))return parseInt(O,10);if(bN.test(O))return parseInt(O,16);if(IN.test(O))return parseInt(O,8);throw D(O,"id")}function g(){if(d!==void 0)throw D("package");if(d=s(),!mn.test(d))throw D(d,"name");A=A.define(d),l(";")}function y(){var O=o(),k;switch(O){case"weak":k=v||(v=[]),s();break;case"public":s();default:k=f||(f=[]);break}O=B(),l(";"),k.push(O)}function S(){if(l("="),b=B(),I=b==="proto3",!I&&b!=="proto2")throw D(b,"syntax");l(";")}function p(O,k){switch(k){case"option":return pe(O,k),l(";"),!0;case"message":return h(O,k),!0;case"enum":return de(O,k),!0;case"service":return Be(O,k),!0;case"extend":return Mi(O,k),!0}return!1}function w(O,k,L){var H=i.line;if(O&&(typeof O.comment!="string"&&(O.comment=c()),O.filename=xn.filename),l("{",!0)){for(var G;(G=s())!=="}";)k(G);l(";",!0)}else L&&L(),l(";"),O&&(typeof O.comment!="string"||r)&&(O.comment=c(H)||O.comment)}function h(O,k){if(!pn.test(k=s()))throw D(k,"type name");var L=new Iw(k);w(L,function(G){if(!p(L,G))switch(G){case"map":se(L,G);break;case"required":case"repeated":m(L,G);break;case"optional":I?m(L,"proto3_optional"):m(L,"optional");break;case"oneof":Se(L,G);break;case"extensions":j(L.extensions||(L.extensions=[]));break;case"reserved":j(L.reserved||(L.reserved=[]),!0);break;default:if(!I||!mn.test(G))throw D(G);a(G),m(L,"optional");break}}),O.add(L)}function m(O,k,L){var H=s();if(H==="group"){q(O,k);return}for(;H.endsWith(".")||o().startsWith(".");)H+=s();if(!mn.test(H))throw D(H,"type");var G=s();if(!pn.test(G))throw D(G,"name");G=M(G),l("=");var Z=new Aw(G,T(s()),H,k,L);if(w(Z,function(St){if(St==="option")pe(Z,St),l(";");else throw D(St)},function(){Xe(Z)}),k==="proto3_optional"){var Ee=new Rw("_"+G);Z.setOption("proto3_optional",!0),Ee.add(Z),O.add(Ee)}else O.add(Z);!I&&Z.repeated&&(wf.packed[H]!==void 0||wf.basic[H]===void 0)&&Z.setOption("packed",!1,!0)}function q(O,k){var L=s();if(!pn.test(L))throw D(L,"name");var H=_f.lcFirst(L);L===H&&(L=_f.ucFirst(L)),l("=");var G=T(s()),Z=new Iw(L);Z.group=!0;var Ee=new Aw(H,G,L,k);Ee.filename=xn.filename,w(Z,function(St){switch(St){case"option":pe(Z,St),l(";");break;case"required":case"repeated":m(Z,St);break;case"optional":I?m(Z,"proto3_optional"):m(Z,"optional");break;case"message":h(Z,St);break;case"enum":de(Z,St);break;default:throw D(St)}}),O.add(Z).add(Ee)}function se(O){l("<");var k=s();if(wf.mapKey[k]===void 0)throw D(k,"type");l(",");var L=s();if(!mn.test(L))throw D(L,"type");l(">");var H=s();if(!pn.test(H))throw D(H,"name");l("=");var G=new yN(M(H),T(s()),k,L);w(G,function(Ee){if(Ee==="option")pe(G,Ee),l(";");else throw D(Ee)},function(){Xe(G)}),O.add(G)}function Se(O,k){if(!pn.test(k=s()))throw D(k,"name");var L=new Rw(M(k));w(L,function(G){G==="option"?(pe(L,G),l(";")):(a(G),m(L,"optional"))}),O.add(L)}function de(O,k){if(!pn.test(k=s()))throw D(k,"name");var L=new vN(k);w(L,function(G){switch(G){case"option":pe(L,G),l(";");break;case"reserved":j(L.reserved||(L.reserved=[]),!0);break;default:Oe(L,G)}}),O.add(L)}function Oe(O,k){if(!pn.test(k))throw D(k,"name");l("=");var L=T(s(),!0),H={options:void 0};H.setOption=function(G,Z){this.options===void 0&&(this.options={}),this.options[G]=Z},w(H,function(Z){if(Z==="option")pe(H,Z),l(";");else throw D(Z)},function(){Xe(H)}),O.add(k,L,H.comment,H.options)}function pe(O,k){var L=l("(",!0);if(!mn.test(k=s()))throw D(k,"name");var H=k,G=H,Z;L&&(l(")"),H="("+H+")",G=H,k=o(),RN.test(k)&&(Z=k.slice(1),H+=k,s())),l("=");var Ee=at(O,H);Ie(O,G,Ee,Z)}function at(O,k){if(l("{",!0)){for(var L={};!l("}",!0);){if(!pn.test(et=s()))throw D(et,"name");if(et===null)throw D(et,"end of input");var H,G=et;if(l(":",!0),o()==="{")H=at(O,k+"."+et);else if(o()==="["){H=[];var Z;if(l("[",!0)){do Z=P(!0),H.push(Z);while(l(",",!0));l("]"),typeof Z<"u"&&Fe(O,k+"."+et,Z)}}else H=P(!0),Fe(O,k+"."+et,H);var Ee=L[G];Ee&&(H=[].concat(Ee).concat(H)),L[G]=H,l(",",!0),l(";",!0)}return L}var Hn=P(!0);return Fe(O,k,Hn),Hn}function Fe(O,k,L){O.setOption&&O.setOption(k,L)}function Ie(O,k,L,H){O.setParsedOption&&O.setParsedOption(k,L,H)}function Xe(O){if(l("[",!0)){do pe(O,"option");while(l(",",!0));l("]")}return O}function Be(O,k){if(!pn.test(k=s()))throw D(k,"service name");var L=new SN(k);w(L,function(G){if(!p(L,G))if(G==="rpc")ot(L,G);else throw D(G)}),O.add(L)}function ot(O,k){var L=c(),H=k;if(!pn.test(k=s()))throw D(k,"name");var G=k,Z,Ee,Hn,St;if(l("("),l("stream",!0)&&(Ee=!0),!mn.test(k=s())||(Z=k,l(")"),l("returns"),l("("),l("stream",!0)&&(St=!0),!mn.test(k=s())))throw D(k);Hn=k,l(")");var Yo=new TN(G,H,Z,Hn,Ee,St);Yo.comment=L,w(Yo,function(bd){if(bd==="option")pe(Yo,bd),l(";");else throw D(bd)}),O.add(Yo)}function Mi(O,k){if(!mn.test(k=s()))throw D(k,"reference");var L=k;w(null,function(G){switch(G){case"required":case"repeated":m(O,G,L);break;case"optional":I?m(O,"proto3_optional",L):m(O,"optional",L);break;default:if(!I||!mn.test(G))throw D(G);a(G),m(O,"optional",L);break}})}for(var et;(et=s())!==null;)switch(et){case"package":if(!u)throw D(et);g();break;case"import":if(!u)throw D(et);y();break;case"syntax":if(!u)throw D(et);S();break;case"option":pe(A,et),l(";");break;default:if(p(A,et)){u=!1;continue}throw D(et)}return xn.filename=null,{package:d,imports:f,weakImports:v,syntax:b,root:e}}});var xw=R((aV,kw)=>{"use strict";kw.exports=Qt;var DN=/\/|\./;function Qt(n,e){DN.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),Qt[n]=e}Qt("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var Ow;Qt("duration",{Duration:Ow={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});Qt("timestamp",{Timestamp:Ow});Qt("empty",{Empty:{fields:{}}});Qt("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});Qt("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});Qt("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});Qt.get=function(e){return Qt[e]||null}});var Pw=R((oV,Mw)=>{"use strict";var cr=Mw.exports=ww();cr.build="full";cr.tokenize=Tf();cr.parse=Nw();cr.common=xw();cr.Root._configure(cr.Type,cr.parse,cr.common)});var $l=R((lV,Lw)=>{"use strict";Lw.exports=Pw()});var Ef=R((cV,NN)=>{NN.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var Vw=R((ee,Uw)=>{"use strict";var ut=$l();Uw.exports=ee=ut.descriptor=ut.Root.fromJSON(Ef()).lookup(".google.protobuf");var Fw=ut.Namespace,Pa=ut.Root,Mn=ut.Enum,ur=ut.Type,dr=ut.Field,ON=ut.MapField,Hl=ut.OneOf,La=ut.Service,Ql=ut.Method;Pa.fromDescriptor=function(e){typeof e.length=="number"&&(e=ee.FileDescriptorSet.decode(e));var t=new Pa;if(e.file)for(var r,i,s=0,a;s<e.file.length;++s){if(i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package)),r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(a=0;a<r.messageType.length;++a)i.add(ur.fromDescriptor(r.messageType[a],r.syntax));if(r.enumType)for(a=0;a<r.enumType.length;++a)i.add(Mn.fromDescriptor(r.enumType[a]));if(r.extension)for(a=0;a<r.extension.length;++a)i.add(dr.fromDescriptor(r.extension[a]));if(r.service)for(a=0;a<r.service.length;++a)i.add(La.fromDescriptor(r.service[a]));var o=rs(r.options,ee.FileOptions);if(o){var l=Object.keys(o);for(a=0;a<l.length;++a)i.setOption(l[a],o[l[a]])}}return t};Pa.prototype.toDescriptor=function(e){var t=ee.FileDescriptorSet.create();return Bw(this,t.file,e),t};function Bw(n,e,t){var r=ee.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(r.syntax=t),n instanceof Pa||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof ur?r.messageType.push(s.toDescriptor(t)):s instanceof Mn?r.enumType.push(s.toDescriptor()):s instanceof dr?r.extension.push(s.toDescriptor(t)):s instanceof La?r.service.push(s.toDescriptor()):s instanceof Fw&&Bw(s,e,t);r.options=is(n.options,ee.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var kN=0;ur.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=ee.DescriptorProto.decode(e));var r=new ur(e.name.length?e.name:"Type"+kN++,rs(e.options,ee.MessageOptions)),i;if(e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)r.add(Hl.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var s=dr.fromDescriptor(e.field[i],t);r.add(s),e.field[i].hasOwnProperty("oneofIndex")&&r.oneofsArray[e.field[i].oneofIndex].add(s)}if(e.extension)for(i=0;i<e.extension.length;++i)r.add(dr.fromDescriptor(e.extension[i],t));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)r.add(ur.fromDescriptor(e.nestedType[i],t)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&r.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)r.add(Mn.fromDescriptor(e.enumType[i]));if(e.extensionRange&&e.extensionRange.length)for(r.extensions=[],i=0;i<e.extensionRange.length;++i)r.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(r.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)r.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)r.reserved.push(e.reservedName[i])}return r};ur.prototype.toDescriptor=function(e){var t=ee.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof ON){var s=bf(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),a=bf(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),o=a===11||a===14?this._fieldsArray[r].resolvedType&&qw(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(ee.DescriptorProto.create({name:i.typeName,field:[ee.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),ee.FieldDescriptorProto.create({name:"value",number:2,label:1,type:a,typeName:o})],options:ee.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof dr?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof ur?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof Mn&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(ee.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(ee.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=is(this.options,ee.MessageOptions),t};var xN=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;dr.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=ee.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var r;e.typeName&&e.typeName.length?r=e.typeName:r=BN(e.type);var i;switch(e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var a=new dr(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(a.options=rs(e.options,ee.FieldOptions),e.defaultValue&&e.defaultValue.length){var o=e.defaultValue;switch(o){case"true":case"TRUE":o=!0;break;case"false":case"FALSE":o=!1;break;default:var l=xN.exec(o);l&&(o=parseInt(o));break}a.setOption("default",o)}return qN(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&a.setOption("packed",!1):e.options&&e.options.packed||a.setOption("packed",!1)),a};dr.prototype.toDescriptor=function(e){var t=ee.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=ut.util.ucFirst(this.name),t.label=3;else{switch(t.type=bf(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?qw(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=is(this.options,ee.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=ee.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=ee.FieldOptions.create())).packed=!0),t};var MN=0;Mn.fromDescriptor=function(e){typeof e.length=="number"&&(e=ee.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;t[i&&i.length?i:"NAME"+s]=s}return new Mn(e.name&&e.name.length?e.name:"Enum"+MN++,t,rs(e.options,ee.EnumOptions))};Mn.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(ee.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return ee.EnumDescriptorProto.create({name:this.name,value:e,options:is(this.options,ee.EnumOptions)})};var PN=0;Hl.fromDescriptor=function(e){return typeof e.length=="number"&&(e=ee.OneofDescriptorProto.decode(e)),new Hl(e.name&&e.name.length?e.name:"oneof"+PN++)};Hl.prototype.toDescriptor=function(){return ee.OneofDescriptorProto.create({name:this.name})};var LN=0;La.fromDescriptor=function(e){typeof e.length=="number"&&(e=ee.ServiceDescriptorProto.decode(e));var t=new La(e.name&&e.name.length?e.name:"Service"+LN++,rs(e.options,ee.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)t.add(Ql.fromDescriptor(e.method[r]));return t};La.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return ee.ServiceDescriptorProto.create({name:this.name,method:e,options:is(this.options,ee.ServiceOptions)})};var FN=0;Ql.fromDescriptor=function(e){return typeof e.length=="number"&&(e=ee.MethodDescriptorProto.decode(e)),new Ql(e.name&&e.name.length?e.name:"Method"+FN++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,rs(e.options,ee.MethodOptions))};Ql.prototype.toDescriptor=function(){return ee.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:is(this.options,ee.MethodOptions)})};function BN(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function qN(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function bf(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof Mn)return 14;if(e instanceof ur)return e.group?10:11;throw Error("illegal type: "+n)}function rs(n,e){if(n){for(var t=[],r=0,i,s,a;r<e.fieldsArray.length;++r)(s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(a=n[s],i.resolvedType instanceof Mn&&typeof a=="number"&&i.resolvedType.valuesById[a]!==void 0&&(a=i.resolvedType.valuesById[a]),t.push(UN(s),a));return t.length?ut.util.toObject(t):void 0}}function is(n,e){if(n){for(var t=[],r=0,i=Object.keys(n),s,a;r<i.length;++r)if(a=n[s=i[r]],s!=="default"){var o=e.fields[s];!o&&!(o=e.fields[s=ut.util.camelCase(s)])||t.push(s,a)}return t.length?e.fromObject(ut.util.toObject(t)):void 0}}function qw(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,a=r.length-1;if(!(n instanceof Pa)&&e instanceof Fw)for(;i<t.length&&s<a&&t[i]===r[s];){var o=e.lookup(t[i++],!0);if(o!==null&&o!==e)break;++s}else for(;i<t.length&&s<a&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function UN(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var zw=R((uV,VN)=>{VN.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var Gw=R((dV,zN)=>{zN.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var jw=R((hV,GN)=>{GN.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var Hw=R(hr=>{"use strict";Object.defineProperty(hr,"__esModule",{value:!0});hr.addCommonProtos=hr.loadProtosWithOptionsSync=hr.loadProtosWithOptions=void 0;var Kw=ce("fs"),Ww=ce("path"),ss=$l();function $w(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(Ww.isAbsolute(i))return i;for(let s of e){let a=Ww.join(s,i);try{return Kw.accessSync(a,Kw.constants.R_OK),a}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}function jN(n,e){return _(this,null,function*(){let t=new ss.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));$w(t,e.includeDirs)}let r=yield t.load(n,e);return r.resolveAll(),r})}hr.loadProtosWithOptions=jN;function KN(n,e){let t=new ss.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");$w(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}hr.loadProtosWithOptionsSync=KN;function WN(){let n=zw(),e=Ef(),t=Gw(),r=jw();ss.common("api",n.nested.google.nested.protobuf.nested),ss.common("descriptor",e.nested.google.nested.protobuf.nested),ss.common("source_context",t.nested.google.nested.protobuf.nested),ss.common("type",r.nested.google.nested.protobuf.nested)}hr.addCommonProtos=WN});var Jw=R((Yw,Cf)=>{"use strict";var Qw=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(h,m,q){this.low=h|0,this.high=m|0,this.unsigned=!!q}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(h){return(h&&h.__isLong__)===!0}function i(h){var m=Math.clz32(h&-h);return h?31-m:m}t.isLong=r;var s={},a={};function o(h,m){var q,se,Se;return m?(h>>>=0,(Se=0<=h&&h<256)&&(se=a[h],se)?se:(q=c(h,0,!0),Se&&(a[h]=q),q)):(h|=0,(Se=-128<=h&&h<128)&&(se=s[h],se)?se:(q=c(h,h<0?-1:0,!1),Se&&(s[h]=q),q))}t.fromInt=o;function l(h,m){if(isNaN(h))return m?P:B;if(m){if(h<0)return P;if(h>=A)return y}else{if(h<=-M)return S;if(h+1>=M)return g}return h<0?l(-h,m).neg():c(h%I|0,h/I|0,m)}t.fromNumber=l;function c(h,m,q){return new t(h,m,q)}t.fromBits=c;var u=Math.pow;function d(h,m,q){if(h.length===0)throw Error("empty string");if(typeof m=="number"?(q=m,m=!1):m=!!m,h==="NaN"||h==="Infinity"||h==="+Infinity"||h==="-Infinity")return m?P:B;if(q=q||10,q<2||36<q)throw RangeError("radix");var se;if((se=h.indexOf("-"))>0)throw Error("interior hyphen");if(se===0)return d(h.substring(1),m,q).neg();for(var Se=l(u(q,8)),de=B,Oe=0;Oe<h.length;Oe+=8){var pe=Math.min(8,h.length-Oe),at=parseInt(h.substring(Oe,Oe+pe),q);if(pe<8){var Fe=l(u(q,pe));de=de.mul(Fe).add(l(at))}else de=de.mul(Se),de=de.add(l(at))}return de.unsigned=m,de}t.fromString=d;function f(h,m){return typeof h=="number"?l(h,m):typeof h=="string"?d(h,m):c(h.low,h.high,typeof m=="boolean"?m:h.unsigned)}t.fromValue=f;var v=65536,b=1<<24,I=v*v,A=I*I,M=A/2,D=o(b),B=o(0);t.ZERO=B;var P=o(0,!0);t.UZERO=P;var j=o(1);t.ONE=j;var Q=o(1,!0);t.UONE=Q;var T=o(-1);t.NEG_ONE=T;var g=c(-1,2147483647,!1);t.MAX_VALUE=g;var y=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=y;var S=c(0,-2147483648,!1);t.MIN_VALUE=S;var p=t.prototype;p.toInt=function(){return this.unsigned?this.low>>>0:this.low},p.toNumber=function(){return this.unsigned?(this.high>>>0)*I+(this.low>>>0):this.high*I+(this.low>>>0)},p.toString=function(m){if(m=m||10,m<2||36<m)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(S)){var q=l(m),se=this.div(q),Se=se.mul(q).sub(this);return se.toString(m)+Se.toInt().toString(m)}else return"-"+this.neg().toString(m);for(var de=l(u(m,6),this.unsigned),Oe=this,pe="";;){var at=Oe.div(de),Fe=Oe.sub(at.mul(de)).toInt()>>>0,Ie=Fe.toString(m);if(Oe=at,Oe.isZero())return Ie+pe;for(;Ie.length<6;)Ie="0"+Ie;pe=""+Ie+pe}},p.getHighBits=function(){return this.high},p.getHighBitsUnsigned=function(){return this.high>>>0},p.getLowBits=function(){return this.low},p.getLowBitsUnsigned=function(){return this.low>>>0},p.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var m=this.high!=0?this.high:this.low,q=31;q>0&&!(m&1<<q);q--);return this.high!=0?q+33:q+1},p.isZero=function(){return this.high===0&&this.low===0},p.eqz=p.isZero,p.isNegative=function(){return!this.unsigned&&this.high<0},p.isPositive=function(){return this.unsigned||this.high>=0},p.isOdd=function(){return(this.low&1)===1},p.isEven=function(){return(this.low&1)===0},p.equals=function(m){return r(m)||(m=f(m)),this.unsigned!==m.unsigned&&this.high>>>31===1&&m.high>>>31===1?!1:this.high===m.high&&this.low===m.low},p.eq=p.equals,p.notEquals=function(m){return!this.eq(m)},p.neq=p.notEquals,p.ne=p.notEquals,p.lessThan=function(m){return this.comp(m)<0},p.lt=p.lessThan,p.lessThanOrEqual=function(m){return this.comp(m)<=0},p.lte=p.lessThanOrEqual,p.le=p.lessThanOrEqual,p.greaterThan=function(m){return this.comp(m)>0},p.gt=p.greaterThan,p.greaterThanOrEqual=function(m){return this.comp(m)>=0},p.gte=p.greaterThanOrEqual,p.ge=p.greaterThanOrEqual,p.compare=function(m){if(r(m)||(m=f(m)),this.eq(m))return 0;var q=this.isNegative(),se=m.isNegative();return q&&!se?-1:!q&&se?1:this.unsigned?m.high>>>0>this.high>>>0||m.high===this.high&&m.low>>>0>this.low>>>0?-1:1:this.sub(m).isNegative()?-1:1},p.comp=p.compare,p.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(j)},p.neg=p.negate,p.add=function(m){r(m)||(m=f(m));var q=this.high>>>16,se=this.high&65535,Se=this.low>>>16,de=this.low&65535,Oe=m.high>>>16,pe=m.high&65535,at=m.low>>>16,Fe=m.low&65535,Ie=0,Xe=0,Be=0,ot=0;return ot+=de+Fe,Be+=ot>>>16,ot&=65535,Be+=Se+at,Xe+=Be>>>16,Be&=65535,Xe+=se+pe,Ie+=Xe>>>16,Xe&=65535,Ie+=q+Oe,Ie&=65535,c(Be<<16|ot,Ie<<16|Xe,this.unsigned)},p.subtract=function(m){return r(m)||(m=f(m)),this.add(m.neg())},p.sub=p.subtract,p.multiply=function(m){if(this.isZero())return this;if(r(m)||(m=f(m)),e){var q=e.mul(this.low,this.high,m.low,m.high);return c(q,e.get_high(),this.unsigned)}if(m.isZero())return this.unsigned?P:B;if(this.eq(S))return m.isOdd()?S:B;if(m.eq(S))return this.isOdd()?S:B;if(this.isNegative())return m.isNegative()?this.neg().mul(m.neg()):this.neg().mul(m).neg();if(m.isNegative())return this.mul(m.neg()).neg();if(this.lt(D)&&m.lt(D))return l(this.toNumber()*m.toNumber(),this.unsigned);var se=this.high>>>16,Se=this.high&65535,de=this.low>>>16,Oe=this.low&65535,pe=m.high>>>16,at=m.high&65535,Fe=m.low>>>16,Ie=m.low&65535,Xe=0,Be=0,ot=0,Mi=0;return Mi+=Oe*Ie,ot+=Mi>>>16,Mi&=65535,ot+=de*Ie,Be+=ot>>>16,ot&=65535,ot+=Oe*Fe,Be+=ot>>>16,ot&=65535,Be+=Se*Ie,Xe+=Be>>>16,Be&=65535,Be+=de*Fe,Xe+=Be>>>16,Be&=65535,Be+=Oe*at,Xe+=Be>>>16,Be&=65535,Xe+=se*Ie+Se*Fe+de*at+Oe*pe,Xe&=65535,c(ot<<16|Mi,Xe<<16|Be,this.unsigned)},p.mul=p.multiply,p.divide=function(m){if(r(m)||(m=f(m)),m.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&m.low===-1&&m.high===-1)return this;var q=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,m.low,m.high);return c(q,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?P:B;var se,Se,de;if(this.unsigned){if(m.unsigned||(m=m.toUnsigned()),m.gt(this))return P;if(m.gt(this.shru(1)))return Q;de=P}else{if(this.eq(S)){if(m.eq(j)||m.eq(T))return S;if(m.eq(S))return j;var Oe=this.shr(1);return se=Oe.div(m).shl(1),se.eq(B)?m.isNegative()?j:T:(Se=this.sub(m.mul(se)),de=se.add(Se.div(m)),de)}else if(m.eq(S))return this.unsigned?P:B;if(this.isNegative())return m.isNegative()?this.neg().div(m.neg()):this.neg().div(m).neg();if(m.isNegative())return this.div(m.neg()).neg();de=B}for(Se=this;Se.gte(m);){se=Math.max(1,Math.floor(Se.toNumber()/m.toNumber()));for(var pe=Math.ceil(Math.log(se)/Math.LN2),at=pe<=48?1:u(2,pe-48),Fe=l(se),Ie=Fe.mul(m);Ie.isNegative()||Ie.gt(Se);)se-=at,Fe=l(se,this.unsigned),Ie=Fe.mul(m);Fe.isZero()&&(Fe=j),de=de.add(Fe),Se=Se.sub(Ie)}return de},p.div=p.divide,p.modulo=function(m){if(r(m)||(m=f(m)),e){var q=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,m.low,m.high);return c(q,e.get_high(),this.unsigned)}return this.sub(this.div(m).mul(m))},p.mod=p.modulo,p.rem=p.modulo,p.not=function(){return c(~this.low,~this.high,this.unsigned)},p.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},p.clz=p.countLeadingZeros,p.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},p.ctz=p.countTrailingZeros,p.and=function(m){return r(m)||(m=f(m)),c(this.low&m.low,this.high&m.high,this.unsigned)},p.or=function(m){return r(m)||(m=f(m)),c(this.low|m.low,this.high|m.high,this.unsigned)},p.xor=function(m){return r(m)||(m=f(m)),c(this.low^m.low,this.high^m.high,this.unsigned)},p.shiftLeft=function(m){return r(m)&&(m=m.toInt()),(m&=63)===0?this:m<32?c(this.low<<m,this.high<<m|this.low>>>32-m,this.unsigned):c(0,this.low<<m-32,this.unsigned)},p.shl=p.shiftLeft,p.shiftRight=function(m){return r(m)&&(m=m.toInt()),(m&=63)===0?this:m<32?c(this.low>>>m|this.high<<32-m,this.high>>m,this.unsigned):c(this.high>>m-32,this.high>=0?0:-1,this.unsigned)},p.shr=p.shiftRight,p.shiftRightUnsigned=function(m){return r(m)&&(m=m.toInt()),(m&=63)===0?this:m<32?c(this.low>>>m|this.high<<32-m,this.high>>>m,this.unsigned):m===32?c(this.high,0,this.unsigned):c(this.high>>>m-32,0,this.unsigned)},p.shru=p.shiftRightUnsigned,p.shr_u=p.shiftRightUnsigned,p.rotateLeft=function(m){var q;return r(m)&&(m=m.toInt()),(m&=63)===0?this:m===32?c(this.high,this.low,this.unsigned):m<32?(q=32-m,c(this.low<<m|this.high>>>q,this.high<<m|this.low>>>q,this.unsigned)):(m-=32,q=32-m,c(this.high<<m|this.low>>>q,this.low<<m|this.high>>>q,this.unsigned))},p.rotl=p.rotateLeft,p.rotateRight=function(m){var q;return r(m)&&(m=m.toInt()),(m&=63)===0?this:m===32?c(this.high,this.low,this.unsigned):m<32?(q=32-m,c(this.high<<q|this.low>>>m,this.low<<q|this.high>>>m,this.unsigned)):(m-=32,q=32-m,c(this.low<<q|this.high>>>m,this.high<<q|this.low>>>m,this.unsigned))},p.rotr=p.rotateRight,p.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},p.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},p.toBytes=function(m){return m?this.toBytesLE():this.toBytesBE()},p.toBytesLE=function(){var m=this.high,q=this.low;return[q&255,q>>>8&255,q>>>16&255,q>>>24,m&255,m>>>8&255,m>>>16&255,m>>>24]},p.toBytesBE=function(){var m=this.high,q=this.low;return[m>>>24,m>>>16&255,m>>>8&255,m&255,q>>>24,q>>>16&255,q>>>8&255,q&255]},t.fromBytes=function(m,q,se){return se?t.fromBytesLE(m,q):t.fromBytesBE(m,q)},t.fromBytesLE=function(m,q){return new t(m[0]|m[1]<<8|m[2]<<16|m[3]<<24,m[4]|m[5]<<8|m[6]<<16|m[7]<<24,q)},t.fromBytesBE=function(m,q){return new t(m[4]<<24|m[5]<<16|m[6]<<8|m[7],m[0]<<24|m[1]<<16|m[2]<<8|m[3],q)};var w=t;return n.default=w,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return Qw}):typeof Cf=="object"&&typeof Yw=="object"&&(Cf.exports=Qw)});var Df=R(Ge=>{"use strict";Object.defineProperty(Ge,"__esModule",{value:!0});Ge.loadFileDescriptorSetFromObject=Ge.loadFileDescriptorSetFromBuffer=Ge.fromJSON=Ge.loadSync=Ge.load=Ge.IdempotencyLevel=Ge.isAnyExtension=Ge.Long=void 0;var $N=BS(),gn=$l(),Af=Vw(),Rf=Hw(),HN=Jw();Ge.Long=HN;function QN(n){return"@type"in n&&typeof n["@type"]=="string"}Ge.isAnyExtension=QN;var e_;(function(n){n.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",n.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",n.IDEMPOTENT="IDEMPOTENT"})(e_=Ge.IdempotencyLevel||(Ge.IdempotencyLevel={}));var t_={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function YN(n,e){return n===""?e:n+"."+e}function JN(n){return n instanceof gn.Service||n instanceof gn.Type||n instanceof gn.Enum}function XN(n){return n instanceof gn.Namespace||n instanceof gn.Root}function n_(n,e){let t=YN(e,n.name);return JN(n)?[[t,n]]:XN(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>n_(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function Xw(n,e){return function(r){return n.toObject(n.decode(r),e)}}function Zw(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function ZN(n){return(n||[]).reduce((e,t)=>{for(let[r,i]of Object.entries(t))switch(r){case"uninterpreted_option":e.uninterpreted_option.push(t.uninterpreted_option);break;default:e[r]=i}return e},{deprecated:!1,idempotency_level:e_.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function e1(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:Zw(i),requestDeserialize:Xw(i,t),responseSerialize:Zw(s),responseDeserialize:Xw(s,t),originalName:$N(n.name),requestType:If(i,r),responseType:If(s,r),options:ZN(n.parsedOptions)}}function t1(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=e1(s,e,t,r);return i}function If(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,t_),fileDescriptorProtos:e}}function n1(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,t_),fileDescriptorProtos:e}}function r1(n,e,t,r){if(n instanceof gn.Service)return t1(n,e,t,r);if(n instanceof gn.Type)return If(n,r);if(n instanceof gn.Enum)return n1(n,r);throw new Error("Type mismatch in reflection object handling")}function Yl(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from(Af.FileDescriptorProto.encode(s).finish()));for(let[s,a]of n_(n,""))t[s]=r1(a,s,e,i);return t}function r_(n,e){e=e||{};let t=gn.Root.fromDescriptor(n);return t.resolveAll(),Yl(t,e)}function i1(n,e){return(0,Rf.loadProtosWithOptions)(n,e).then(t=>Yl(t,e))}Ge.load=i1;function s1(n,e){let t=(0,Rf.loadProtosWithOptionsSync)(n,e);return Yl(t,e)}Ge.loadSync=s1;function a1(n,e){e=e||{};let t=gn.Root.fromJSON(n);return t.resolveAll(),Yl(t,e)}Ge.fromJSON=a1;function o1(n,e){let t=Af.FileDescriptorSet.decode(n);return r_(t,e)}Ge.loadFileDescriptorSetFromBuffer=o1;function l1(n,e){let t=Af.FileDescriptorSet.fromObject(n);return r_(t,e)}Ge.loadFileDescriptorSetFromObject=l1;(0,Rf.addCommonProtos)()});var Xr=R(Te=>{"use strict";Object.defineProperty(Te,"__esModule",{value:!0});Te.setup=Te.getChannelzServiceDefinition=Te.getChannelzHandlers=Te.unregisterChannelzRef=Te.registerChannelzSocket=Te.registerChannelzServer=Te.registerChannelzSubchannel=Te.registerChannelzChannel=Te.ChannelzCallTracker=Te.ChannelzChildrenTracker=Te.ChannelzTrace=void 0;var i_=ce("net"),Fa=Rt(),qa=oe(),c1=on(),u1=yl(),d1=Ch();function Nf(n){return{channel_id:n.id,name:n.name}}function Mf(n){return{subchannel_id:n.id,name:n.name}}function h1(n){return{server_id:n.id}}function Xl(n){return{socket_id:n.id,name:n.name}}var s_=32,Of=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=s_*2&&(this.events=this.events.slice(s_)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:Pn(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:Pn(e.timestamp),channel_ref:e.childChannel?Nf(e.childChannel):null,subchannel_ref:e.childSubchannel?Mf(e.childSubchannel):null}))}}};Te.ChannelzTrace=Of;var kf=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};Te.ChannelzChildrenTracker=kf;var xf=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};Te.ChannelzCallTracker=xf;var f1=1;function Zl(){return f1++}var Ba=[],Pf=[],fr=[],Lf=[];function p1(n,e,t){let r=Zl(),i={id:r,name:n,kind:"channel"};return t&&(Ba[r]={ref:i,getInfo:e}),i}Te.registerChannelzChannel=p1;function m1(n,e,t){let r=Zl(),i={id:r,name:n,kind:"subchannel"};return t&&(Pf[r]={ref:i,getInfo:e}),i}Te.registerChannelzSubchannel=m1;function g1(n,e){let t=Zl(),r={id:t,kind:"server"};return e&&(fr[t]={ref:r,getInfo:n}),r}Te.registerChannelzServer=g1;function y1(n,e,t){let r=Zl(),i={id:r,name:n,kind:"socket"};return t&&(Lf[r]={ref:i,getInfo:e}),i}Te.registerChannelzSocket=y1;function v1(n){switch(n.kind){case"channel":delete Ba[n.id];return;case"subchannel":delete Pf[n.id];return;case"server":delete fr[n.id];return;case"socket":delete Lf[n.id];return}}Te.unregisterChannelzRef=v1;function S1(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function a_(n){if(n==="")return[];let e=n.split(":").map(r=>S1(r));return[].concat(...e)}function T1(n){if((0,i_.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,i_.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(a_(e)),s=Buffer.from(a_(t)),a=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,a,s])}else return null}function l_(n){switch(n){case Fa.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case Fa.ConnectivityState.IDLE:return{state:"IDLE"};case Fa.ConnectivityState.READY:return{state:"READY"};case Fa.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case Fa.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function Pn(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function c_(n){let e=n.getInfo();return{ref:Nf(n.ref),data:{target:e.target,state:l_(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Pn(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>Nf(t)),subchannel_ref:e.children.subchannels.map(t=>Mf(t))}}function w1(n,e){let t=Number.parseInt(n.request.channel_id),r=Ba[t];if(r===void 0){e({code:qa.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:c_(r)})}function _1(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<Ba.length;i++){let s=Ba[i];if(s!==void 0&&(r.push(c_(s)),r.length>=t))break}e(null,{channel:r,end:i>=fr.length})}function u_(n){let e=n.getInfo();return{ref:h1(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Pn(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>Xl(t))}}function E1(n,e){let t=Number.parseInt(n.request.server_id),r=fr[t];if(r===void 0){e({code:qa.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:u_(r)})}function b1(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<fr.length;i++){let s=fr[i];if(s!==void 0&&(r.push(u_(s)),r.length>=t))break}e(null,{server:r,end:i>=fr.length})}function C1(n,e){let t=Number.parseInt(n.request.subchannel_id),r=Pf[t];if(r===void 0){e({code:qa.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:Mf(r.ref),data:{target:i.target,state:l_(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:Pn(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(a=>Xl(a))};e(null,{subchannel:s})}function o_(n){var e;return(0,c1.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=T1(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function I1(n,e){var t,r,i,s,a;let o=Number.parseInt(n.request.socket_id),l=Lf[o];if(l===void 0){e({code:qa.Status.NOT_FOUND,details:"No socket data found for id "+o});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=c.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=c.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,d={ref:Xl(l.ref),local:c.localAddress?o_(c.localAddress):null,remote:c.remoteAddress?o_(c.remoteAddress):null,remote_name:(a=c.remoteName)!==null&&a!==void 0?a:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:Pn(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:Pn(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:Pn(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:Pn(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:d})}function A1(n,e){let t=Number.parseInt(n.request.server_id),r=fr[t];if(r===void 0){e({code:qa.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),o=r.getInfo().sessionChildren.sockets.sort((u,d)=>u.id-d.id),l=[],c=0;for(;c<o.length&&!(o[c].id>=i&&(l.push(Xl(o[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=o.length})}function d_(){return{GetChannel:w1,GetTopChannels:_1,GetServer:E1,GetServers:b1,GetSubchannel:C1,GetSocket:I1,GetServerSockets:A1}}Te.getChannelzHandlers=d_;var Jl=null;function h_(){if(Jl)return Jl;let n=Df().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return Jl=(0,d1.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,Jl}Te.getChannelzServiceDefinition=h_;function R1(){(0,u1.registerAdminService)(h_,d_)}Te.setup=R1});var f_=R(tc=>{"use strict";Object.defineProperty(tc,"__esModule",{value:!0});tc.Subchannel=void 0;var ge=Rt(),D1=va(),Ff=Re(),ec=oe(),N1=Tt(),O1=on(),as=Xr(),k1="subchannel",x1=~(1<<31),Bf=class{constructor(e,t,r,i,s){var a;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=ge.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new as.ChannelzCallTracker,this.childrenTracker=new as.ChannelzChildrenTracker,this.streamTracker=new as.ChannelzCallTracker;let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new D1.BackoffTimeout(()=>{this.handleBackoffTimer()},o),this.backoffTimeout.unref(),this.subchannelAddressString=(0,O1.subchannelAddressToString)(t),this.keepaliveTime=(a=r["grpc.keepalive_time_ms"])!==null&&a!==void 0?a:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new as.ChannelzTrace,this.channelzRef=(0,as.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){Ff.trace(ec.LogVerbosity.DEBUG,k1,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){Ff.trace(ec.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([ge.ConnectivityState.TRANSIENT_FAILURE],ge.ConnectivityState.CONNECTING):this.transitionToState([ge.ConnectivityState.TRANSIENT_FAILURE],ge.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,x1);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([ge.ConnectivityState.CONNECTING],ge.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([ge.ConnectivityState.READY],ge.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,Ff.log(ec.LogVerbosity.ERROR,`Connection to ${(0,N1.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([ge.ConnectivityState.CONNECTING],ge.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(ge.ConnectivityState[this.connectivityState]+" -> "+ge.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+ge.ConnectivityState[t]);let a=this.connectivityState;switch(this.connectivityState=t,t){case ge.ConnectivityState.READY:this.stopBackoff();break;case ge.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case ge.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case ge.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let o of this.stateListeners)o(this,a,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,as.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([ge.ConnectivityState.CONNECTING,ge.ConnectivityState.READY],ge.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:a=>{a.code===ec.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([ge.ConnectivityState.IDLE],ge.ConnectivityState.CONNECTING)||this.connectivityState===ge.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([ge.ConnectivityState.TRANSIENT_FAILURE],ge.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};tc.Subchannel=Bf});var zf=R(gr=>{"use strict";Object.defineProperty(gr,"__esModule",{value:!0});gr.setup=gr.DEFAULT_PORT=void 0;var p_=sn(),g_=ce("dns"),y_=ce("util"),M1=Xd(),qf=oe(),Uf=ct(),P1=Re(),L1=oe(),pr=Tt(),m_=ce("net"),F1=va(),B1="dns_resolver";function mr(n){P1.trace(L1.LogVerbosity.DEBUG,B1,n)}gr.DEFAULT_PORT=443;var q1=3e4,U1=y_.promisify(g_.resolveTxt),V1=y_.promisify(g_.lookup);function z1(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var Vf=class{constructor(e,t,r){var i,s,a;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,mr("Resolver constructed for target "+(0,pr.uriToString)(e));let o=(0,pr.splitHostPort)(e.path);o===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,m_.isIPv4)(o.host)||(0,m_.isIPv6)(o.host)?(this.ipResult=[{host:o.host,port:(i=o.port)!==null&&i!==void 0?i:gr.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=o.host,this.port=(s=o.port)!==null&&s!==void 0?s:gr.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:qf.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,pr.uriToString)(this.target)}`,metadata:new Uf.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new F1.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(a=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&a!==void 0?a:q1,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(mr("Returning IP address for target "+(0,pr.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)mr("Failed to parse DNS address "+(0,pr.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:qf.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,pr.uriToString)(this.target)}`,metadata:new Uf.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;mr("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=V1(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(a=>a.family===4),i=t.filter(a=>a.family===6);this.latestLookupResult=z1(i,r).map(a=>({host:a.address,port:+this.port}));let s="["+this.latestLookupResult.map(a=>a.host+":"+a.port).join(",")+"]";if(mr("Resolved addresses for target "+(0,pr.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(mr("Resolution error for target "+(0,pr.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=U1(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,M1.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:qf.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new Uf.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?mr('resolution update delayed by "min time between resolutions" rate limit'):mr("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function G1(){(0,p_.registerResolver)("dns",Vf),(0,p_.registerDefaultScheme)("dns")}gr.setup=G1});var Gf=R(cs=>{"use strict";Object.defineProperty(cs,"__esModule",{value:!0});cs.getProxiedConnection=cs.mapProxyName=void 0;var Ua=Re(),os=oe(),j1=sn(),K1=ce("http"),W1=ce("tls"),$1=Re(),v_=on(),ls=Tt(),H1=ce("url"),Q1=zf(),Y1="proxy";function yr(n){$1.trace(os.LogVerbosity.DEBUG,Y1,n)}function J1(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new H1.URL(n)}catch{return(0,Ua.log)(os.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,Ua.log)(os.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,Ua.log)(os.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let a={address:`${i}:${s}`};return r&&(a.creds=r),yr("Proxy server "+a.address+" set by environment variable "+e),a}function X1(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(yr("No proxy server list set by environment variable "+e),n.split(",")):[]}function Z1(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=J1();if(!i.address)return r;let s=(0,ls.splitHostPort)(n.path);if(!s)return r;let a=s.host;for(let l of X1())if(l===a)return yr("Not using proxy for target in no_proxy list: "+(0,ls.uriToString)(n)),r;let o={"grpc.http_connect_target":(0,ls.uriToString)(n)};return i.creds&&(o["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:o}}cs.mapProxyName=Z1;function eO(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,ls.parseUri)(i);if(s===null)return Promise.resolve({});let a=(0,ls.splitHostPort)(s.path);if(a===null)return Promise.resolve({});let o=`${a.host}:${(r=a.port)!==null&&r!==void 0?r:Q1.DEFAULT_PORT}`,l={method:"CONNECT",path:o},c={Host:o};(0,v_.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,v_.subchannelAddressToString)(n);return yr("Using proxy "+u+" to connect to "+l.path),new Promise((d,f)=>{let v=K1.request(l);v.once("connect",(b,I,A)=>{var M;if(v.removeAllListeners(),I.removeAllListeners(),b.statusCode===200)if(yr("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let D=(0,j1.getDefaultAuthority)(s),B=(0,ls.splitHostPort)(D),P=(M=B?.host)!==null&&M!==void 0?M:D,j=W1.connect(Object.assign({host:P,servername:P,socket:I},t),()=>{yr("Successfully established a TLS connection to "+l.path+" through proxy "+u),d({socket:j,realTarget:s})});j.on("error",Q=>{yr("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+Q.message),f()})}else yr("Successfully established a plaintext connection to "+l.path+" through proxy "+u),d({socket:I,realTarget:s});else(0,Ua.log)(os.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+b.statusCode),f()}),v.once("error",b=>{v.removeAllListeners(),(0,Ua.log)(os.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+b.message),f()}),v.end()})}cs.getProxiedConnection=eO});var Kf=R(nc=>{"use strict";Object.defineProperty(nc,"__esModule",{value:!0});nc.StreamDecoder=void 0;var Ln=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(Ln||{}),jf=class{constructor(){this.readState=Ln.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case Ln.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=Ln.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case Ln.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0)if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=Ln.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=Ln.NO_DATA,i.push(s)}break;case Ln.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),a=Buffer.concat(s,this.readMessageSize+5);this.readState=Ln.NO_DATA,i.push(a)}break;default:throw new Error("Unexpected read state")}return i}};nc.StreamDecoder=jf});var S_=R(rc=>{"use strict";Object.defineProperty(rc,"__esModule",{value:!0});rc.Http2SubchannelCall=void 0;var Fn=ce("http2"),tO=ce("os"),he=oe(),vr=ct(),nO=Kf(),rO=Re(),iO=oe(),sO="subchannel_call";function aO(n){for(let[e,t]of Object.entries(tO.constants.errno))if(t===n)return e;return"Unknown system error "+n}var Wf=class{constructor(e,t,r,i,s){this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.decoder=new nO.StreamDecoder,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=he.Status.UNKNOWN,this.finalStatus=null,this.internalError=null,e.on("response",(a,o)=>{let l="";for(let c of Object.keys(a))l+="		"+c+": "+a[c]+`
`;switch(this.trace(`Received server headers:
`+l),a[":status"]){case 400:this.mappedStatusCode=he.Status.INTERNAL;break;case 401:this.mappedStatusCode=he.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=he.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=he.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=he.Status.UNAVAILABLE;break;default:this.mappedStatusCode=he.Status.UNKNOWN}if(o&Fn.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(a);else{let c;try{c=vr.Metadata.fromHttp2Headers(a)}catch(u){this.endCall({code:he.Status.UNKNOWN,details:u.message,metadata:new vr.Metadata});return}this.listener.onReceiveMetadata(c)}}),e.on("trailers",a=>{this.handleTrailers(a)}),e.on("data",a=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+a.length);let o=this.decoder.write(a);for(let l of o)this.trace("parsed message of length "+l.length),this.callEventTracker.addMessageReceived(),this.tryPush(l)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var a;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((a=this.finalStatus)===null||a===void 0?void 0:a.code)===he.Status.OK)return;let o,l="";switch(e.rstCode){case Fn.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;o=he.Status.INTERNAL,l=`Received RST_STREAM with code ${e.rstCode}`;break;case Fn.constants.NGHTTP2_REFUSED_STREAM:o=he.Status.UNAVAILABLE,l="Stream refused by server";break;case Fn.constants.NGHTTP2_CANCEL:o=he.Status.CANCELLED,l="Call cancelled";break;case Fn.constants.NGHTTP2_ENHANCE_YOUR_CALM:o=he.Status.RESOURCE_EXHAUSTED,l="Bandwidth exhausted or memory limit exceeded";break;case Fn.constants.NGHTTP2_INADEQUATE_SECURITY:o=he.Status.PERMISSION_DENIED,l="Protocol not secure enough";break;case Fn.constants.NGHTTP2_INTERNAL_ERROR:o=he.Status.INTERNAL,this.internalError===null?l=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(o=he.Status.UNAVAILABLE,l=this.internalError.message):l=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:o=he.Status.INTERNAL,l=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:o,details:l,metadata:new vr.Metadata,rstCode:e.rstCode})})}),e.on("error",a=>{a.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+a.message+" code="+a.code+" errno="+aO(a.errno)+" syscall="+a.syscall),this.internalError=a),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:he.Status.UNAVAILABLE,details:"Connection dropped",metadata:new vr.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){rO.trace(iO.LogVerbosity.DEBUG,sO,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===he.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==he.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=vr.Metadata.fromHttp2Headers(e)}catch{r=new vr.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===he.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in he.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let a="";if(typeof i["grpc-message"]=="string"){try{a=decodeURI(i["grpc-message"])}catch{a=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+a+'" from server')}let o={code:s,details:a,metadata:r};this.endCall(o)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===he.Status.OK?t=Fn.constants.NGHTTP2_NO_ERROR:t=Fn.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new vr.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==he.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let a=he.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(a=he.Status.INTERNAL),i&&this.cancelWithStatus(a,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:he.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new vr.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};rc.Http2SubchannelCall=Wf});var $f=R(ic=>{"use strict";Object.defineProperty(ic,"__esModule",{value:!0});ic.getNextCallNumber=void 0;var oO=0;function lO(){return oO++}ic.getNextCallNumber=lO});var __=R(ac=>{"use strict";Object.defineProperty(ac,"__esModule",{value:!0});ac.Http2SubchannelConnector=void 0;var Xf=ce("http2"),T_=ce("tls"),Hf=Xr(),Va=oe(),cO=Gf(),ds=Re(),w_=sn(),sc=on(),us=Tt(),uO=ce("net"),dO=S_(),hO=$f(),Qf="transport",fO="transport_flowctrl",pO=Md().version,{HTTP2_HEADER_AUTHORITY:mO,HTTP2_HEADER_CONTENT_TYPE:gO,HTTP2_HEADER_METHOD:yO,HTTP2_HEADER_PATH:vO,HTTP2_HEADER_TE:SO,HTTP2_HEADER_USER_AGENT:TO}=Xf.constants,wO=2e4,_O=Buffer.from("too_many_pings","ascii"),Yf=class{constructor(e,t,r,i){this.session=e,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=wO,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new Hf.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,sc.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Hf.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${pO}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,a,o)=>{let l=!1;s===Xf.constants.NGHTTP2_ENHANCE_YOUR_CALM&&o&&o.equals(_O)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+o?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),ds.isTracerEnabled(Qf)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,sc.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,a=i.localAddress?(0,sc.stringToSubchannelAddress)(i.localAddress,i.localPort):null,o;if(this.session.encrypted){let c=i,u=c.getCipher(),d=c.getCertificate(),f=c.getPeerCertificate();o={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:d&&"raw"in d?d.raw:null,remoteCertificate:f&&"raw"in f?f.raw:null}}else o=null;return{remoteAddress:s,localAddress:a,security:o,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){ds.trace(Va.LogVerbosity.DEBUG,Qf,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){ds.trace(Va.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){ds.trace(Va.LogVerbosity.DEBUG,fO,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){ds.trace(Va.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let a=e.toHttp2Headers();a[mO]=t,a[TO]=this.userAgent,a[gO]="application/grpc",a[yO]="POST",a[vO]=r,a[SO]="trailers";let o;try{o=this.session.request(a)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}},c=new dO.Http2SubchannelCall(o,l,i,this,(0,hO.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}shutdown(){this.session.close(),(0,Hf.unregisterChannelzRef)(this.channelzRef)}},Jf=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){ds.trace(Va.LogVerbosity.DEBUG,Qf,(0,us.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,a)=>{var o,l,c;let u;i.realTarget?(u=(0,us.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,us.uriToString)(i.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,sc.subchannelAddressToString)(e)));let d=(0,w_.getDefaultAuthority)((o=i.realTarget)!==null&&o!==void 0?o:this.channelTarget),f=t._getConnectionOptions()||{};f.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?f.maxSessionMemory=r["grpc-node.max_session_memory"]:f.maxSessionMemory=Number.MAX_SAFE_INTEGER;let v="http://";if("secureContext"in f){if(v="https://",r["grpc.ssl_target_name_override"]){let A=r["grpc.ssl_target_name_override"];f.checkServerIdentity=(M,D)=>(0,T_.checkServerIdentity)(A,D),f.servername=A}else{let A=(c=(l=(0,us.splitHostPort)(d))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";f.servername=A}i.socket&&(f.createConnection=(A,M)=>i.socket)}else f.createConnection=(A,M)=>i.socket?i.socket:uO.connect(e);f=Object.assign(Object.assign(Object.assign({},f),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let b=Xf.connect(v+d,f);this.session=b;let I="Failed to connect";b.unref(),b.once("connect",()=>{b.removeAllListeners(),s(new Yf(b,e,r,u)),this.session=null}),b.once("close",()=>{this.session=null,setImmediate(()=>{a(`${I} (${new Date().toISOString()})`)})}),b.once("error",A=>{I=A.message,this.trace("connection failed with error "+I)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let a=t._getConnectionOptions()||{};if("secureContext"in a){if(a.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let o=r["grpc.ssl_target_name_override"];a.checkServerIdentity=(l,c)=>(0,T_.checkServerIdentity)(o,c),a.servername=o}else if("grpc.http_connect_target"in r){let o=(0,w_.getDefaultAuthority)((i=(0,us.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,us.splitHostPort)(o);a.servername=(s=l?.host)!==null&&s!==void 0?s:o}r["grpc-node.tls_enable_trace"]&&(a.enableTrace=!0)}return(0,cO.getProxiedConnection)(e,r,a).then(o=>this.createSession(e,t,r,o))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};ac.Http2SubchannelConnector=Jf});var E_=R(hs=>{"use strict";Object.defineProperty(hs,"__esModule",{value:!0});hs.getSubchannelPool=hs.SubchannelPool=void 0;var EO=aS(),bO=f_(),CO=on(),IO=Tt(),AO=__(),RO=1e4,za=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},RO),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,IO.uriToString)(e);if(s in this.pool){let o=this.pool[s];for(let l of o)if((0,CO.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,EO.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let a=new bO.Subchannel(e,t,r,i,new AO.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:a}),a.ref(),a}};hs.SubchannelPool=za;var DO=new za;function NO(n){return n?DO:new za}hs.getSubchannelPool=NO});var ep=R(fs=>{"use strict";Object.defineProperty(fs,"__esModule",{value:!0});fs.FilterStackFactory=fs.FilterStack=void 0;var oc=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};fs.FilterStack=oc;var Zf=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new oc(this.factories.map(e=>e.createFilter()))}};fs.FilterStackFactory=Zf});var tp=R(lc=>{"use strict";Object.defineProperty(lc,"__esModule",{value:!0});lc.CompressionAlgorithms=void 0;var b_=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(b_||(lc.CompressionAlgorithms=b_={}))});var uc=R(cc=>{"use strict";Object.defineProperty(cc,"__esModule",{value:!0});cc.BaseFilter=void 0;var np=class{sendMetadata(e){return _(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return _(this,null,function*(){return e})}receiveMessage(e){return _(this,null,function*(){return e})}receiveTrailers(e){return e}};cc.BaseFilter=np});var A_=R(ms=>{"use strict";Object.defineProperty(ms,"__esModule",{value:!0});ms.CompressionFilterFactory=ms.CompressionFilter=void 0;var dc=ce("zlib"),I_=tp(),OO=oe(),kO=uc(),xO=Re(),MO=n=>typeof n=="number"&&typeof I_.CompressionAlgorithms[n]=="string",ps=class{writeMessage(e,t){return _(this,null,function*(){let r=e;t&&(r=yield this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i})}readMessage(e){return _(this,null,function*(){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=yield this.decompressMessage(r)),r})}},Zr=class extends ps{compressMessage(e){return _(this,null,function*(){return e})}writeMessage(e,t){return _(this,null,function*(){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},rp=class extends ps{compressMessage(e){return new Promise((t,r)=>{dc.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{dc.inflate(e,(i,s)=>{i?r(i):t(s)})})}},ip=class extends ps{compressMessage(e){return new Promise((t,r)=>{dc.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{dc.unzip(e,(i,s)=>{i?r(i):t(s)})})}},sp=class extends ps{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function C_(n){switch(n){case"identity":return new Zr;case"deflate":return new rp;case"gzip":return new ip;default:return new sp(n)}}var hc=class extends kO.BaseFilter{constructor(e,t){var r;super(),this.sharedFilterConfig=t,this.sendCompression=new Zr,this.receiveCompression=new Zr,this.currentCompressionAlgorithm="identity";let i=e["grpc.default_compression_algorithm"];if(i!==void 0)if(MO(i)){let s=I_.CompressionAlgorithms[i],a=(r=t.serverSupportedEncodingHeader)===null||r===void 0?void 0:r.split(",");(!a||a.includes(s))&&(this.currentCompressionAlgorithm=s,this.sendCompression=C_(this.currentCompressionAlgorithm))}else xO.log(OO.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${i}`)}sendMetadata(e){return _(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=C_(i))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new Zr,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return _(this,null,function*(){var t;let r=yield e,i;return this.sendCompression instanceof Zr?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(r.message,i),flags:r.flags}})}receiveMessage(e){return _(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};ms.CompressionFilter=hc;var ap=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new hc(this.options,this.sharedFilterConfig)}};ms.CompressionFilterFactory=ap});var D_=R(gs=>{"use strict";Object.defineProperty(gs,"__esModule",{value:!0});gs.MaxMessageSizeFilterFactory=gs.MaxMessageSizeFilter=void 0;var PO=uc(),fc=oe(),R_=ct(),pc=class extends PO.BaseFilter{constructor(e){super(),this.maxSendMessageSize=fc.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=fc.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,"grpc.max_send_message_length"in e&&(this.maxSendMessageSize=e["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in e&&(this.maxReceiveMessageSize=e["grpc.max_receive_message_length"])}sendMessage(e){return _(this,null,function*(){if(this.maxSendMessageSize===-1)return e;{let t=yield e;if(t.message.length>this.maxSendMessageSize)throw{code:fc.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${t.message.length} vs. ${this.maxSendMessageSize})`,metadata:new R_.Metadata};return t}})}receiveMessage(e){return _(this,null,function*(){if(this.maxReceiveMessageSize===-1)return e;{let t=yield e;if(t.length>this.maxReceiveMessageSize)throw{code:fc.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${t.length} vs. ${this.maxReceiveMessageSize})`,metadata:new R_.Metadata};return t}})}};gs.MaxMessageSizeFilter=pc;var op=class{constructor(e){this.options=e}createFilter(){return new pc(this.options)}};gs.MaxMessageSizeFilterFactory=op});var mc=R(yn=>{"use strict";Object.defineProperty(yn,"__esModule",{value:!0});yn.deadlineToString=yn.getRelativeTimeout=yn.getDeadlineTimeoutString=yn.minDeadline=void 0;function LO(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}yn.minDeadline=LO;var FO=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function BO(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of FO){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}yn.getDeadlineTimeoutString=BO;var qO=2147483647;function UO(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>qO?1/0:r}yn.getRelativeTimeout=UO;function VO(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}yn.deadlineToString=VO});var yc=R(gc=>{"use strict";Object.defineProperty(gc,"__esModule",{value:!0});gc.restrictControlPlaneStatusCode=void 0;var vn=oe(),zO=[vn.Status.OK,vn.Status.INVALID_ARGUMENT,vn.Status.NOT_FOUND,vn.Status.ALREADY_EXISTS,vn.Status.FAILED_PRECONDITION,vn.Status.ABORTED,vn.Status.OUT_OF_RANGE,vn.Status.DATA_LOSS];function GO(n,e){return zO.includes(n)?{code:vn.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${vn.Status[n]} ${e}`}:{code:n,details:e}}gc.restrictControlPlaneStatusCode=GO});var O_=R(Tc=>{"use strict";Object.defineProperty(Tc,"__esModule",{value:!0});Tc.LoadBalancingCall=void 0;var N_=Rt(),vc=oe(),jO=mc(),Sc=ct(),Ga=nr(),KO=Tt(),WO=Re(),lp=yc(),$O=ce("http2"),HO="load_balancing_call",cp=class{constructor(e,t,r,i,s,a,o){var l,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=a,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),d="";u.length>=2&&(d=u[1]);let f=(c=(l=(0,KO.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${f}/${d}`}trace(e){WO.trace(vc.LogVerbosity.DEBUG,HO,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+Ga.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case Ga.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(o=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let d=this.metadata.clone();if(d.merge(o),d.get("authorization").length>1&&this.outputStatus({code:vc.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new Sc.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==N_.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+N_.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&d.set("grpc-timeout",(0,jO.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(d,this.host,this.methodName,{onReceiveMetadata:f=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(f)},onReceiveMessage:f=>{this.trace("Received message"),this.listener.onReceiveMessage(f)},onReceiveStatus:f=>{this.trace("Received status"),f.rstCode===$O.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(f,"REFUSED"):this.outputStatus(f,"PROCESSED")}})}catch(f){this.trace("Failed to start call on picked subchannel "+i+" with error "+f.message),this.outputStatus({code:vc.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+f.message,metadata:new Sc.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=r.onCallStarted)===null||u===void 0||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},o=>{let{code:l,details:c}=(0,lp.restrictControlPlaneStatusCode)(typeof o.code=="number"?o.code:vc.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${o.message}`);this.outputStatus({code:l,details:c,metadata:new Sc.Metadata},"PROCESSED")});break;case Ga.PickResultType.DROP:let{code:s,details:a}=(0,lp.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:a,metadata:r.status.metadata},"DROP")});break;case Ga.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:o,details:l}=(0,lp.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:o,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case Ga.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new Sc.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};Tc.LoadBalancingCall=cp});var x_=R(_c=>{"use strict";Object.defineProperty(_c,"__esModule",{value:!0});_c.ResolvingCall=void 0;var ys=oe(),wc=mc(),k_=ct(),QO=Re(),YO=yc(),JO="resolving_call",up=class{constructor(e,t,r,i,s,a){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&ys.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(ys.Status.CANCELLED,"Cancelled by parent call")}),r.flags&ys.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,wc.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){QO.trace(ys.LogVerbosity.DEBUG,JO,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,wc.deadlineToString)(this.deadline));let e=(0,wc.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(ys.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==ys.Status.OK){let{code:r,details:i}=(0,YO.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new k_.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,wc.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new k_.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};_c.ResolvingCall=up});var M_=R(Sr=>{"use strict";Object.defineProperty(Sr,"__esModule",{value:!0});Sr.RetryingCall=Sr.MessageBufferTracker=Sr.RetryThrottler=void 0;var Ec=oe(),XO=ct(),ZO=Re(),ek="retrying_call",hp=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};Sr.RetryThrottler=hp;var fp=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};Sr.MessageBufferTracker=fp;var dp="grpc-previous-rpc-attempts",pp=class{constructor(e,t,r,i,s,a,o,l,c){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=a,this.callNumber=o,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){ZO.trace(Ec.LogVerbosity.DEBUG,ek,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new XO.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(Ec.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===Ec.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,a;if(this.state!=="RETRY"){t(!1);return}(!((a=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&a!==void 0)||a)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,a;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let o;if(r===null)o=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else o=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},o)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((a=this.retryThrottler)===null||a===void 0||a.addCallFailed(),this.maybeRetryCall(r,o=>{o||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===Ec.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",a=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},a*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set(dp,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:a=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&a.set(dp,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(a)},onReceiveMessage:a=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(a)},onReceiveStatus:a=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&a.metadata.set(dp,`${r}`),this.handleChildStatus(a,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),a={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(a),a.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[o,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(o)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let o=this.underlyingCalls[this.committedCallIndex];a.callback=e.callback,o.state==="ACTIVE"&&o.nextMessageToSend===s&&o.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};Sr.RetryingCall=pp});var Cc=R(bc=>{"use strict";Object.defineProperty(bc,"__esModule",{value:!0});bc.BaseSubchannelWrapper=void 0;var mp=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};bc.BaseSubchannelWrapper=mp});var F_=R(Rc=>{"use strict";Object.defineProperty(Rc,"__esModule",{value:!0});Rc.InternalChannel=void 0;var tk=ll(),nk=sS(),rk=E_(),P_=nr(),ja=oe(),ik=ep(),sk=A_(),L_=sn(),gp=Re(),ak=D_(),ok=Gf(),Ic=Tt(),Sn=Rt(),Ka=Xr(),lk=O_(),ck=mc(),uk=x_(),yp=$f(),dk=yc(),vp=M_(),hk=Cc(),fk=2147483647,pk=1e3,mk=30*60*1e3,Ac=new Map,gk=1<<24,yk=1<<20,Sp=class extends hk.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,a)=>{t.throttleKeepalive(a)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},Tp=class{constructor(e,t,r){var i,s,a,o,l,c,u,d;if(this.credentials=t,this.options=r,this.connectivityState=Sn.ConnectivityState.IDLE,this.currentPicker=new P_.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new Ka.ChannelzCallTracker,this.childrenTracker=new Ka.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof tk.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let f=(0,Ic.parseUri)(e);if(f===null)throw new Error(`Could not parse target name "${e}"`);let v=(0,L_.mapUriDefaultScheme)(f);if(v===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},fk),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new Ka.ChannelzTrace,this.channelzRef=(0,Ka.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,L_.getDefaultAuthority)(v);let b=(0,ok.mapProxyName)(v,r);this.target=b.target,this.options=Object.assign({},this.options,b.extraOptions),this.subchannelPool=(0,rk.getSubchannelPool)(((a=r["grpc.use_local_subchannel_pool"])!==null&&a!==void 0?a:0)===0),this.retryBufferTracker=new vp.MessageBufferTracker((o=r["grpc.retry_buffer_size"])!==null&&o!==void 0?o:gk,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:yk),this.keepaliveTime=(c=r["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=r["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:mk,pk);let I={createSubchannel:(M,D)=>{let B=this.subchannelPool.getOrCreateSubchannel(this.target,M,Object.assign({},this.options,D),this.credentials);B.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",B.getChannelzRef());let P=new Sp(B,this);return this.wrappedSubchannels.add(P),P},updateState:(M,D)=>{this.currentPicker=D;let B=this.pickQueue.slice();this.pickQueue=[],B.length>0&&this.callRefTimerUnref();for(let P of B)P.doPick();this.updateState(M)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:M=>{this.channelzEnabled&&this.childrenTracker.refChild(M)},removeChannelzChild:M=>{this.channelzEnabled&&this.childrenTracker.unrefChild(M)}};this.resolvingLoadBalancer=new nk.ResolvingLoadBalancer(this.target,I,r,(M,D)=>{M.retryThrottling?Ac.set(this.getTarget(),new vp.RetryThrottler(M.retryThrottling.maxTokens,M.retryThrottling.tokenRatio,Ac.get(this.getTarget()))):Ac.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=D,this.currentResolutionError=null,process.nextTick(()=>{let B=this.configSelectionQueue;this.configSelectionQueue=[],B.length>0&&this.callRefTimerUnref();for(let P of B)P.getConfig()})},M=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+M.code+' and details "'+M.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,dk.restrictControlPlaneStatusCode)(M.code,M.details)),{metadata:M.metadata}));let D=this.configSelectionQueue;this.configSelectionQueue=[],D.length>0&&this.callRefTimerUnref();for(let B of D)B.reportResolverError(M)}),this.filterStackFactory=new ik.FilterStackFactory([new ak.MaxMessageSizeFilterFactory(this.options),new sk.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let A=new Error;(0,gp.trace)(ja.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((d=A.stack)===null||d===void 0?void 0:d.substring(A.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,gp.trace)(t??ja.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,Ic.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,gp.trace)(ja.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,Ic.uriToString)(this.target)+" "+Sn.ConnectivityState[this.connectivityState]+" -> "+Sn.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Sn.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==Sn.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(Sn.ConnectivityState.IDLE),this.currentPicker=new P_.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(r=(t=this.idleTimer).unref)===null||r===void 0||r.call(t)}maybeStartIdleTimer(){this.connectivityState!==Sn.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===ja.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let a=(0,yp.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+a+'] method="'+t+'"'),new lk.LoadBalancingCall(this,e,t,r,i,s,a)}createRetryingCall(e,t,r,i,s){let a=(0,yp.getNextCallNumber)();return this.trace("createRetryingCall ["+a+'] method="'+t+'"'),new vp.RetryingCall(this,e,t,r,i,s,a,this.retryBufferTracker,Ac.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let a=(0,yp.getNextCallNumber)();this.trace("createResolvingCall ["+a+'] method="'+e+'", deadline='+(0,ck.deadlineToString)(t));let o={deadline:t,flags:s??ja.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new uk.ResolvingCall(this,e,o,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),a);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(Sn.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,Ka.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,Ic.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===Sn.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let a=t instanceof Date?t:new Date(t),o=new Date;if(t===-1/0||a<=o){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},a.getTime()-o.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===Sn.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};Rc.InternalChannel=Tp});var Eh=R(Dc=>{"use strict";Object.defineProperty(Dc,"__esModule",{value:!0});Dc.ChannelImplementation=void 0;var vk=ll(),Sk=F_(),wp=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof vk.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new Sk.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};Dc.ChannelImplementation=wp});var $_=R(Ft=>{"use strict";Object.defineProperty(Ft,"__esModule",{value:!0});Ft.Http2ServerCallStream=Ft.ServerDuplexStreamImpl=Ft.ServerWritableStreamImpl=Ft.ServerReadableStreamImpl=Ft.ServerUnaryCallImpl=void 0;var z_=ce("events"),vs=ce("http2"),bp=ce("stream"),G_=ce("zlib"),j_=ce("util"),we=oe(),Cp=ct(),Tk=Kf(),K_=Re(),$a=nl(),W_="server_call",wk=(0,j_.promisify)(G_.unzip),_k=(0,j_.promisify)(G_.inflate);function Wa(n){K_.trace(we.LogVerbosity.DEBUG,W_,n)}var Ek="grpc-accept-encoding",bk="grpc-encoding",B_="grpc-message",q_="grpc-status",U_="grpc-timeout",Ck=/(\d{1,8})\s*([HMSmun])/,Ik={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},Ak={[Ek]:"identity,deflate,gzip",[bk]:"identity"},V_={[vs.constants.HTTP2_HEADER_STATUS]:vs.constants.HTTP_STATUS_OK,[vs.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},Rk={waitForTrailers:!0},_p=class extends z_.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};Ft.ServerUnaryCallImpl=_p;var Nc=class extends bp.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};Ft.ServerReadableStreamImpl=Nc;var Ha=class extends bp.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new Cp.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,$a.getErrorMessage)(i),code:we.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:we.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};Ft.ServerWritableStreamImpl=Ha;var Ss=class extends bp.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new Cp.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",a=>{this.call.sendError(a),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};Ft.ServerDuplexStreamImpl=Ss;Ss.prototype._read=Nc.prototype._read;Ss.prototype._write=Ha.prototype._write;Ss.prototype._final=Ha.prototype._final;var Ep=class extends z_.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=we.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=we.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;Wa("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:we.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){return t==="deflate"?_k(e.subarray(5)):t==="gzip"?wk(e.subarray(5)):t==="identity"?e.subarray(5):Promise.reject({code:we.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},V_),Ak),t);this.stream.respond(r,Rk)}receiveMetadata(e){let t=Cp.Metadata.fromHttp2Headers(e);K_.isTracerEnabled(W_)&&Wa("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(U_);if(r.length>0){let i=r[0].toString().match(Ck);if(i===null){let o=new Error("Invalid deadline");return o.code=we.Status.OUT_OF_RANGE,this.sendError(o),t}let s=+i[1]*Ik[i[2]]|0,a=new Date;this.deadline=a.setMilliseconds(a.getMilliseconds()+s),this.deadlineTimer=setTimeout(Dk,s,this),t.remove(U_)}return t.remove(vs.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(vs.constants.HTTP2_HEADER_TE),t.remove(vs.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,a=this,o=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(d){if(s+=d.byteLength,l!==-1&&s>l){i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),r({code:we.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}o.push(d)}function u(d){if(i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),d!==void 0){r({code:we.Status.INTERNAL,details:d.message});return}if(s===0){r({code:we.Status.INTERNAL,details:"received empty unary message"});return}a.emit("receiveMessage");let f=Buffer.concat(o,s),b=f.readUInt8(0)===1?e:"identity",I=a.getDecompressedMessage(f,b);if(Buffer.isBuffer(I)){t(a.deserializeMessageWithInternalError(I));return}I.then(A=>t(a.deserializeMessageWithInternalError(A)),A=>r(A.code?A:{code:we.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return _(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,$a.getErrorMessage)(t),code:we.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,r,i){return _(this,null,function*(){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:we.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,$a.getErrorMessage)(s),code:we.Status.INTERNAL})}}})}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===we.Status.OK),!this.checkCancelled())if(Wa("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+we.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[q_]:e.code,[B_]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[q_]:e.code,[B_]:encodeURI(e.details)},V_),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:we.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:we.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new Tk.StreamDecoder,i=!1,s=!1,a=!1,o=()=>_(this,null,function*(){!a&&i&&!s&&(a=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>_(this,null,function*(){let c=r.write(l);s=!0,this.stream.pause();for(let u of c){if(this.maxReceiveMessageSize!==-1&&u.length>this.maxReceiveMessageSize){this.sendError({code:we.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${u.length} vs. ${this.maxReceiveMessageSize})`});return}this.emit("receiveMessage");let f=u.readUInt8(0)===1?t:"identity",v=yield this.getDecompressedMessage(u,f);if(!v)return;yield this.pushOrBufferMessage(e,v)}s=!1,this.stream.resume(),yield o()})),this.stream.once("end",()=>_(this,null,function*(){i=!0,yield o()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return _(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return _(this,null,function*(){if(t===null){Wa("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}Wa("Received message of length "+t.length),this.isPushPending=!0;try{let r=yield this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,$a.getErrorCode)(r);(i===null||i<we.Status.OK||i>we.Status.UNAUTHENTICATED)&&(i=we.Status.INTERNAL),e.emit("error",{details:(0,$a.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};Ft.Http2ServerCallStream=Ep;function Dk(n){let e=new Error("Deadline exceeded");e.code=we.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var Rp=R(Oc=>{"use strict";Object.defineProperty(Oc,"__esModule",{value:!0});Oc.ServerCredentials=void 0;var H_=$d(),Qa=class{static createInsecure(){return new Ip}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let a=0;a<t.length;a++){let o=t[a];if(o===null||typeof o!="object")throw new TypeError(`keyCertPair[${a}] must be an object`);if(!Buffer.isBuffer(o.private_key))throw new TypeError(`keyCertPair[${a}].private_key must be a Buffer`);if(!Buffer.isBuffer(o.cert_chain))throw new TypeError(`keyCertPair[${a}].cert_chain must be a Buffer`);i.push(o.cert_chain),s.push(o.private_key)}return new Ap({ca:e||(0,H_.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:H_.CIPHER_SUITES})}};Oc.ServerCredentials=Qa;var Ip=class extends Qa{_isSecure(){return!1}_getSettings(){return null}},Ap=class extends Qa{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var J_=R(Mc=>{"use strict";Object.defineProperty(Mc,"__esModule",{value:!0});Mc.Server=void 0;var Tr=ce("http2"),Bn=oe(),ei=$_(),Nk=Rp(),Q_=sn(),kc=Re(),Yt=on(),Ok=Tt(),yt=Xr(),xc=~(1<<31),kk=~(1<<31),xk=2e4,{HTTP2_HEADER_PATH:Y_}=Tr.constants,Mk="server";function Pk(){}function Dp(n){return{code:Bn.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function Lk(n,e){let t=Dp(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var Np=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new yt.ChannelzTrace,this.callTracker=new yt.ChannelzCallTracker,this.listenerChildrenTracker=new yt.ChannelzChildrenTracker,this.sessionChildrenTracker=new yt.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,yt.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:xc,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:xc,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:kk,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:xk,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),a=e.socket,o=a.remoteAddress?(0,Yt.stringToSubchannelAddress)(a.remoteAddress,a.remotePort):null,l=a.localAddress?(0,Yt.stringToSubchannelAddress)(a.localAddress,a.localPort):null,c;if(e.encrypted){let d=a,f=d.getCipher(),v=d.getCertificate(),b=d.getPeerCertificate();c={cipherSuiteStandardName:(t=f.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:f.standardName?null:f.name,localCertificate:v&&"raw"in v?v.raw:null,remoteCertificate:b&&"raw"in b?b.raw:null}}else c=null;return{remoteAddress:o,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){kc.trace(Bn.LogVerbosity.DEBUG,Mk,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],a;s.requestStream?s.responseStream?a="bidi":a="clientStream":s.responseStream?a="serverStream":a="unary";let o=t[i],l;if(o===void 0&&typeof s.originalName=="string"&&(o=t[s.originalName]),o!==void 0?l=o.bind(t):l=Lk(a,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,a)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof Nk.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,Ok.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,Q_.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let a={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?a.maxSessionMemory=this.options["grpc-node.max_session_memory"]:a.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(a.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let o=(v,b)=>{process.nextTick(()=>r(v,b))},l=()=>{let v;if(t._isSecure()){let b=Object.assign(a,t._getSettings());b.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,v=Tr.createSecureServer(b),v.on("secureConnection",I=>{I.on("error",A=>{this.trace("An incoming TLS connection closed with error: "+A.message)})})}else v=Tr.createServer(a);return v.setTimeout(0,Pk),this._setupHandlers(v),v},c=(v,b,I)=>v.length===0?Promise.resolve({port:b,count:I}):Promise.all(v.map(A=>{this.trace("Attempting to bind "+(0,Yt.subchannelAddressToString)(A));let M;(0,Yt.isTcpSubchannelAddress)(A)?M={host:A.host,port:b}:M=A;let D=l();return new Promise((B,P)=>{let j=Q=>{this.trace("Failed to bind "+(0,Yt.subchannelAddressToString)(A)+" with error "+Q.message),B(Q)};D.once("error",j),D.listen(M,()=>{if(this.shutdown){D.close(),B(new Error("bindAsync failed because server is shutdown"));return}let Q=D.address(),T;typeof Q=="string"?T={path:Q}:T={host:Q.address,port:Q.port};let g=(0,yt.registerChannelzSocket)((0,Yt.subchannelAddressToString)(T),()=>({localAddress:T,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(g),this.http2ServerList.push({server:D,channelzRef:g}),this.trace("Successfully bound "+(0,Yt.subchannelAddressToString)(T)),B("port"in T?T.port:b),D.removeListener("error",j)})})})).then(A=>{let M=0;for(let D of A)if(typeof D=="number"&&(M+=1,D!==b))throw new Error("Invalid state: multiple port numbers added from single address");return{port:b,count:M+I}}),u=v=>{if(v.length===0)return Promise.resolve({port:0,count:0});let b=v[0],I=l();return new Promise((A,M)=>{let D=B=>{this.trace("Failed to bind "+(0,Yt.subchannelAddressToString)(b)+" with error "+B.message),A(u(v.slice(1)))};I.once("error",D),I.listen(b,()=>{if(this.shutdown){I.close(),A({port:0,count:0});return}let B=I.address(),P={host:B.address,port:B.port},j=(0,yt.registerChannelzSocket)((0,Yt.subchannelAddressToString)(P),()=>({localAddress:P,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(j),this.http2ServerList.push({server:I,channelzRef:j}),this.trace("Successfully bound "+(0,Yt.subchannelAddressToString)(P)),A(c(v.slice(1),B.port,1)),I.removeListener("error",D)})})},d={onSuccessfulResolution:(v,b,I)=>{if(d.onSuccessfulResolution=()=>{},this.shutdown&&o(new Error("bindAsync failed because server is shutdown"),0),v.length===0){o(new Error(`No addresses resolved for port ${e}`),0);return}let A;(0,Yt.isTcpSubchannelAddress)(v[0])?v[0].port===0?A=u(v):A=c(v,v[0].port,0):A=c(v,1,0),A.then(M=>{if(M.count===0){let D=`No address added out of total ${v.length} resolved`;kc.log(Bn.LogVerbosity.ERROR,D),o(new Error(D),0)}else M.count<v.length&&kc.log(Bn.LogVerbosity.INFO,`WARNING Only ${M.count} addresses added out of total ${v.length} resolved`),o(null,M.port)},M=>{let D=`No address added out of total ${v.length} resolved`;kc.log(Bn.LogVerbosity.ERROR,D),o(new Error(D),0)})},onError:v=>{o(new Error(v.details),0)}};(0,Q_.createResolver)(s,d,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,yt.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(Tr.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,yt.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,yt.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:a}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(a),(0,yt.unregisterChannelzRef)(a)),i()}));this.sessions.forEach((s,a)=>{a.closed||(r+=1,a.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[Tr.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[Tr.constants.HTTP2_HEADER_STATUS]:Tr.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new ei.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=Bn.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[Y_],s=this._retrieveHandler(i);if(!s){this._respondWithError(Dp(i),e,r);return}let a=new ei.Http2ServerCallStream(e,s,this.options);a.once("callEnd",o=>{o===Bn.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(a.once("streamEnd",o=>{o?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),a.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),a.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(a,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),a.sendError({code:Bn.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[Y_],i=this._retrieveHandler(r);if(!i){this._respondWithError(Dp(r),e,null);return}let s=new ei.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:Bn.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),a=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:o}=t;if(o==="unary")Fk(e,t,s,a);else if(o==="clientStream")Bk(e,t,s,a);else if(o==="serverStream")qk(e,t,s,a);else if(o==="bidi")Uk(e,t,s,a);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var a,o,l,c,u;if(!this.started){s.destroy();return}let d=(0,yt.registerChannelzSocket)((a=s.socket.remoteAddress)!==null&&a!==void 0?a:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),f={ref:d,streamTracker:new yt.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,f);let v=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+v),this.sessionChildrenTracker.refChild(d));let b=null,I=null,A=!1;if(this.maxConnectionAgeMs!==xc){let D=this.maxConnectionAgeMs/10,B=Math.random()*D*2-D;b=(l=(o=setTimeout(()=>{var P,j;A=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+v);try{s.goaway(Tr.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==xc&&(I=(j=(P=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||j===void 0?void 0:j.call(P))},this.maxConnectionAgeMs+B)).unref)===null||l===void 0?void 0:l.call(o)}let M=(u=(c=setInterval(()=>{var D,B;let P=(B=(D=setTimeout(()=>{A=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+v),s.close()},this.keepaliveTimeoutMs)).unref)===null||B===void 0?void 0:B.call(D);try{s.ping((j,Q,T)=>{clearTimeout(P)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(A||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+v),this.sessionChildrenTracker.unrefChild(d),(0,yt.unregisterChannelzRef)(d)),b&&clearTimeout(b),I&&clearTimeout(I),M&&clearTimeout(M),this.sessions.delete(s)})})}};Mc.Server=Np;function Fk(n,e,t,r){return _(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new ei.ServerUnaryCallImpl(n,t,i);e.func(s,(a,o,l,c)=>{n.sendUnaryMessage(a,o,l,c)})}catch(i){n.sendError(i)}})}function Bk(n,e,t,r){let i=new ei.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(a,o,l,c){i.destroy(),n.sendUnaryMessage(a,o,l,c)}n.cancelled||(i.on("error",s),e.func(i,s))}function qk(n,e,t,r){return _(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new ei.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}})}function Uk(n,e,t,r){let i=new ei.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var X_=R(Pc=>{"use strict";Object.defineProperty(Pc,"__esModule",{value:!0});Pc.StatusBuilder=void 0;var Op=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};Pc.StatusBuilder=Op});var kp=R(wr=>{"use strict";Object.defineProperty(wr,"__esModule",{value:!0});wr.isDuration=wr.durationToMs=wr.msToDuration=void 0;function Vk(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}wr.msToDuration=Vk;function zk(n){return n.seconds*1e3+n.nanos/1e6|0}wr.durationToMs=zk;function Gk(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}wr.isDuration=Gk});var Up=R(_r=>{"use strict";var xp;Object.defineProperty(_r,"__esModule",{value:!0});_r.setup=_r.OutlierDetectionLoadBalancer=_r.OutlierDetectionLoadBalancingConfig=void 0;var Fc=Rt(),eE=oe(),ti=kp(),tE=Vp(),nE=Xn(),jk=ml(),Kk=nr(),Z_=on(),Wk=Cc(),$k=Re(),Hk="outlier_detection";function He(n){$k.trace(eE.LogVerbosity.DEBUG,Hk,n)}var qp="outlier_detection",Qk=((xp=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&xp!==void 0?xp:"true")==="true",Yk={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},Jk={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function Ts(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function Mp(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,ti.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function Lc(n,e,t){let r=t?`${t}.${e}`:e;if(Ts(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var Ya=class n{constructor(e,t,r,i,s,a,o){if(this.childPolicy=o,o.length>0&&o[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},Yk),s):null,this.failurePercentageEjection=a?Object.assign(Object.assign({},Jk),a):null}getLoadBalancerName(){return qp}toJsonObject(){return{interval:(0,ti.msToDuration)(this.intervalMs),base_ejection_time:(0,ti.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,ti.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(Mp(e,"interval"),Mp(e,"base_ejection_time"),Mp(e,"max_ejection_time"),Lc(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");Ts(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),Lc(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),Ts(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),Ts(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");Lc(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),Lc(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),Ts(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),Ts(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,ti.durationToMs)(e.interval):null,e.base_ejection_time?(0,ti.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,ti.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(nE.validateLoadBalancingConfig))}};_r.OutlierDetectionLoadBalancingConfig=Ya;var Lp=class extends Wk.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,a)=>{if(this.childSubchannelState=s,!this.ejected)for(let o of this.stateListeners)o(this,i,s,a)})}getConnectivityState(){return this.ejected?Fc.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,Fc.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,Fc.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function Pp(){return{success:0,failure:0}}var Fp=class{constructor(){this.activeBucket=Pp(),this.inactiveBucket=Pp()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=Pp()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},Bp=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===Kk.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=a=>{var o;a===eE.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(o=t.onCallEnded)===null||o===void 0||o.call(t,a)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},Bc=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new jk.ChildLoadBalancerHandler((0,tE.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,Z_.subchannelAddressToString)(t)),a=new Lp(i,s);return s?.currentEjectionTimestamp!==null&&a.eject(),s?.subchannelWrappers.push(a),a},updateState:(t,r)=>{t===Fc.ConnectivityState.READY?e.updateState(t,new Bp(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;He("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[d,f]of this.addressMap){let v=f.counter.getLastSuccesses(),b=f.counter.getLastFailures();He("Stats for "+d+": successes="+v+" failures="+b+" targetRequestVolume="+r),v+b>=r&&(i+=1,s.push(v/(v+b)))}if(He("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let a=s.reduce((d,f)=>d+f)/s.length,o=0;for(let d of s){let f=d-a;o+=f*f}let l=o/s.length,c=Math.sqrt(l),u=a-c*(t.stdev_factor/1e3);He("stdev="+c+" ejectionThreshold="+u);for(let[d,f]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let v=f.counter.getLastSuccesses(),b=f.counter.getLastFailures();if(v+b<r)continue;let I=v/(v+b);if(He("Checking candidate "+d+" successRate="+I),I<u){let A=Math.random()*100;He("Candidate "+d+" randomNumber="+A+" enforcement_percentage="+t.enforcement_percentage),A<t.enforcement_percentage&&(He("Ejecting candidate "+d),this.eject(f,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;He("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),a=i.counter.getLastFailures();s+a>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let a=s.counter.getLastSuccesses(),o=s.counter.getLastFailures();if(He("Candidate successes="+a+" failures="+o),a+o<t.request_volume)continue;if(o*100/(o+a)>t.threshold){let c=Math.random()*100;He("Candidate "+i+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(He("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(He("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),a=new Date(r.currentEjectionTimestamp.getTime());a.setMilliseconds(a.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),a<new Date&&(He("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof Ya))return;let i=new Set;for(let a of e)i.add((0,Z_.subchannelAddressToString)(a));for(let a of i)this.addressMap.has(a)||(He("Adding map entry for "+a),this.addressMap.set(a,{counter:new Fp,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let a of this.addressMap.keys())i.has(a)||(He("Removing map entry for "+a),this.addressMap.delete(a));let s=(0,nE.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){He("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let a=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(a)}else He("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{He("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let a of this.addressMap.values())this.uneject(a),a.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return qp}};_r.OutlierDetectionLoadBalancer=Bc;function Xk(){Qk&&(0,tE.registerLoadBalancerType)(qp,Bc,Ya)}_r.setup=Xk});var Vp=R(Y=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0});Y.OutlierDetectionLoadBalancingConfig=Y.BaseSubchannelWrapper=Y.registerAdminService=Y.FilterStackFactory=Y.BaseFilter=Y.PickResultType=Y.QueuePicker=Y.UnavailablePicker=Y.ChildLoadBalancerHandler=Y.subchannelAddressToString=Y.validateLoadBalancingConfig=Y.getFirstUsableConfig=Y.registerLoadBalancerType=Y.createChildChannelControlHelper=Y.BackoffTimeout=Y.durationToMs=Y.uriToString=Y.createResolver=Y.registerResolver=Y.log=Y.trace=void 0;var rE=Re();Object.defineProperty(Y,"trace",{enumerable:!0,get:function(){return rE.trace}});Object.defineProperty(Y,"log",{enumerable:!0,get:function(){return rE.log}});var iE=sn();Object.defineProperty(Y,"registerResolver",{enumerable:!0,get:function(){return iE.registerResolver}});Object.defineProperty(Y,"createResolver",{enumerable:!0,get:function(){return iE.createResolver}});var Zk=Tt();Object.defineProperty(Y,"uriToString",{enumerable:!0,get:function(){return Zk.uriToString}});var ex=kp();Object.defineProperty(Y,"durationToMs",{enumerable:!0,get:function(){return ex.durationToMs}});var tx=va();Object.defineProperty(Y,"BackoffTimeout",{enumerable:!0,get:function(){return tx.BackoffTimeout}});var qc=Xn();Object.defineProperty(Y,"createChildChannelControlHelper",{enumerable:!0,get:function(){return qc.createChildChannelControlHelper}});Object.defineProperty(Y,"registerLoadBalancerType",{enumerable:!0,get:function(){return qc.registerLoadBalancerType}});Object.defineProperty(Y,"getFirstUsableConfig",{enumerable:!0,get:function(){return qc.getFirstUsableConfig}});Object.defineProperty(Y,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return qc.validateLoadBalancingConfig}});var nx=on();Object.defineProperty(Y,"subchannelAddressToString",{enumerable:!0,get:function(){return nx.subchannelAddressToString}});var rx=ml();Object.defineProperty(Y,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return rx.ChildLoadBalancerHandler}});var zp=nr();Object.defineProperty(Y,"UnavailablePicker",{enumerable:!0,get:function(){return zp.UnavailablePicker}});Object.defineProperty(Y,"QueuePicker",{enumerable:!0,get:function(){return zp.QueuePicker}});Object.defineProperty(Y,"PickResultType",{enumerable:!0,get:function(){return zp.PickResultType}});var ix=uc();Object.defineProperty(Y,"BaseFilter",{enumerable:!0,get:function(){return ix.BaseFilter}});var sx=ep();Object.defineProperty(Y,"FilterStackFactory",{enumerable:!0,get:function(){return sx.FilterStackFactory}});var ax=yl();Object.defineProperty(Y,"registerAdminService",{enumerable:!0,get:function(){return ax.registerAdminService}});var ox=Cc();Object.defineProperty(Y,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return ox.BaseSubchannelWrapper}});var lx=Up();Object.defineProperty(Y,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return lx.OutlierDetectionLoadBalancingConfig}})});var sE=R(Uc=>{"use strict";Object.defineProperty(Uc,"__esModule",{value:!0});Uc.setup=void 0;var cx=sn(),Gp=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function ux(){(0,cx.registerResolver)("unix",Gp)}Uc.setup=ux});var uE=R(Gc=>{"use strict";Object.defineProperty(Gc,"__esModule",{value:!0});Gc.setup=void 0;var aE=ce("net"),Vc=oe(),jp=ct(),oE=sn(),lE=Tt(),dx=Re(),hx="ip_resolver";function cE(n){dx.trace(Vc.LogVerbosity.DEBUG,hx,n)}var Kp="ipv4",Wp="ipv6",fx=443,zc=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,cE("Resolver constructed for target "+(0,lE.uriToString)(e));let s=[];if(!(e.scheme===Kp||e.scheme===Wp)){this.error={code:Vc.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new jp.Metadata};return}let a=e.path.split(",");for(let o of a){let l=(0,lE.splitHostPort)(o);if(l===null){this.error={code:Vc.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${o}`,metadata:new jp.Metadata};return}if(e.scheme===Kp&&!(0,aE.isIPv4)(l.host)||e.scheme===Wp&&!(0,aE.isIPv6)(l.host)){this.error={code:Vc.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${o}`,metadata:new jp.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:fx})}this.addresses=s,cE("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function px(){(0,oE.registerResolver)(Kp,zc),(0,oE.registerResolver)(Wp,zc)}Gc.setup=px});var fE=R(Tn=>{"use strict";Object.defineProperty(Tn,"__esModule",{value:!0});Tn.setup=Tn.PickFirstLoadBalancer=Tn.shuffled=Tn.PickFirstLoadBalancingConfig=void 0;var dE=Xn(),rt=Rt(),jc=nr(),mx=Re(),gx=oe(),yx="pick_first";function $p(n){mx.trace(gx.LogVerbosity.DEBUG,yx,n)}var Ja="pick_first",vx=250,Xa=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return Ja}toJsonObject(){return{[Ja]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};Tn.PickFirstLoadBalancingConfig=Xa;var Hp=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:jc.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function hE(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}Tn.shuffled=hE;var Kc=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=rt.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,a)=>{this.onSubchannelStateUpdate(t,r,i,a)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(rt.ConnectivityState.READY,new Hp(this.currentPick)):this.children.length===0?this.updateState(rt.ConnectivityState.IDLE,new jc.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(rt.ConnectivityState.TRANSIENT_FAILURE,new jc.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(rt.ConnectivityState.CONNECTING,new jc.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==rt.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[a,o]of this.children.entries())if(e.realSubchannelEquals(o.subchannel)){r===rt.ConnectivityState.READY&&this.pickSubchannel(o.subchannel),r===rt.ConnectivityState.TRANSIENT_FAILURE&&(o.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),a===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(a+1)),o.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===rt.ConnectivityState.IDLE||i===rt.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===rt.ConnectivityState.IDLE&&($p("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},vx)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||($p("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){$p(rt.ConnectivityState[this.currentState]+" -> "+rt.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===rt.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===rt.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof Xa&&(t.getShuffleAddressList()&&(e=hE(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===rt.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return Ja}};Tn.PickFirstLoadBalancer=Kc;function Sx(){(0,dE.registerLoadBalancerType)(Ja,Kc,Xa),(0,dE.registerDefaultLoadBalancerType)(Ja)}Tn.setup=Sx});var mE=R(ws=>{"use strict";Object.defineProperty(ws,"__esModule",{value:!0});ws.setup=ws.RoundRobinLoadBalancer=void 0;var Tx=Xn(),it=Rt(),Wc=nr(),wx=on(),_x=Re(),Ex=oe(),bx="round_robin";function pE(n){_x.trace(Ex.LogVerbosity.DEBUG,bx,n)}var $c="round_robin",Qp=class n{getLoadBalancerName(){return $c}constructor(){}toJsonObject(){return{[$c]:{}}}static createFromJson(e){return new n}},Yp=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:Wc.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},Hc=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=it.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,a)=>{this.calculateAndUpdateState(),(i===it.ConnectivityState.TRANSIENT_FAILURE||i===it.ConnectivityState.IDLE)&&(a&&(this.lastError=a),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(it.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===it.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(it.ConnectivityState.READY,new Yp(e,t))}else this.countSubchannelsWithState(it.ConnectivityState.CONNECTING)>0?this.updateState(it.ConnectivityState.CONNECTING,new Wc.QueuePicker(this)):this.countSubchannelsWithState(it.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(it.ConnectivityState.TRANSIENT_FAILURE,new Wc.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(it.ConnectivityState.IDLE,new Wc.QueuePicker(this))}updateState(e,t){pE(it.ConnectivityState[this.currentState]+" -> "+it.ConnectivityState[e]),e===it.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),pE("Connect to address list "+e.map(r=>(0,wx.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===it.ConnectivityState.IDLE||i===it.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return $c}};ws.RoundRobinLoadBalancer=Hc;function Cx(){(0,Tx.registerLoadBalancerType)($c,Hc,Qp)}ws.setup=Cx});var SE=R(z=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0});z.experimental=z.addAdminServicesToServer=z.getChannelzHandlers=z.getChannelzServiceDefinition=z.InterceptorConfigurationError=z.InterceptingCall=z.RequesterBuilder=z.ListenerBuilder=z.StatusBuilder=z.getClientChannel=z.ServerCredentials=z.Server=z.setLogVerbosity=z.setLogger=z.load=z.loadObject=z.CallCredentials=z.ChannelCredentials=z.waitForClientReady=z.closeClient=z.Channel=z.makeGenericClientConstructor=z.makeClientConstructor=z.loadPackageDefinition=z.Client=z.compressionAlgorithms=z.propagate=z.connectivityState=z.status=z.logVerbosity=z.Metadata=z.credentials=void 0;var Qc=Kd();Object.defineProperty(z,"CallCredentials",{enumerable:!0,get:function(){return Qc.CallCredentials}});var Ix=Eh();Object.defineProperty(z,"Channel",{enumerable:!0,get:function(){return Ix.ChannelImplementation}});var Ax=tp();Object.defineProperty(z,"compressionAlgorithms",{enumerable:!0,get:function(){return Ax.CompressionAlgorithms}});var Rx=Rt();Object.defineProperty(z,"connectivityState",{enumerable:!0,get:function(){return Rx.ConnectivityState}});var Yc=ll();Object.defineProperty(z,"ChannelCredentials",{enumerable:!0,get:function(){return Yc.ChannelCredentials}});var gE=_h();Object.defineProperty(z,"Client",{enumerable:!0,get:function(){return gE.Client}});var Jp=oe();Object.defineProperty(z,"logVerbosity",{enumerable:!0,get:function(){return Jp.LogVerbosity}});Object.defineProperty(z,"status",{enumerable:!0,get:function(){return Jp.Status}});Object.defineProperty(z,"propagate",{enumerable:!0,get:function(){return Jp.Propagate}});var yE=Re(),Xp=Ch();Object.defineProperty(z,"loadPackageDefinition",{enumerable:!0,get:function(){return Xp.loadPackageDefinition}});Object.defineProperty(z,"makeClientConstructor",{enumerable:!0,get:function(){return Xp.makeClientConstructor}});Object.defineProperty(z,"makeGenericClientConstructor",{enumerable:!0,get:function(){return Xp.makeClientConstructor}});var Dx=ct();Object.defineProperty(z,"Metadata",{enumerable:!0,get:function(){return Dx.Metadata}});var Nx=J_();Object.defineProperty(z,"Server",{enumerable:!0,get:function(){return Nx.Server}});var Ox=Rp();Object.defineProperty(z,"ServerCredentials",{enumerable:!0,get:function(){return Ox.ServerCredentials}});var kx=X_();Object.defineProperty(z,"StatusBuilder",{enumerable:!0,get:function(){return kx.StatusBuilder}});z.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:Yc.ChannelCredentials.createInsecure,createSsl:Yc.ChannelCredentials.createSsl,createFromSecureContext:Yc.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:Qc.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:Qc.CallCredentials.createFromGoogleCredential,createEmpty:Qc.CallCredentials.createEmpty};var xx=n=>n.close();z.closeClient=xx;var Mx=(n,e,t)=>n.waitForReady(e,t);z.waitForClientReady=Mx;var Px=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};z.loadObject=Px;var Lx=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};z.load=Lx;var Fx=n=>{yE.setLogger(n)};z.setLogger=Fx;var Bx=n=>{yE.setLoggerVerbosity(n)};z.setLogVerbosity=Bx;var qx=n=>gE.Client.prototype.getChannel.call(n);z.getClientChannel=qx;var Jc=Sh();Object.defineProperty(z,"ListenerBuilder",{enumerable:!0,get:function(){return Jc.ListenerBuilder}});Object.defineProperty(z,"RequesterBuilder",{enumerable:!0,get:function(){return Jc.RequesterBuilder}});Object.defineProperty(z,"InterceptingCall",{enumerable:!0,get:function(){return Jc.InterceptingCall}});Object.defineProperty(z,"InterceptorConfigurationError",{enumerable:!0,get:function(){return Jc.InterceptorConfigurationError}});var vE=Xr();Object.defineProperty(z,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return vE.getChannelzServiceDefinition}});Object.defineProperty(z,"getChannelzHandlers",{enumerable:!0,get:function(){return vE.getChannelzHandlers}});var Ux=yl();Object.defineProperty(z,"addAdminServicesToServer",{enumerable:!0,get:function(){return Ux.addAdminServicesToServer}});var Vx=Vp();z.experimental=Vx;var zx=zf(),Gx=sE(),jx=uE(),Kx=fE(),Wx=mE(),$x=Up(),Hx=Xr();zx.setup(),Gx.setup(),jx.setup(),Kx.setup(),Wx.setup(),$x.setup(),Hx.setup()});import{inspect as Qx,TextEncoder as Yx,TextDecoder as Jx}from"util";import{randomBytes as Xx}from"crypto";var Gv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},jv={};var Qn,xd;(function(){var n;function e(T,g){function y(){}y.prototype=g.prototype,T.D=g.prototype,T.prototype=new y,T.prototype.constructor=T,T.C=function(S,p,w){for(var h=Array(arguments.length-2),m=2;m<arguments.length;m++)h[m-2]=arguments[m];return g.prototype[p].apply(S,h)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(T,g,y){y||(y=0);var S=Array(16);if(typeof g=="string")for(var p=0;16>p;++p)S[p]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(p=0;16>p;++p)S[p]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=T.g[0],y=T.g[1],p=T.g[2];var w=T.g[3],h=g+(w^y&(p^w))+S[0]+3614090360&4294967295;g=y+(h<<7&4294967295|h>>>25),h=w+(p^g&(y^p))+S[1]+3905402710&4294967295,w=g+(h<<12&4294967295|h>>>20),h=p+(y^w&(g^y))+S[2]+606105819&4294967295,p=w+(h<<17&4294967295|h>>>15),h=y+(g^p&(w^g))+S[3]+3250441966&4294967295,y=p+(h<<22&4294967295|h>>>10),h=g+(w^y&(p^w))+S[4]+4118548399&4294967295,g=y+(h<<7&4294967295|h>>>25),h=w+(p^g&(y^p))+S[5]+1200080426&4294967295,w=g+(h<<12&4294967295|h>>>20),h=p+(y^w&(g^y))+S[6]+2821735955&4294967295,p=w+(h<<17&4294967295|h>>>15),h=y+(g^p&(w^g))+S[7]+4249261313&4294967295,y=p+(h<<22&4294967295|h>>>10),h=g+(w^y&(p^w))+S[8]+1770035416&4294967295,g=y+(h<<7&4294967295|h>>>25),h=w+(p^g&(y^p))+S[9]+2336552879&4294967295,w=g+(h<<12&4294967295|h>>>20),h=p+(y^w&(g^y))+S[10]+4294925233&4294967295,p=w+(h<<17&4294967295|h>>>15),h=y+(g^p&(w^g))+S[11]+2304563134&4294967295,y=p+(h<<22&4294967295|h>>>10),h=g+(w^y&(p^w))+S[12]+1804603682&4294967295,g=y+(h<<7&4294967295|h>>>25),h=w+(p^g&(y^p))+S[13]+4254626195&4294967295,w=g+(h<<12&4294967295|h>>>20),h=p+(y^w&(g^y))+S[14]+2792965006&4294967295,p=w+(h<<17&4294967295|h>>>15),h=y+(g^p&(w^g))+S[15]+1236535329&4294967295,y=p+(h<<22&4294967295|h>>>10),h=g+(p^w&(y^p))+S[1]+4129170786&4294967295,g=y+(h<<5&4294967295|h>>>27),h=w+(y^p&(g^y))+S[6]+3225465664&4294967295,w=g+(h<<9&4294967295|h>>>23),h=p+(g^y&(w^g))+S[11]+643717713&4294967295,p=w+(h<<14&4294967295|h>>>18),h=y+(w^g&(p^w))+S[0]+3921069994&4294967295,y=p+(h<<20&4294967295|h>>>12),h=g+(p^w&(y^p))+S[5]+3593408605&4294967295,g=y+(h<<5&4294967295|h>>>27),h=w+(y^p&(g^y))+S[10]+38016083&4294967295,w=g+(h<<9&4294967295|h>>>23),h=p+(g^y&(w^g))+S[15]+3634488961&4294967295,p=w+(h<<14&4294967295|h>>>18),h=y+(w^g&(p^w))+S[4]+3889429448&4294967295,y=p+(h<<20&4294967295|h>>>12),h=g+(p^w&(y^p))+S[9]+568446438&4294967295,g=y+(h<<5&4294967295|h>>>27),h=w+(y^p&(g^y))+S[14]+3275163606&4294967295,w=g+(h<<9&4294967295|h>>>23),h=p+(g^y&(w^g))+S[3]+4107603335&4294967295,p=w+(h<<14&4294967295|h>>>18),h=y+(w^g&(p^w))+S[8]+1163531501&4294967295,y=p+(h<<20&4294967295|h>>>12),h=g+(p^w&(y^p))+S[13]+2850285829&4294967295,g=y+(h<<5&4294967295|h>>>27),h=w+(y^p&(g^y))+S[2]+4243563512&4294967295,w=g+(h<<9&4294967295|h>>>23),h=p+(g^y&(w^g))+S[7]+1735328473&4294967295,p=w+(h<<14&4294967295|h>>>18),h=y+(w^g&(p^w))+S[12]+2368359562&4294967295,y=p+(h<<20&4294967295|h>>>12),h=g+(y^p^w)+S[5]+4294588738&4294967295,g=y+(h<<4&4294967295|h>>>28),h=w+(g^y^p)+S[8]+2272392833&4294967295,w=g+(h<<11&4294967295|h>>>21),h=p+(w^g^y)+S[11]+1839030562&4294967295,p=w+(h<<16&4294967295|h>>>16),h=y+(p^w^g)+S[14]+4259657740&4294967295,y=p+(h<<23&4294967295|h>>>9),h=g+(y^p^w)+S[1]+2763975236&4294967295,g=y+(h<<4&4294967295|h>>>28),h=w+(g^y^p)+S[4]+1272893353&4294967295,w=g+(h<<11&4294967295|h>>>21),h=p+(w^g^y)+S[7]+4139469664&4294967295,p=w+(h<<16&4294967295|h>>>16),h=y+(p^w^g)+S[10]+3200236656&4294967295,y=p+(h<<23&4294967295|h>>>9),h=g+(y^p^w)+S[13]+681279174&4294967295,g=y+(h<<4&4294967295|h>>>28),h=w+(g^y^p)+S[0]+3936430074&4294967295,w=g+(h<<11&4294967295|h>>>21),h=p+(w^g^y)+S[3]+3572445317&4294967295,p=w+(h<<16&4294967295|h>>>16),h=y+(p^w^g)+S[6]+76029189&4294967295,y=p+(h<<23&4294967295|h>>>9),h=g+(y^p^w)+S[9]+3654602809&4294967295,g=y+(h<<4&4294967295|h>>>28),h=w+(g^y^p)+S[12]+3873151461&4294967295,w=g+(h<<11&4294967295|h>>>21),h=p+(w^g^y)+S[15]+530742520&4294967295,p=w+(h<<16&4294967295|h>>>16),h=y+(p^w^g)+S[2]+3299628645&4294967295,y=p+(h<<23&4294967295|h>>>9),h=g+(p^(y|~w))+S[0]+4096336452&4294967295,g=y+(h<<6&4294967295|h>>>26),h=w+(y^(g|~p))+S[7]+1126891415&4294967295,w=g+(h<<10&4294967295|h>>>22),h=p+(g^(w|~y))+S[14]+2878612391&4294967295,p=w+(h<<15&4294967295|h>>>17),h=y+(w^(p|~g))+S[5]+4237533241&4294967295,y=p+(h<<21&4294967295|h>>>11),h=g+(p^(y|~w))+S[12]+1700485571&4294967295,g=y+(h<<6&4294967295|h>>>26),h=w+(y^(g|~p))+S[3]+2399980690&4294967295,w=g+(h<<10&4294967295|h>>>22),h=p+(g^(w|~y))+S[10]+4293915773&4294967295,p=w+(h<<15&4294967295|h>>>17),h=y+(w^(p|~g))+S[1]+2240044497&4294967295,y=p+(h<<21&4294967295|h>>>11),h=g+(p^(y|~w))+S[8]+1873313359&4294967295,g=y+(h<<6&4294967295|h>>>26),h=w+(y^(g|~p))+S[15]+4264355552&4294967295,w=g+(h<<10&4294967295|h>>>22),h=p+(g^(w|~y))+S[6]+2734768916&4294967295,p=w+(h<<15&4294967295|h>>>17),h=y+(w^(p|~g))+S[13]+1309151649&4294967295,y=p+(h<<21&4294967295|h>>>11),h=g+(p^(y|~w))+S[4]+4149444226&4294967295,g=y+(h<<6&4294967295|h>>>26),h=w+(y^(g|~p))+S[11]+3174756917&4294967295,w=g+(h<<10&4294967295|h>>>22),h=p+(g^(w|~y))+S[2]+718787259&4294967295,p=w+(h<<15&4294967295|h>>>17),h=y+(w^(p|~g))+S[9]+3951481745&4294967295,T.g[0]=T.g[0]+g&4294967295,T.g[1]=T.g[1]+(p+(h<<21&4294967295|h>>>11))&4294967295,T.g[2]=T.g[2]+p&4294967295,T.g[3]=T.g[3]+w&4294967295}r.prototype.u=function(T,g){g===void 0&&(g=T.length);for(var y=g-this.blockSize,S=this.B,p=this.h,w=0;w<g;){if(p==0)for(;w<=y;)i(this,T,w),w+=this.blockSize;if(typeof T=="string"){for(;w<g;)if(S[p++]=T.charCodeAt(w++),p==this.blockSize){i(this,S),p=0;break}}else for(;w<g;)if(S[p++]=T[w++],p==this.blockSize){i(this,S),p=0;break}}this.h=p,this.o+=g},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var g=1;g<T.length-8;++g)T[g]=0;var y=8*this.o;for(g=T.length-8;g<T.length;++g)T[g]=y&255,y/=256;for(this.u(T),T=Array(16),g=y=0;4>g;++g)for(var S=0;32>S;S+=8)T[y++]=this.g[g]>>>S&255;return T};function s(T,g){var y=o;return Object.prototype.hasOwnProperty.call(y,T)?y[T]:y[T]=g(T)}function a(T,g){this.h=g;for(var y=[],S=!0,p=T.length-1;0<=p;p--){var w=T[p]|0;S&&w==g||(y[p]=w,S=!1)}this.g=y}var o={};function l(T){return-128<=T&&128>T?s(T,function(g){return new a([g|0],0>g?-1:0)}):new a([T|0],0>T?-1:0)}function c(T){if(isNaN(T)||!isFinite(T))return d;if(0>T)return A(c(-T));for(var g=[],y=1,S=0;T>=y;S++)g[S]=T/y|0,y*=4294967296;return new a(g,0)}function u(T,g){if(T.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(T.charAt(0)=="-")return A(u(T.substring(1),g));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=c(Math.pow(g,8)),S=d,p=0;p<T.length;p+=8){var w=Math.min(8,T.length-p),h=parseInt(T.substring(p,p+w),g);8>w?(w=c(Math.pow(g,w)),S=S.j(w).add(c(h))):(S=S.j(y),S=S.add(c(h)))}return S}var d=l(0),f=l(1),v=l(16777216);n=a.prototype,n.m=function(){if(I(this))return-A(this).m();for(var T=0,g=1,y=0;y<this.g.length;y++){var S=this.i(y);T+=(0<=S?S:4294967296+S)*g,g*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(b(this))return"0";if(I(this))return"-"+A(this).toString(T);for(var g=c(Math.pow(T,6)),y=this,S="";;){var p=P(y,g).g;y=M(y,p.j(g));var w=((0<y.g.length?y.g[0]:y.h)>>>0).toString(T);if(y=p,b(y))return w+S;for(;6>w.length;)w="0"+w;S=w+S}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function b(T){if(T.h!=0)return!1;for(var g=0;g<T.g.length;g++)if(T.g[g]!=0)return!1;return!0}function I(T){return T.h==-1}n.l=function(T){return T=M(this,T),I(T)?-1:b(T)?0:1};function A(T){for(var g=T.g.length,y=[],S=0;S<g;S++)y[S]=~T.g[S];return new a(y,~T.h).add(f)}n.abs=function(){return I(this)?A(this):this},n.add=function(T){for(var g=Math.max(this.g.length,T.g.length),y=[],S=0,p=0;p<=g;p++){var w=S+(this.i(p)&65535)+(T.i(p)&65535),h=(w>>>16)+(this.i(p)>>>16)+(T.i(p)>>>16);S=h>>>16,w&=65535,h&=65535,y[p]=h<<16|w}return new a(y,y[y.length-1]&-2147483648?-1:0)};function M(T,g){return T.add(A(g))}n.j=function(T){if(b(this)||b(T))return d;if(I(this))return I(T)?A(this).j(A(T)):A(A(this).j(T));if(I(T))return A(this.j(A(T)));if(0>this.l(v)&&0>T.l(v))return c(this.m()*T.m());for(var g=this.g.length+T.g.length,y=[],S=0;S<2*g;S++)y[S]=0;for(S=0;S<this.g.length;S++)for(var p=0;p<T.g.length;p++){var w=this.i(S)>>>16,h=this.i(S)&65535,m=T.i(p)>>>16,q=T.i(p)&65535;y[2*S+2*p]+=h*q,D(y,2*S+2*p),y[2*S+2*p+1]+=w*q,D(y,2*S+2*p+1),y[2*S+2*p+1]+=h*m,D(y,2*S+2*p+1),y[2*S+2*p+2]+=w*m,D(y,2*S+2*p+2)}for(S=0;S<g;S++)y[S]=y[2*S+1]<<16|y[2*S];for(S=g;S<2*g;S++)y[S]=0;return new a(y,0)};function D(T,g){for(;(T[g]&65535)!=T[g];)T[g+1]+=T[g]>>>16,T[g]&=65535,g++}function B(T,g){this.g=T,this.h=g}function P(T,g){if(b(g))throw Error("division by zero");if(b(T))return new B(d,d);if(I(T))return g=P(A(T),g),new B(A(g.g),A(g.h));if(I(g))return g=P(T,A(g)),new B(A(g.g),g.h);if(30<T.g.length){if(I(T)||I(g))throw Error("slowDivide_ only works with positive integers.");for(var y=f,S=g;0>=S.l(T);)y=j(y),S=j(S);var p=Q(y,1),w=Q(S,1);for(S=Q(S,2),y=Q(y,2);!b(S);){var h=w.add(S);0>=h.l(T)&&(p=p.add(y),w=h),S=Q(S,1),y=Q(y,1)}return g=M(T,p.j(g)),new B(p,g)}for(p=d;0<=T.l(g);){for(y=Math.max(1,Math.floor(T.m()/g.m())),S=Math.ceil(Math.log(y)/Math.LN2),S=48>=S?1:Math.pow(2,S-48),w=c(y),h=w.j(g);I(h)||0<h.l(T);)y-=S,w=c(y),h=w.j(g);b(w)&&(w=f),p=p.add(w),T=M(T,h)}return new B(p,T)}n.A=function(T){return P(this,T).h},n.and=function(T){for(var g=Math.max(this.g.length,T.g.length),y=[],S=0;S<g;S++)y[S]=this.i(S)&T.i(S);return new a(y,this.h&T.h)},n.or=function(T){for(var g=Math.max(this.g.length,T.g.length),y=[],S=0;S<g;S++)y[S]=this.i(S)|T.i(S);return new a(y,this.h|T.h)},n.xor=function(T){for(var g=Math.max(this.g.length,T.g.length),y=[],S=0;S<g;S++)y[S]=this.i(S)^T.i(S);return new a(y,this.h^T.h)};function j(T){for(var g=T.g.length+1,y=[],S=0;S<g;S++)y[S]=T.i(S)<<1|T.i(S-1)>>>31;return new a(y,T.h)}function Q(T,g){var y=g>>5;g%=32;for(var S=T.g.length-y,p=[],w=0;w<S;w++)p[w]=0<g?T.i(w+y)>>>g|T.i(w+y+1)<<32-g:T.i(w+y);return new a(p,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,xd=jv.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=c,a.fromString=u,Qn=jv.Integer=a}).apply(typeof Gv<"u"?Gv:typeof self<"u"?self:typeof window<"u"?window:{});var di=hv(SE(),1),Nb=hv(Df(),1);var TE="@firebase/firestore",wE="4.6.2";var ze=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ze.UNAUTHENTICATED=new ze(null);ze.GOOGLE_CREDENTIALS=new ze("google-credentials-uid");ze.FIRST_PARTY=new ze("first-party-uid");ze.MOCK_USER=new ze("mock-user");var Zx="10.12.0";var ta=Zx;function eM(n){ta=n}function tM(n){return Qx(n,{depth:100})}var Nr=new bv("@firebase/firestore");function Ds(){return Nr.logLevel}function Ob(n){Nr.setLogLevel(n)}function x(n,...e){if(Nr.logLevel<=rn.DEBUG){let t=e.map(ly);Nr.debug(`Firestore (${ta}): ${n}`,...t)}}function be(n,...e){if(Nr.logLevel<=rn.ERROR){let t=e.map(ly);Nr.error(`Firestore (${ta}): ${n}`,...t)}}function qt(n,...e){if(Nr.logLevel<=rn.WARN){let t=e.map(ly);Nr.warn(`Firestore (${ta}): ${n}`,...t)}}function ly(n){if(typeof n=="string")return n;try{return tM(n)}catch{return n}}function V(n="Unexpected state"){let e=`FIRESTORE (${ta}) INTERNAL ASSERTION FAILED: `+n;throw be(e),new Error(e)}function K(n,e){n||V()}function kb(n,e){n||V()}function U(n,e){return n}var C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},N=class extends Ev{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Me=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var lu=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},lm=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ze.UNAUTHENTICATED))}shutdown(){}},cm=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},um=class{constructor(e){this.authProvider=e,this.currentUser=ze.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new Me;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new Me,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let l=s;e.enqueueRetryable(()=>_(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},o=l=>{x("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.tokenListener),a()};this.authProvider.onInit(l=>o(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?o(l):(x("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Me)}},0),a()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(x("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(K(typeof r.accessToken=="string"),new lu(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.tokenListener)}getUser(){let e=this.auth&&this.auth.getUid();return K(e===null||typeof e=="string"),new ze(e)}},dm=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=ze.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},hm=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new dm(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(ze.FIRST_PARTY))}shutdown(){}invalidateToken(){}},fm=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},pm=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){let r=s=>{s.error!=null&&x("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,x("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{x("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):x("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(K(typeof t.token=="string"),this.latestAppCheckToken=t.token,new fm(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.tokenListener)}};function nM(n){if(!n)return new lm;switch(n.type){case"firstParty":return new hm(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new N(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function rM(n){return Xx(n)}var cu=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=rM(40);for(let a=0;a<s.length;++a)r.length<i&&s[a]<t&&(r+=e.charAt(s[a]%e.length))}return r}};function J(n,e){return n<e?-1:n>e?1:0}function hi(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}function xb(n){return n+"\0"}var _E=-62135596800,EE=1e6,Ce=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new N(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new N(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<_E)throw new N(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new N(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*EE);return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/EE}_compareTo(e){return this.seconds===e.seconds?J(this.nanoseconds,e.nanoseconds):J(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-_E,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};var $=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new Ce(0,0))}static max(){return new n(new Ce(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var bE="__name__",uu=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&V(),r===void 0?r=e.length-t:r>e.length-t&&V(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),a=t.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},re=class n extends uu{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new N(C.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},iM=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Le=class n extends uu{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return iM.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===bE}static keyField(){return new n([bE])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new N(C.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;i<e.length;){let o=e[i];if(o==="\\"){if(i+1===e.length)throw new N(C.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new N(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else o==="`"?(a=!a,i++):o==="."&&!a?(s(),i++):(r+=o,i++)}if(s(),a)throw new N(C.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var F=class n{constructor(e){this.path=e}static fromPath(e){return new n(re.fromString(e))}static fromName(e){return new n(re.fromString(e).popFirst(5))}static empty(){return new n(re.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&re.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return re.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new re(e.slice()))}};var Bs=-1,sM=0,mm=(()=>{class n{constructor(t,r,i,s){this.indexId=t,this.collectionGroup=r,this.fields=i,this.indexState=s}}return n.UNKNOWN_ID=-1,n})();function cy(n){return n.fields.find(e=>e.kind===2)}function fi(n){return n.fields.filter(e=>e.kind!==2)}function aM(n){let e=fi(n);return e.length===0?0:e[e.length-1].kind}function oM(n){return`id=${n.indexId}|cg=${n.collectionGroup}|f=${n.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}var Ps=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var ho=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(sM,Ut.min())}};function Mb(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=$.fromTimestamp(r===1e9?new Ce(t+1,0):new Ce(t,r));return new Ut(i,F.empty(),e)}function Pb(n){return new Ut(n.readTime,n.key,Bs)}var Ut=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n($.min(),F.empty(),Bs)}static max(){return new n($.max(),F.empty(),Bs)}};function uy(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=F.comparator(n.documentKey,e.documentKey),t!==0)?t:J(n.largestBatchId,e.largestBatchId)}var Lb="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",du=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Vr(n){return _(this,null,function*(){if(n.code===C.FAILED_PRECONDITION&&n.message===Lb)x("LocalStore","Unexpectedly lost primary lease");else throw n})}var E=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&V(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,a=!1;e.forEach(o=>{++i,o.next(()=>{++s,a&&s===i&&t()},l=>r(l))}),a=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,a=new Array(s),o=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{a[c]=u,++o,o===s&&r(a)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var Et="SimpleDb",lM=3,hu=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new Me,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new ui(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=r=>{let i=dy(r.target.error);this.completionDeferred.reject(new ui(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new ui(t,s)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(x(Et,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;!this.aborted&&typeof e.commit=="function"&&e.commit()}store(e){let t=this.transaction.objectStore(e);return new ym(t)}},Or=class n{constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,n.getIOSVersion(ya())===12.2&&be("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return x(Et,"Removing database:",e),ri(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!_v())return!1;if(n.isMockPersistence())return!0;let e=ya(),t=n.getIOSVersion(e),r=0<t&&t<10,i=Fb(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static isMockPersistence(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}ensureDb(e){return _(this,null,function*(){return this.db||(x(Et,"Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let a=s.target.result;t(a)},i.onblocked=()=>{r(new ui(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let a=s.target.error;a.name==="VersionError"?r(new N(C.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?r(new N(C.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):r(new ui(e,a))},i.onupgradeneeded=s=>{x(Et,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let a=s.target.result;this.schemaConverter.createOrUpgrade(a,i.transaction,s.oldVersion,this.version).next(()=>{x(Et,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=t=>this.versionchangelistener(t)),this.db})}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return _(this,null,function*(){let s=t==="readonly",a=0;for(;;){++a;try{this.db=yield this.ensureDb(e);let o=hu.open(this.db,e,s?"readonly":"readwrite",r),l=i(o).next(c=>(o.maybeCommit(),c)).catch(c=>(o.abort(c),E.reject(c))).toPromise();return l.catch(()=>{}),yield o.completionPromise,l}catch(o){let l=o,c=l.name!=="FirebaseError"&&a<lM;if(x(Et,"Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function Fb(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var gm=class{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return ri(this.dbCursor.delete())}},ui=class extends N{constructor(e,t){super(C.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function zr(n){return n.name==="IndexedDbTransactionError"}var ym=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(x(Et,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(x(Et,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ri(r)}add(e){x(Et,"ADD",this.store.name,e,e);let t=this.store.add(e);return ri(t)}get(e){let t=this.store.get(e);return ri(t).next(r=>(r===void 0&&(r=null),x(Et,"GET",this.store.name,e,r),r))}delete(e){x(Et,"DELETE",this.store.name,e);let t=this.store.delete(e);return ri(t)}count(){x(Et,"COUNT",this.store.name);let e=this.store.count();return ri(e)}loadAll(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new E((a,o)=>{s.onerror=l=>{o(l.target.error)},s.onsuccess=l=>{a(l.target.result)}})}else{let s=this.cursor(r),a=[];return this.iterateCursor(s,(o,l)=>{a.push(l)}).next(()=>a)}}loadFirst(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new E((i,s)=>{r.onerror=a=>{s(a.target.error)},r.onsuccess=a=>{i(a.target.result)}})}deleteAll(e,t){x(Et,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let i=this.cursor(r);return this.iterateCursor(i,(s,a,o)=>o.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.iterateCursor(i,t)}iterateSerial(e){let t=this.cursor({});return new E((r,i)=>{t.onerror=s=>{let a=dy(s.target.error);i(a)},t.onsuccess=s=>{let a=s.target.result;if(!a){r();return}e(a.primaryKey,a.value).next(o=>{o?a.continue():r()})}})}iterateCursor(e,t){let r=[];return new E((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{let o=a.target.result;if(!o){i();return}let l=new gm(o),c=t(o.primaryKey,o.value,l);if(c instanceof E){let u=c.catch(d=>(l.done(),E.reject(d)));r.push(u)}l.isDone?i():l.skipToKey===null?o.continue():o.continue(l.skipToKey)}}).next(()=>E.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}else return this.store.openCursor(e.range,t)}};function ri(n){return new E((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=dy(r.target.error);t(i)}})}var CE=!1;function dy(n){let e=Or.getIOSVersion(ya());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new N("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return CE||(CE=!0,setTimeout(()=>{throw r},0)),r}}return n}var so="IndexBackfiller",cM=15*1e3,uM=60*1e3,dM=50,vm=class{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(cM)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}schedule(e){x(so,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>_(this,null,function*(){this.task=null;try{let t=yield this.backfiller.backfill();x(so,`Documents written: ${t}`)}catch(t){zr(t)?x(so,"Ignoring IndexedDB error during index backfill: ",t):yield Vr(t)}yield this.schedule(uM)}))}},Sm=class{constructor(e,t){this.localStore=e,this.persistence=t}backfill(){return _(this,arguments,function*(e=dM){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))})}writeIndexEntries(e,t){let r=new Set,i=t,s=!0;return E.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(a===null||r.has(a))s=!1;else return x(so,`Processing collection: ${a}`),this.writeEntriesForCollectionGroup(e,a,i).next(o=>{i-=o,r.add(a)})})).next(()=>t-i)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.getNewOffset(i,s)).next(o=>(x(so,`Updating offset: ${o}`),this.localStore.indexManager.updateCollectionGroup(e,t,o))).next(()=>a.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((i,s)=>{let a=Pb(s);uy(a,r)>0&&(r=a)}),new Ut(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var bt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),Ls="",Tm="",Bb="",qb="";function ht(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=IE(e)),e=hM(n.get(t),e);return IE(e)}function hM(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+=Ls+Bb;break;case Ls:t+=Ls+qb;break;default:t+=s}}return t}function IE(n){return n+Ls+Tm}function _n(n){let e=n.length;if(K(e>=2),e===2)return K(n.charAt(0)===Ls&&n.charAt(1)===Tm),re.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let a=n.indexOf(Ls,s);switch((a<0||a>t)&&V(),n.charAt(a+1)){case Tm:let l=n.substring(s,a),c;i.length===0?c=l:(i+=l,c=i,i=""),r.push(c);break;case Bb:i+=n.substring(s,a),i+="\0";break;case qb:i+=n.substring(s,a+1);break;default:V()}s=a+2}return new re(r)}var ii="remoteDocuments";var Fo="owner",_s="owner",Bo="mutationQueues",fM="userId",Jt="mutations",Ub="batchId",li="userMutationsIndex",Vb=["userId","batchId"];function pM(n){return[n]}function nu(n,e){return[n,ht(e)]}function zb(n,e,t){return[n,ht(e),t]}var mM={},na="documentMutations",ed="remoteDocumentsV14",gM=["prefixPath","collectionGroup","readTime","documentId"],ru="documentKeyIndex",yM=["prefixPath","collectionGroup","documentId"],Gb="collectionGroupIndex",vM=["collectionGroup","readTime","prefixPath","documentId"],qo="remoteDocumentGlobal",wm="remoteDocumentGlobalKey",ra="targets",SM="targetId",jb="queryTargetsIndex",TM=["canonicalId","targetId"],ia="targetDocuments",wM=["targetId","path"],hy="documentTargetsIndex",_M=["path","targetId"],fu="targetGlobalKey",Ii="targetGlobal",fo="collectionParents",EM=["collectionId","parent"],qs="clientMetadata",bM="clientId",td="bundles",CM="bundleId",nd="namedQueries",IM="name",fy="indexConfiguration",AM="indexId",_m="collectionGroupIndex",RM="collectionGroup",rd="indexState",DM=["indexId","uid"],Kb="sequenceNumberIndex",NM=["uid","sequenceNumber"],id="indexEntries",OM=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Wb="documentKeyIndex",kM=["indexId","uid","orderedDocumentKey"],sd="documentOverlays",xM=["userId","collectionPath","documentId"],Em="collectionPathOverlayIndex",MM=["userId","collectionPath","largestBatchId"],$b="collectionGroupOverlayIndex",PM=["userId","collectionGroup","largestBatchId"],LM=[Bo,Jt,na,ii,ra,Fo,Ii,ia],FM=LM,BM=[...FM,qs],qM=[...BM,qo],UM=[...qM,fo],Hb=[...UM,td,nd],VM=[...Hb,sd],Qb=[Bo,Jt,na,ed,ra,Fo,Ii,ia,qs,qo,fo,td,nd,sd],Yb=Qb,Jb=[...Yb,fy,rd,id],zM=Jb;function GM(n){if(n===16)return zM;if(n===15)return Jb;if(n===14)return Yb;if(n===13)return Qb;if(n===12)return VM;if(n===11)return Hb;V()}var po=class extends du{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}};function Je(n,e){let t=U(n);return Or.getStore(t.simpleDbTransaction,e)}function AE(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ai(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Xb(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ve=class n{constructor(e,t){this.comparator=e,this.root=t||ao.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ao.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ao.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new xs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new xs(this.root,e,this.comparator,!1)}getReverseIterator(){return new xs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new xs(this.root,e,this.comparator,!0)}},xs=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},ao=(()=>{class n{constructor(t,r,i,s,a){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=a??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,a){return new n(t??this.key,r??this.value,i??this.color,s??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,a=i(t,s.key);return a<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):a===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw V();let t=this.left.check();if(t!==this.right.check())throw V();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),bm=class{constructor(){this.size=0}get key(){throw V()}get value(){throw V()}get color(){throw V()}get left(){throw V()}get right(){throw V()}copy(e,t,r,i,s){return this}insert(e,t,r){return new ao(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};ao.EMPTY=new bm;var fe=class n{constructor(e){this.comparator=e,this.data=new ve(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new pu(this.data.getIterator())}getIteratorFrom(e){return new pu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},pu=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function jM(n,e,t,r,i){let s=n.getIterator(),a=e.getIterator(),o=Es(s),l=Es(a);for(;o||l;){let c=!1,u=!1;if(o&&l){let d=t(o,l);d<0?u=!0:d>0&&(c=!0)}else o!=null?u=!0:c=!0;c?(r(l),l=Es(a)):u?(i(o),o=Es(s)):(o=Es(s),l=Es(a))}}function Es(n){return n.hasNext()?n.getNext():void 0}var Ct=class n{constructor(e){this.fields=e,e.sort(Le.comparator)}static empty(){return new n([])}unionWith(e){let t=new fe(Le.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return hi(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function KM(n){return Buffer.from(n,"base64").toString("binary")}function WM(n){return Buffer.from(n,"binary").toString("base64")}function Zb(){return!0}var Ye=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=KM(e);return new n(t)}static fromUint8Array(e){let t=$M(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return WM(this.binaryString)}toUint8Array(){return HM(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return J(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ye.EMPTY_BYTE_STRING=new Ye("");function $M(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function HM(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var QM=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Un(n){if(K(!!n),typeof n=="string"){let e=0,t=QM.exec(n);if(K(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=Ne(n.seconds),t=Ne(n.nanos);return{seconds:e,nanos:t}}}function Ne(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function kr(n){return typeof n=="string"?Ye.fromBase64String(n):Ye.fromUint8Array(n)}var eC="server_timestamp",tC="__type__",nC="__previous_value__",rC="__local_write_time__";function ad(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[tC])===null||t===void 0?void 0:t.stringValue)===eC}function YM(n,e){let t={fields:{[tC]:{stringValue:eC},[rC]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&ad(e)&&(e=py(e)),e&&(t.fields[nC]=e),{mapValue:t}}function py(n){let e=n.mapValue.fields[nC];return ad(e)?py(e):e}function mo(n){let e=Un(n.mapValue.fields[rC].timestampValue);return new Ce(e.seconds,e.nanos)}var Cm=class{constructor(e,t,r,i,s,a,o,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=o,this.longPollingOptions=l,this.useFetchStreams=c}},Im="(default)",xr=class n{constructor(e,t){this.projectId=e,this.database=t||Im}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Im}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function JM(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new N(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xr(n.options.projectId,e)}var Dr=-1;function Uo(n){return n==null}function go(n){return n===0&&1/n===-1/0}function iC(n){return typeof n=="number"&&Number.isInteger(n)&&!go(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var sC="__max__",Ar={mapValue:{fields:{__type__:{stringValue:sC}}}},iu={nullValue:"NULL_VALUE"};function pi(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?ad(n)?4:aC(n)?9007199254740991:10:V()}function Xt(n,e){if(n===e)return!0;let t=pi(n),r=pi(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return mo(n).isEqual(mo(e));case 3:return XM(n,e);case 5:return n.stringValue===e.stringValue;case 6:return eP(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return ZM(n,e);case 2:return tP(n,e);case 9:return hi(n.arrayValue.values||[],e.arrayValue.values||[],Xt);case 10:return nP(n,e);case 9007199254740991:return!0;default:return V()}}function XM(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=Un(n.timestampValue),r=Un(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function ZM(n,e){return Ne(n.geoPointValue.latitude)===Ne(e.geoPointValue.latitude)&&Ne(n.geoPointValue.longitude)===Ne(e.geoPointValue.longitude)}function eP(n,e){return kr(n.bytesValue).isEqual(kr(e.bytesValue))}function tP(n,e){if("integerValue"in n&&"integerValue"in e)return Ne(n.integerValue)===Ne(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=Ne(n.doubleValue),r=Ne(e.doubleValue);return t===r?go(t)===go(r):isNaN(t)&&isNaN(r)}return!1}function nP(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(AE(t)!==AE(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!Xt(t[i],r[i])))return!1;return!0}function yo(n,e){return(n.values||[]).find(t=>Xt(t,e))!==void 0}function Mr(n,e){if(n===e)return 0;let t=pi(n),r=pi(e);if(t!==r)return J(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return J(n.booleanValue,e.booleanValue);case 2:return rP(n,e);case 3:return RE(n.timestampValue,e.timestampValue);case 4:return RE(mo(n),mo(e));case 5:return J(n.stringValue,e.stringValue);case 6:return aP(n.bytesValue,e.bytesValue);case 7:return iP(n.referenceValue,e.referenceValue);case 8:return sP(n.geoPointValue,e.geoPointValue);case 9:return oP(n.arrayValue,e.arrayValue);case 10:return lP(n.mapValue,e.mapValue);default:throw V()}}function rP(n,e){let t=Ne(n.integerValue||n.doubleValue),r=Ne(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function RE(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return J(n,e);let t=Un(n),r=Un(e),i=J(t.seconds,r.seconds);return i!==0?i:J(t.nanos,r.nanos)}function iP(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=J(t[i],r[i]);if(s!==0)return s}return J(t.length,r.length)}function sP(n,e){let t=J(Ne(n.latitude),Ne(e.latitude));return t!==0?t:J(Ne(n.longitude),Ne(e.longitude))}function aP(n,e){let t=kr(n),r=kr(e);return t.compareTo(r)}function oP(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Mr(t[i],r[i]);if(s)return s}return J(t.length,r.length)}function lP(n,e){if(n===Ar.mapValue&&e===Ar.mapValue)return 0;if(n===Ar.mapValue)return 1;if(e===Ar.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let a=0;a<r.length&&a<s.length;++a){let o=J(r[a],s[a]);if(o!==0)return o;let l=Mr(t[r[a]],i[s[a]]);if(l!==0)return l}return J(r.length,s.length)}function Us(n){return my(n)}function my(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?uP(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?cP(n.bytesValue):"referenceValue"in n?hP(n.referenceValue):"geoPointValue"in n?dP(n.geoPointValue):"arrayValue"in n?pP(n.arrayValue):"mapValue"in n?fP(n.mapValue):V()}function cP(n){return kr(n).toBase64()}function uP(n){let e=Un(n);return`time(${e.seconds},${e.nanos})`}function dP(n){return`geo(${n.latitude},${n.longitude})`}function hP(n){return F.fromName(n).toString()}function fP(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${my(n.fields[i])}`;return t+"}"}function pP(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=my(r);return e+"]"}function mi(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Am(n){return!!n&&"integerValue"in n}function mP(n){return!!n&&"doubleValue"in n}function gP(n){return Am(n)||mP(n)}function vo(n){return!!n&&"arrayValue"in n}function DE(n){return!!n&&"nullValue"in n}function NE(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function su(n){return!!n&&"mapValue"in n}function oo(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Ai(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=oo(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=oo(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function aC(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===sC}function yP(n){return"nullValue"in n?iu:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?mi(xr.empty(),F.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:V()}function vP(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?mi(xr.empty(),F.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Ar:V()}function OE(n,e){let t=Mr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function kE(n,e){let t=Mr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var st=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!su(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=oo(t)}setAll(e){let t=Le.emptyPath(),r={},i=[];e.forEach((a,o)=>{if(!t.isImmediateParentOf(o)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=o.popLast()}a?r[o.lastSegment()]=oo(a):i.push(o.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());su(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Xt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!su(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Ai(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(oo(this.value))}};function oC(n){let e=[];return Ai(n.fields,(t,r)=>{let i=new Le([t]);if(su(r)){let a=oC(r.mapValue).fields;if(a.length===0)e.push(i);else for(let o of a)e.push(i.child(o))}else e.push(i)}),new Ct(e)}var Ve=class n{constructor(e,t,r,i,s,a,o){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=o}static newInvalidDocument(e){return new n(e,0,$.min(),$.min(),$.min(),st.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,$.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,$.min(),$.min(),st.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,$.min(),$.min(),st.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual($.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=st.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=st.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function SP(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?Mr(r,i):V()}var In=class{constructor(e,t){this.position=e,this.inclusive=t}};function lC(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],a=n.position[i];if(s.field.isKeyField())r=F.comparator(F.fromName(a.referenceValue),t.key);else{let o=t.data.field(s.field);r=Mr(a,o)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function TP(n,e,t){let r=lC(n,e,t);return n.inclusive?r>=0:r>0}function wP(n,e,t){let r=lC(n,e,t);return n.inclusive?r<=0:r<0}function xE(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!Xt(r,i))return!1}return!0}var gi=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function _P(n){return n.field.canonicalString()+n.dir}function EP(n){return`${n.field.canonicalString()} (${n.dir})`}function bP(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var mu=class{},te=class n extends mu{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Nm(e,t,r):t==="array-contains"?new xm(e,r):t==="in"?new gu(e,r):t==="not-in"?new Mm(e,r):t==="array-contains-any"?new Pm(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Om(e,r):new km(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Mr(t,this.value)):t!==null&&pi(this.value)===pi(t)&&this.matchesComparison(Mr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return V()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ue=class n extends mu{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return Vs(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function Vs(n){return n.op==="and"}function Rm(n){return n.op==="or"}function gy(n){return cC(n)&&Vs(n)}function cC(n){for(let e of n.filters)if(e instanceof ue)return!1;return!0}function Dm(n){if(n instanceof te)return n.field.canonicalString()+n.op.toString()+Us(n.value);if(gy(n))return n.filters.map(e=>Dm(e)).join(",");{let e=n.filters.map(t=>Dm(t)).join(",");return`${n.op}(${e})`}}function uC(n,e){if(n instanceof te)return CP(n,e);if(n instanceof ue)return IP(n,e);V()}function CP(n,e){return e instanceof te&&n.op===e.op&&n.field.isEqual(e.field)&&Xt(n.value,e.value)}function IP(n,e){return e instanceof ue&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&uC(i,e.filters[s]),!0):!1}function dC(n,e){let t=n.filters.concat(e);return ue.create(t,n.op)}function hC(n){return n instanceof te?RP(n):n instanceof ue?AP(n):"Filter"}function AP(n){return n.op.toString()+" {"+n.getFilters().map(hC).join(" ,")+"}"}function RP(n){return`${n.field.canonicalString()} ${n.op} ${Us(n.value)}`}var Nm=class extends te{constructor(e,t,r){super(e,t,r),this.key=F.fromName(r.referenceValue)}matches(e){let t=F.comparator(e.key,this.key);return this.matchesComparison(t)}},Om=class extends te{constructor(e,t){super(e,"in",t),this.keys=fC("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},km=class extends te{constructor(e,t){super(e,"not-in",t),this.keys=fC("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function fC(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>F.fromName(r.referenceValue))}var xm=class extends te{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return vo(t)&&yo(t.arrayValue,this.value)}},gu=class extends te{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&yo(this.value.arrayValue,t)}},Mm=class extends te{constructor(e,t){super(e,"not-in",t)}matches(e){if(yo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!yo(this.value.arrayValue,t)}},Pm=class extends te{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!vo(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>yo(this.value.arrayValue,r))}};var Lm=class{constructor(e,t=null,r=[],i=[],s=null,a=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=o,this.memoizedCanonicalId=null}};function Fm(n,e=null,t=[],r=[],i=null,s=null,a=null){return new Lm(n,e,t,r,i,s,a)}function yi(n){let e=U(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Dm(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>_P(r)).join(","),Uo(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Us(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Us(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function DP(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>hC(t)).join(", ")}]`),Uo(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>EP(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>Us(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>Us(t)).join(",")),`Target(${e})`}function Vo(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!bP(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!uC(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!xE(n.startAt,e.startAt)?!1:xE(n.endAt,e.endAt)}function yu(n){return F.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function od(n,e){return n.filters.filter(t=>t instanceof te&&t.field.isEqual(e))}function NP(n,e){let t=cy(e);if(t===void 0)return null;for(let r of od(n,t.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}function OP(n,e){let t=new Map;for(let r of fi(e))for(let i of od(n,r.fieldPath))switch(i.op){case"==":case"in":t.set(r.fieldPath.canonicalString(),i.value);break;case"not-in":case"!=":return t.set(r.fieldPath.canonicalString(),i.value),Array.from(t.values())}return null}function kP(n,e){let t=[],r=!0;for(let i of fi(e)){let s=i.kind===0?pC(n,i.fieldPath,n.startAt):mC(n,i.fieldPath,n.startAt);t.push(s.value),r&&(r=s.inclusive)}return new In(t,r)}function xP(n,e){let t=[],r=!0;for(let i of fi(e)){let s=i.kind===0?mC(n,i.fieldPath,n.endAt):pC(n,i.fieldPath,n.endAt);t.push(s.value),r&&(r=s.inclusive)}return new In(t,r)}function pC(n,e,t){let r=iu,i=!0;for(let s of od(n,e)){let a=iu,o=!0;switch(s.op){case"<":case"<=":a=yP(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,o=!1;break;case"!=":case"not-in":a=iu;break}OE({value:r,inclusive:i},{value:a,inclusive:o})<0&&(r=a,i=o)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];OE({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function mC(n,e,t){let r=Ar,i=!0;for(let s of od(n,e)){let a=Ar,o=!0;switch(s.op){case">=":case">":a=vP(s.value),o=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,o=!1;break;case"!=":case"not-in":a=Ar;break}kE({value:r,inclusive:i},{value:a,inclusive:o})>0&&(r=a,i=o)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];kE({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function MP(n){let e=new fe(Le.comparator),t=!1;for(let r of n.filters)for(let i of r.getFlattenedFilters())i.field.isKeyField()||(i.op==="array-contains"||i.op==="array-contains-any"?t=!0:e=e.add(i.field));for(let r of n.orderBy)r.field.isKeyField()||(e=e.add(r.field));return e.size+(t?1:0)}function PP(n){return n.limit!==null}var Zt=class{constructor(e,t=null,r=[],i=[],s=null,a="F",o=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=o,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function gC(n,e,t,r,i,s,a,o){return new Zt(n,e,t,r,i,s,a,o)}function sa(n){return new Zt(n)}function LP(n,e){return new Zt(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function ME(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function FP(n){let e=new fe(Le.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function BP(n){return new Zt(re.emptyPath(),n)}function qP(n){return F.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function yy(n){return n.collectionGroup!==null}function zs(n){let e=U(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";FP(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new gi(s,r))}),t.has(Le.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new gi(Le.keyField(),r))}return e.memoizedNormalizedOrderBy}function ft(n){let e=U(n);return e.memoizedTarget||(e.memoizedTarget=UP(e,zs(n))),e.memoizedTarget}function UP(n,e){if(n.limitType==="F")return Fm(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new gi(i.field,s)});let t=n.endAt?new In(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new In(n.startAt.position,n.startAt.inclusive):null;return Fm(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function vy(n,e){let t=n.filters.concat([e]);return new Zt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function VP(n,e){let t=n.explicitOrderBy.concat([e]);return new Zt(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function vu(n,e,t){return new Zt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function zP(n,e){return new Zt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function GP(n,e){return new Zt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,e)}function zo(n,e){return Vo(ft(n),ft(e))&&n.limitType===e.limitType}function yC(n){return`${yi(ft(n))}|lt:${n.limitType}`}function Ns(n){return`Query(target=${DP(ft(n))}; limitType=${n.limitType})`}function Go(n,e){return e.isFoundDocument()&&jP(n,e)&&KP(n,e)&&WP(n,e)&&$P(n,e)}function jP(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):F.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function KP(n,e){for(let t of zs(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function WP(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function $P(n,e){return!(n.startAt&&!wP(n.startAt,zs(n),e)||n.endAt&&!TP(n.endAt,zs(n),e))}function vC(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function SC(n){return(e,t)=>{let r=!1;for(let i of zs(n)){let s=HP(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function HP(n,e,t){let r=n.field.isKeyField()?F.comparator(e.key,t.key):SP(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return V()}}var An=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ai(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return Xb(this.inner)}size(){return this.innerSize}};var QP=new ve(F.comparator);function vt(){return QP}var TC=new ve(F.comparator);function ro(...n){let e=TC;for(let t of n)e=e.insert(t.key,t);return e}function YP(){return So()}function wC(n){let e=TC;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function En(){return So()}function _C(){return So()}function So(){return new An(n=>n.toString(),(n,e)=>n.isEqual(e))}var JP=new ve(F.comparator);function XP(){return JP}var ZP=new fe(F.comparator);function X(...n){let e=ZP;for(let t of n)e=e.add(t);return e}var eL=new fe(J);function Sy(){return eL}function EC(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:go(e)?"-0":e}}function bC(n){return{integerValue:""+n}}function CC(n,e){return iC(e)?bC(e):EC(n,e)}var Gs=class{constructor(){this._=void 0}};function tL(n,e,t){return n instanceof Pr?YM(t,e):n instanceof Vn?AC(n,e):n instanceof zn?RC(n,e):iL(n,e)}function nL(n,e,t){return n instanceof Vn?AC(n,e):n instanceof zn?RC(n,e):t}function IC(n,e){return n instanceof Lr?gP(e)?e:{integerValue:0}:null}function rL(n,e){return n instanceof Vn&&e instanceof Vn||n instanceof zn&&e instanceof zn?hi(n.elements,e.elements,Xt):n instanceof Lr&&e instanceof Lr?Xt(n.operand,e.operand):n instanceof Pr&&e instanceof Pr}var Pr=class extends Gs{},Vn=class extends Gs{constructor(e){super(),this.elements=e}};function AC(n,e){let t=DC(e);for(let r of n.elements)t.some(i=>Xt(i,r))||t.push(r);return{arrayValue:{values:t}}}var zn=class extends Gs{constructor(e){super(),this.elements=e}};function RC(n,e){let t=DC(e);for(let r of n.elements)t=t.filter(i=>!Xt(i,r));return{arrayValue:{values:t}}}var Lr=class extends Gs{constructor(e,t){super(),this.serializer=e,this.operand=t}};function iL(n,e){let t=IC(n,e),r=PE(t)+PE(n.operand);return Am(t)&&Am(n.operand)?bC(r):EC(n.serializer,r)}function PE(n){return Ne(n.integerValue||n.doubleValue)}function DC(n){return vo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var vi=class{constructor(e,t){this.field=e,this.transform=t}};function sL(n,e){return n.field.isEqual(e.field)&&rL(n.transform,e.transform)}function aL(n,e){return n===void 0&&e===void 0?!0:n&&e?hi(n,e,(t,r)=>sL(t,r)):!1}var Bm=class{constructor(e,t){this.version=e,this.transformResults=t}},De=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function ld(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var js=class{};function NC(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Br(n.key,De.none()):new Fr(n.key,n.data,De.none());{let t=n.data,r=st.empty(),i=new fe(Le.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?r.delete(s):r.set(s,a),i=i.add(s)}return new en(n.key,r,new Ct(i.toArray()),De.none())}}function oL(n,e,t){n instanceof Fr?cL(n,e,t):n instanceof en?dL(n,e,t):fL(n,e,t)}function lo(n,e,t,r){return n instanceof Fr?uL(n,e,t,r):n instanceof en?hL(n,e,t,r):pL(n,e,t)}function lL(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=IC(r.transform,i||null);s!=null&&(t===null&&(t=st.empty()),t.set(r.field,s))}return t||null}function LE(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!aL(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var Fr=class extends js{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function cL(n,e,t){let r=n.value.clone(),i=kC(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function uL(n,e,t,r){if(!ld(n.precondition,e))return t;let i=n.value.clone(),s=xC(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var en=class extends js{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function dL(n,e,t){if(!ld(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=kC(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(OC(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function hL(n,e,t,r){if(!ld(n.precondition,e))return t;let i=xC(n.fieldTransforms,r,e),s=e.data;return s.setAll(OC(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(a=>a.field))}function OC(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function kC(n,e,t){let r=new Map;K(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],a=s.transform,o=e.data.field(s.field);r.set(s.field,nL(a,o,t[i]))}return r}function xC(n,e,t){let r=new Map;for(let i of n){let s=i.transform,a=t.data.field(i.field);r.set(i.field,tL(s,a,e))}return r}var Br=class extends js{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function fL(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function pL(n,e,t){return ld(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var To=class extends js{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var wo=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let a=r[i];oL(s,e,a)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=lo(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=lo(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=_C();return this.mutations.forEach(i=>{let s=e.get(i.key),a=s.overlayedDocument,o=this.applyToLocalView(a,s.mutatedFields);o=t.has(i.key)?null:o;let l=NC(a,o);l!==null&&r.set(i.key,l),a.isValidDocument()||a.convertToNoDocument($.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),X())}isEqual(e){return this.batchId===e.batchId&&hi(this.mutations,e.mutations,(t,r)=>LE(t,r))&&hi(this.baseMutations,e.baseMutations,(t,r)=>LE(t,r))}},qm=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){K(e.mutations.length===r.length);let i=XP(),s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new n(e,t,r,i)}};var _o=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Um=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Qe=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(Qe||{});function MC(n){switch(n){case C.OK:return V();case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0;default:return V()}}function mL(n){return MC(n)&&n!==C.ABORTED}function au(n){if(n===void 0)return be("GRPC error has no .code"),C.UNKNOWN;switch(n){case Qe.OK:return C.OK;case Qe.CANCELLED:return C.CANCELLED;case Qe.UNKNOWN:return C.UNKNOWN;case Qe.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case Qe.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case Qe.INTERNAL:return C.INTERNAL;case Qe.UNAVAILABLE:return C.UNAVAILABLE;case Qe.UNAUTHENTICATED:return C.UNAUTHENTICATED;case Qe.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case Qe.NOT_FOUND:return C.NOT_FOUND;case Qe.ALREADY_EXISTS:return C.ALREADY_EXISTS;case Qe.PERMISSION_DENIED:return C.PERMISSION_DENIED;case Qe.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case Qe.ABORTED:return C.ABORTED;case Qe.OUT_OF_RANGE:return C.OUT_OF_RANGE;case Qe.UNIMPLEMENTED:return C.UNIMPLEMENTED;case Qe.DATA_LOSS:return C.DATA_LOSS;default:return V()}}var Vm=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Zp=null;function PC(){return new Yx}function gL(){return new Jx("utf-8")}var yL=new Qn([4294967295,4294967295],0);function FE(n){let e=PC().encode(n),t=new xd;return t.update(e),new Uint8Array(t.digest())}function BE(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),a=new Qn([t,r],0),o=new Qn([i,s],0);return[a,o]}var zm=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ci(`Invalid padding: ${t}`);if(r<0)throw new ci(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ci(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new ci(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=Qn.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(Qn.fromNumber(r)));return i.compare(yL)===1&&(i=new Qn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=FE(e),[r,i]=BE(t);for(let s=0;s<this.hashCount;s++){let a=this.getBitIndex(r,i,s);if(!this.isBitSet(a))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new n(s,i,t);return r.forEach(o=>a.insert(o)),a}insert(e){if(this.bitCount===0)return;let t=FE(e),[r,i]=BE(t);for(let s=0;s<this.hashCount;s++){let a=this.getBitIndex(r,i,s);this.setBit(a)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},ci=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Eo=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,bo.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n($.min(),i,new ve(J),vt(),X())}},bo=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,X(),X(),X())}};var Fs=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},Su=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},Tu=class{constructor(e,t,r=Ye.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},wu=class{constructor(){this.pendingResponses=0,this.documentChanges=UE(),this._resumeToken=Ye.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=X(),t=X(),r=X();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:V()}}),new bo(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=UE()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,K(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},vL="WatchChangeAggregator",Gm=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=vt(),this.pendingDocumentTargetMapping=qE(),this.pendingTargetResets=new ve(J)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:V()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(yu(s))if(r===0){let a=new F(s.path);this.removeDocumentFromTarget(t,a,Ve.newNoDocument(a,$.min()))}else K(r===1);else{let a=this.getCurrentDocumentCountForTarget(t);if(a!==r){let o=this.parseBloomFilter(e),l=o?this.applyBloomFilter(o,e,a):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}Zp?.notifyOnExistenceFilterMismatch(SL(a,e.existenceFilter,this.metadataProvider.getDatabaseId(),o,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,a;try{a=kr(r).toUint8Array()}catch(l){if(l instanceof Vm)return qt("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let o;try{o=new zm(a,i,s)}catch(l){return l instanceof ci?qt("BloomFilter error: ",l):qt("Applying bloom filter failed: ",l),null}return o.bitCount===0?null:o}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let a=this.metadataProvider.getDatabaseId(),o=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(o)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,a)=>{let o=this.targetDataForActiveTarget(a);if(o){if(s.current&&yu(o.target)){let l=new F(o.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(a,l)&&this.removeDocumentFromTarget(a,l,Ve.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(a,s.toTargetChange()),s.clearPendingChanges())}});let r=X();this.pendingDocumentTargetMapping.forEach((s,a)=>{let o=!0;a.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(o=!1,!1):!0}),o&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,a)=>a.setReadTime(e));let i=new Eo(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=vt(),this.pendingDocumentTargetMapping=qE(),this.pendingTargetResets=new ve(J),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new wu,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new fe(J),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||x(vL,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new wu),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function qE(){return new ve(F.comparator)}function UE(){return new ve(F.comparator)}function SL(n,e,t,r,i){var s,a,o,l,c,u;let d={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},f=e.unchangedNames;return f&&(d.bloomFilter={applied:i===0,hashCount:(s=f?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(o=(a=f?.bits)===null||a===void 0?void 0:a.bitmap)===null||o===void 0?void 0:o.length)!==null&&l!==void 0?l:0,padding:(u=(c=f?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:v=>{var b;return(b=r?.mightContain(v))!==null&&b!==void 0?b:!1}}),d}var TL=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),wL=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),_L=(()=>{let n={};return n.and="AND",n.or="OR",n})();var jm=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function EL(n){let e=n.code===void 0?C.UNKNOWN:au(n.code);return new N(e,n.message||"")}function Km(n,e){return n.useProto3Json||Uo(e)?e:{value:e}}function bL(n){let e;return typeof n=="object"?e=n.value:e=n,Uo(e)?null:e}function Ks(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function CL(n){let e=Un(n);return new Ce(e.seconds,e.nanos)}function LC(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function IL(n,e){return n.useProto3Json?(K(e===void 0||typeof e=="string"),Ye.fromBase64String(e||"")):(K(e===void 0||e instanceof Buffer||e instanceof Uint8Array),Ye.fromUint8Array(e||new Uint8Array))}function AL(n,e){return Ks(n,e.toTimestamp())}function Pe(n){return K(!!n),$.fromTimestamp(CL(n))}function Ty(n,e){return Wm(n,e).canonicalString()}function Wm(n,e){let t=RL(n).child("documents");return e===void 0?t:t.child(e)}function FC(n){let e=re.fromString(n);return K($C(e)),e}function Co(n,e){return Ty(n.databaseId,e.path)}function bn(n,e){let t=FC(e);if(t.get(1)!==n.databaseId.projectId)throw new N(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new N(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new F(UC(t))}function BC(n,e){return Ty(n.databaseId,e)}function qC(n){let e=FC(n);return e.length===4?re.emptyPath():UC(e)}function $m(n){return new re(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function RL(n){return new re(["projects",n.projectId,"databases",n.database])}function UC(n){return K(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function VE(n,e,t){return{name:Co(n,e),fields:t.value.mapValue.fields}}function DL(n,e){return{name:Co(n,e.key),fields:e.data.value.mapValue.fields,updateTime:Ks(n,e.version.toTimestamp()),createTime:Ks(n,e.createTime.toTimestamp())}}function VC(n,e,t){let r=bn(n,e.name),i=Pe(e.updateTime),s=e.createTime?Pe(e.createTime):$.min(),a=new st({mapValue:{fields:e.fields}}),o=Ve.newFoundDocument(r,i,s,a);return t&&o.setHasCommittedMutations(),t?o.setHasCommittedMutations():o}function NL(n,e){K(!!e.found),e.found.name,e.found.updateTime;let t=bn(n,e.found.name),r=Pe(e.found.updateTime),i=e.found.createTime?Pe(e.found.createTime):$.min(),s=new st({mapValue:{fields:e.found.fields}});return Ve.newFoundDocument(t,r,i,s)}function OL(n,e){K(!!e.missing),K(!!e.readTime);let t=bn(n,e.missing),r=Pe(e.readTime);return Ve.newNoDocument(t,r)}function kL(n,e){return"found"in e?NL(n,e):"missing"in e?OL(n,e):V()}function xL(n,e){let t;if("targetChange"in e){e.targetChange;let r=ML(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=IL(n,e.targetChange.resumeToken),a=e.targetChange.cause,o=a&&EL(a);t=new Tu(r,i,s,o||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=bn(n,r.document.name),s=Pe(r.document.updateTime),a=r.document.createTime?Pe(r.document.createTime):$.min(),o=new st({mapValue:{fields:r.document.fields}}),l=Ve.newFoundDocument(i,s,a,o),c=r.targetIds||[],u=r.removedTargetIds||[];t=new Fs(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=bn(n,r.document),s=r.readTime?Pe(r.readTime):$.min(),a=Ve.newNoDocument(i,s),o=r.removedTargetIds||[];t=new Fs([],o,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=bn(n,r.document),s=r.removedTargetIds||[];t=new Fs([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,a=new Um(i,s),o=r.targetId;t=new Su(o,a)}else return V();return t}function ML(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:V()}function PL(n){if(!("targetChange"in n))return $.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?$.min():Pe(e.readTime)}function Io(n,e){let t;if(e instanceof Fr)t={update:VE(n,e.key,e.value)};else if(e instanceof Br)t={delete:Co(n,e.key)};else if(e instanceof en)t={update:VE(n,e.key,e.data),updateMask:pF(e.fieldMask)};else if(e instanceof To)t={verify:Co(n,e.key)};else return V();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>UL(n,r))),e.precondition.isNone||(t.currentDocument=LL(n,e.precondition)),t}function Hm(n,e){let t=e.currentDocument?FL(e.currentDocument):De.none(),r=e.updateTransforms?e.updateTransforms.map(i=>VL(n,i)):[];if(e.update){e.update.name;let i=bn(n,e.update.name),s=new st({mapValue:{fields:e.update.fields}});if(e.updateMask){let a=mF(e.updateMask);return new en(i,s,a,t,r)}else return new Fr(i,s,t,r)}else if(e.delete){let i=bn(n,e.delete);return new Br(i,t)}else if(e.verify){let i=bn(n,e.verify);return new To(i,t)}else return V()}function LL(n,e){return e.updateTime!==void 0?{updateTime:AL(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:V()}function FL(n){return n.updateTime!==void 0?De.updateTime(Pe(n.updateTime)):n.exists!==void 0?De.exists(n.exists):De.none()}function BL(n,e){let t=n.updateTime?Pe(n.updateTime):Pe(e);return t.isEqual($.min())&&(t=Pe(e)),new Bm(t,n.transformResults||[])}function qL(n,e){return n&&n.length>0?(K(e!==void 0),n.map(t=>BL(t,e))):[]}function UL(n,e){let t=e.transform;if(t instanceof Pr)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Vn)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof zn)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof Lr)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw V()}function VL(n,e){let t=null;if("setToServerValue"in e)K(e.setToServerValue==="REQUEST_TIME"),t=new Pr;else if("appendMissingElements"in e){let i=e.appendMissingElements.values||[];t=new Vn(i)}else if("removeAllFromArray"in e){let i=e.removeAllFromArray.values||[];t=new zn(i)}else"increment"in e?t=new Lr(n,e.increment):V();let r=Le.fromServerFormat(e.fieldPath);return new vi(r,t)}function zC(n,e){return{documents:[BC(n,e.path)]}}function zL(n){let e=n.documents.length;K(e===1);let t=n.documents[0];return ft(sa(qC(t)))}function GC(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=BC(n,i);let s=$L(e.filters);s&&(t.structuredQuery.where=s);let a=QL(e.orderBy);a&&(t.structuredQuery.orderBy=a);let o=Km(n,e.limit);return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=JL(e.startAt)),e.endAt&&(t.structuredQuery.endAt=XL(e.endAt)),{queryTarget:t,parent:i}}function jC(n){let e=qC(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){K(r===1);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=HL(t.where));let a=[];t.orderBy&&(a=YL(t.orderBy));let o=null;t.limit&&(o=bL(t.limit));let l=null;t.startAt&&(l=ZL(t.startAt));let c=null;return t.endAt&&(c=eF(t.endAt)),gC(e,i,a,s,o,"F",l,c)}function GL(n){return ft(jC(n))}function jL(n,e){let t=KL(e.purpose);return t==null?null:{"goog-listen-tags":t}}function KL(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return V()}}function WL(n,e){let t,r=e.target;if(yu(r)?t={documents:zC(n,r)}:t={query:GC(n,r).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=LC(n,e.resumeToken);let i=Km(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo($.min())>0){t.readTime=Ks(n,e.snapshotVersion.toTimestamp());let i=Km(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function $L(n){if(n.length!==0)return WC(ue.create(n,"and"))}function HL(n){let e=KC(n);return e instanceof ue&&gy(e)?e.getFilters():[e]}function KC(n){return n.unaryFilter!==void 0?dF(n):n.fieldFilter!==void 0?hF(n):n.compositeFilter!==void 0?fF(n):V()}function QL(n){if(n.length!==0)return n.map(e=>oF(e))}function YL(n){return n.map(e=>lF(e))}function JL(n){return{before:n.inclusive,values:n.position}}function XL(n){return{before:!n.inclusive,values:n.position}}function ZL(n){let e=!!n.before,t=n.values||[];return new In(t,e)}function eF(n){let e=!n.before,t=n.values||[];return new In(t,e)}function tF(n){return TL[n]}function nF(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function rF(n){return wL[n]}function iF(n){return _L[n]}function sF(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return V();default:return V()}}function aF(n){switch(n){case"AND":return"and";case"OR":return"or";default:return V()}}function Os(n){return{fieldPath:n.canonicalString()}}function Ms(n){return Le.fromServerFormat(n.fieldPath)}function oF(n){return{field:Os(n.field),direction:tF(n.dir)}}function lF(n){return new gi(Ms(n.field),nF(n.direction))}function WC(n){return n instanceof te?uF(n):n instanceof ue?cF(n):V()}function cF(n){let e=n.getFilters().map(t=>WC(t));return e.length===1?e[0]:{compositeFilter:{op:iF(n.op),filters:e}}}function uF(n){if(n.op==="=="){if(NE(n.value))return{unaryFilter:{field:Os(n.field),op:"IS_NAN"}};if(DE(n.value))return{unaryFilter:{field:Os(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(NE(n.value))return{unaryFilter:{field:Os(n.field),op:"IS_NOT_NAN"}};if(DE(n.value))return{unaryFilter:{field:Os(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Os(n.field),op:rF(n.op),value:n.value}}}function dF(n){switch(n.unaryFilter.op){case"IS_NAN":let e=Ms(n.unaryFilter.field);return te.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=Ms(n.unaryFilter.field);return te.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=Ms(n.unaryFilter.field);return te.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=Ms(n.unaryFilter.field);return te.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return V();default:return V()}}function hF(n){return te.create(Ms(n.fieldFilter.field),sF(n.fieldFilter.op),n.fieldFilter.value)}function fF(n){return ue.create(n.compositeFilter.filters.map(e=>KC(e)),aF(n.compositeFilter.op))}function pF(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function mF(n){let e=n.fieldPaths||[];return new Ct(e.map(t=>Le.fromServerFormat(t)))}function $C(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Ws=class n{constructor(e,t,r,i,s=$.min(),a=$.min(),o=Ye.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=o,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var _u=class{constructor(e){this.remoteSerializer=e}};function gF(n,e){let t;if(e.document)t=VC(n.remoteSerializer,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=F.fromSegments(e.noDocument.path),i=Ti(e.noDocument.readTime);t=Ve.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else if(e.unknownDocument){let r=F.fromSegments(e.unknownDocument.path),i=Ti(e.unknownDocument.version);t=Ve.newUnknownDocument(r,i)}else return V();return e.readTime&&t.setReadTime(yF(e.readTime)),t}function zE(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:cd(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=DL(n.remoteSerializer,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Si(e.version)};else if(e.isUnknownDocument())r.unknownDocument={path:t.path.toArray(),version:Si(e.version)};else return V();return r}function cd(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function yF(n){let e=new Ce(n[0],n[1]);return $.fromTimestamp(e)}function Si(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ti(n){let e=new Ce(n.seconds,n.nanoseconds);return $.fromTimestamp(e)}function vF(n,e,t){let r=t.baseMutations.map(s=>Io(n.remoteSerializer,s)),i=t.mutations.map(s=>Io(n.remoteSerializer,s));return{userId:e,batchId:t.batchId,localWriteTimeMs:t.localWriteTime.toMillis(),baseMutations:r,mutations:i}}function si(n,e){let t=(e.baseMutations||[]).map(s=>Hm(n.remoteSerializer,s));for(let s=0;s<e.mutations.length-1;++s){let a=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];a.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>Hm(n.remoteSerializer,s)),i=Ce.fromMillis(e.localWriteTimeMs);return new wo(e.batchId,i,t,r)}function io(n){let e=Ti(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Ti(n.lastLimboFreeSnapshotVersion):$.min(),r;return SF(n.query)?r=zL(n.query):r=GL(n.query),new Ws(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ye.fromBase64String(n.resumeToken))}function HC(n,e){let t=Si(e.snapshotVersion),r=Si(e.lastLimboFreeSnapshotVersion),i;yu(e.target)?i=zC(n.remoteSerializer,e.target):i=GC(n.remoteSerializer,e.target).queryTarget;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:yi(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function SF(n){return n.documents!==void 0}function TF(n){return{id:n.bundleId,createTime:Ti(n.createTime),version:n.version}}function wF(n){return{bundleId:n.id,createTime:Si(Pe(n.createTime)),version:n.version}}function _F(n){return{name:n.name,query:wy(n.bundledQuery),readTime:Ti(n.readTime)}}function EF(n){return{name:n.name,readTime:Si(Pe(n.readTime)),bundledQuery:n.bundledQuery}}function wy(n){let e=jC({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?vu(e,e.limit,"L"):e}function bF(n){return{name:n.name,query:wy(n.bundledQuery),readTime:Pe(n.readTime)}}function CF(n){return{id:n.id,version:n.version,createTime:Pe(n.createTime)}}function em(n,e){return new _o(e.largestBatchId,Hm(n.remoteSerializer,e.overlayMutation))}function IF(n,e,t){let[r,i,s]=QC(e,t.mutation.key);return{userId:e,collectionPath:i,documentId:s,collectionGroup:t.mutation.key.getCollectionGroup(),largestBatchId:t.largestBatchId,overlayMutation:Io(n.remoteSerializer,t.mutation)}}function QC(n,e){let t=e.path.lastSegment(),r=ht(e.path.popLast());return[n,r,t]}function AF(n){return{indexId:n.indexId,collectionGroup:n.collectionGroup,fields:n.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function RF(n,e){let t=e?new ho(e.sequenceNumber,new Ut(Ti(e.readTime),new F(_n(e.documentKey)),e.largestBatchId)):ho.empty(),r=n.fields.map(([i,s])=>new Ps(Le.fromServerFormat(i),s));return new mm(n.indexId,n.collectionGroup,r,t)}function GE(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Si(r.readTime),documentKey:ht(r.documentKey.path),largestBatchId:r.largestBatchId}}var Qm=class{getBundleMetadata(e,t){return jE(e).get(t).next(r=>{if(r)return TF(r)})}saveBundleMetadata(e,t){return jE(e).put(wF(t))}getNamedQuery(e,t){return KE(e).get(t).next(r=>{if(r)return _F(r)})}saveNamedQuery(e,t){return KE(e).put(EF(t))}};function jE(n){return Je(n,td)}function KE(n){return Je(n,nd)}var Eu=class n{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return Za(e).get(QC(this.userId,t)).next(r=>r?em(this.serializer,r):null)}getOverlays(e,t){let r=En();return E.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,a)=>{let o=new _o(t,a);i.push(this.saveOverlay(e,o))}),E.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(a=>i.add(ht(a.getCollectionPath())));let s=[];return i.forEach(a=>{let o=IDBKeyRange.bound([this.userId,a,r],[this.userId,a,r+1],!1,!0);s.push(Za(e).deleteAll(Em,o))}),E.waitFor(s)}getOverlaysForCollection(e,t,r){let i=En(),s=ht(t),a=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Za(e).loadAll(Em,a).next(o=>{for(let l of o){let c=em(this.serializer,l);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=En(),a,o=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Za(e).iterate({index:$b,range:o},(l,c,u)=>{let d=em(this.serializer,c);s.size()<i||d.largestBatchId===a?(s.set(d.getKey(),d),a=d.largestBatchId):u.done()}).next(()=>s)}saveOverlay(e,t){return Za(e).put(IF(this.serializer,this.userId,t))}};function Za(n){return Je(n,sd)}var DF=5,NF=10,OF=13,WE=15,kF=20,xF=25,MF=30,PF=37,LF=45,FF=50,BF=55,qF=60,UF=2,qn=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,DF);else if("booleanValue"in e)this.writeValueTypeLabel(t,NF),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,WE),t.writeNumber(Ne(e.integerValue));else if("doubleValue"in e){let r=Ne(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,OF):(this.writeValueTypeLabel(t,WE),go(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,kF),typeof r=="string"&&(r=Un(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,MF),t.writeBytes(kr(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,LF),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?aC(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):V()}writeIndexString(e,t){this.writeValueTypeLabel(t,xF),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,BF);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,FF);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,PF),F.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,qF),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(UF)}};qn.INSTANCE=new qn;var $E="\uD800",HE="\uDBFF",bs=0,QE=255,YE=1,Cs=255,JE=255,XE=0,VF=64,zF=8,GF=1024;function jF(n){let e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,!1),new Uint8Array(e.buffer)}function KF(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n=n<<4),n>>6||(e+=2,n=n<<2),n>>7||(e+=1),e}function WF(n){let e=0;for(let t=0;t<8;++t){let r=KF(n[t]&255);if(e+=r,r!==8)break}return e}function ZE(n){let e=VF-WF(n);return Math.ceil(e/zF)}var Ym=class{constructor(){this.buffer=new Uint8Array(GF),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteAscending(r);else if(r<2048)this.writeByteAscending(960|r>>>6),this.writeByteAscending(128|63&r);else if(t<$E||HE<t)this.writeByteAscending(480|r>>>12),this.writeByteAscending(128|63&r>>>6),this.writeByteAscending(128|63&r);else{let i=t.codePointAt(0);this.writeByteAscending(240|i>>>18),this.writeByteAscending(128|63&i>>>12),this.writeByteAscending(128|63&i>>>6),this.writeByteAscending(128|63&i)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteDescending(r);else if(r<2048)this.writeByteDescending(960|r>>>6),this.writeByteDescending(128|63&r);else if(t<$E||HE<t)this.writeByteDescending(480|r>>>12),this.writeByteDescending(128|63&r>>>6),this.writeByteDescending(128|63&r);else{let i=t.codePointAt(0);this.writeByteDescending(240|i>>>18),this.writeByteDescending(128|63&i>>>12),this.writeByteDescending(128|63&i>>>6),this.writeByteDescending(128|63&i)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=ZE(t);this.ensureAvailable(1+r),this.buffer[this.position++]=r&255;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=t[i]&255}writeNumberDescending(e){let t=this.toOrderedBits(e),r=ZE(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(r&255);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(t[i]&255)}writeInfinityAscending(){this.writeEscapedByteAscending(Cs),this.writeEscapedByteAscending(JE)}writeInfinityDescending(){this.writeEscapedByteDescending(Cs),this.writeEscapedByteDescending(JE)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=jF(e),r=(t[0]&128)!==0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}writeByteAscending(e){let t=e&255;t===bs?(this.writeEscapedByteAscending(bs),this.writeEscapedByteAscending(QE)):t===Cs?(this.writeEscapedByteAscending(Cs),this.writeEscapedByteAscending(XE)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=e&255;t===bs?(this.writeEscapedByteDescending(bs),this.writeEscapedByteDescending(QE)):t===Cs?(this.writeEscapedByteDescending(Cs),this.writeEscapedByteDescending(XE)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(bs),this.writeEscapedByteAscending(YE)}writeSeparatorDescending(){this.writeEscapedByteDescending(bs),this.writeEscapedByteDescending(YE)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=this.buffer.length*2;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},Jm=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}},Xm=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}},ai=class{constructor(){this.orderedCode=new Ym,this.ascending=new Jm(this.orderedCode),this.descending=new Xm(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return e===0?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}};var oi=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}successor(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function Er(n,e){let t=n.indexId-e.indexId;return t!==0||(t=eb(n.arrayValue,e.arrayValue),t!==0)||(t=eb(n.directionalValue,e.directionalValue),t!==0)?t:F.comparator(n.documentKey,e.documentKey)}function eb(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var bu=class{constructor(e){this.inequalityFilters=new fe((t,r)=>Le.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[];for(let t of e.filters){let r=t;r.isInequality()?this.inequalityFilters=this.inequalityFilters.add(r):this.equalityFilters.push(r)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(K(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=cy(e);if(t!==void 0&&!this.hasMatchingEqualityFilter(t))return!1;let r=fi(e),i=new Set,s=0,a=0;for(;s<r.length&&this.hasMatchingEqualityFilter(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.inequalityFilters.size>0){let o=this.inequalityFilters.getIterator().getNext();if(!i.has(o.field.canonicalString())){let l=r[s];if(!this.matchesFilter(o,l)||!this.matchesOrderBy(this.orderBys[a++],l))return!1}++s}for(;s<r.length;++s){let o=r[s];if(a>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[a++],o))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new fe(Le.comparator),t=[];for(let r of this.equalityFilters){if(r.field.isKeyField())continue;if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Ps(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Ps(r.field,0))}}for(let r of this.orderBys)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Ps(r.field,r.dir==="asc"?0:1)));return new mm(mm.UNKNOWN_ID,this.collectionId,t,ho.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}matchesOrderBy(e,t){return e.field.isEqual(t.fieldPath)?t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc":!1}};function YC(n){var e,t;if(K(n instanceof te||n instanceof ue),n instanceof te)if(n instanceof gu){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>te.create(n.field,"==",s)))||[];return ue.create(i,"or")}else return n;let r=n.filters.map(i=>YC(i));return ue.create(r,n.op)}function $F(n){if(n.getFilters().length===0)return[];let e=Zm(YC(n));return K(JC(e)),_y(e)||Ey(e)?[e]:e.getFilters()}function _y(n){return n instanceof te}function Ey(n){return n instanceof ue&&gy(n)}function JC(n){return _y(n)||Ey(n)||HF(n)}function HF(n){if(n instanceof ue&&Rm(n)){for(let e of n.getFilters())if(!_y(e)&&!Ey(e))return!1;return!0}return!1}function Zm(n){if(K(n instanceof te||n instanceof ue),n instanceof te)return n;if(n.filters.length===1)return Zm(n.filters[0]);let e=n.filters.map(r=>Zm(r)),t=ue.create(e,n.op);return t=Cu(t),JC(t)?t:(K(t instanceof ue),K(Vs(t)),K(t.filters.length>1),t.filters.reduce((r,i)=>by(r,i)))}function by(n,e){K(n instanceof te||n instanceof ue),K(e instanceof te||e instanceof ue);let t;return n instanceof te?e instanceof te?t=QF(n,e):t=tb(n,e):e instanceof te?t=tb(e,n):t=YF(n,e),Cu(t)}function QF(n,e){return ue.create([n,e],"and")}function YF(n,e){if(K(n.filters.length>0&&e.filters.length>0),Vs(n)&&Vs(e))return dC(n,e.getFilters());let t=Rm(n)?n:e,r=Rm(n)?e:n,i=t.filters.map(s=>by(s,r));return ue.create(i,"or")}function tb(n,e){if(Vs(e))return dC(e,n.getFilters());{let t=e.filters.map(r=>by(n,r));return ue.create(t,"or")}}function Cu(n){if(K(n instanceof te||n instanceof ue),n instanceof te)return n;let e=n.getFilters();if(e.length===1)return Cu(e[0]);if(cC(n))return n;let t=e.map(i=>Cu(i)),r=[];return t.forEach(i=>{i instanceof te?r.push(i):i instanceof ue&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:ue.create(r,n.op)}var eg=class{constructor(){this.collectionParentIndex=new Ao}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),E.resolve()}getCollectionParents(e,t){return E.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return E.resolve()}deleteFieldIndex(e,t){return E.resolve()}deleteAllFieldIndexes(e){return E.resolve()}createTargetIndexes(e,t){return E.resolve()}getDocumentsMatchingTarget(e,t){return E.resolve(null)}getIndexType(e,t){return E.resolve(0)}getFieldIndexes(e,t){return E.resolve([])}getNextCollectionGroupToUpdate(e){return E.resolve(null)}getMinOffset(e,t){return E.resolve(Ut.min())}getMinOffsetFromCollectionGroup(e,t){return E.resolve(Ut.min())}updateCollectionGroup(e,t,r){return E.resolve()}updateIndexEntries(e,t){return E.resolve()}},Ao=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new fe(re.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new fe(re.comparator)).toArray()}};var nb="IndexedDbIndexManager",Xc=new Uint8Array(0),tg=class{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new Ao,this.targetToDnfSubTargets=new An(r=>yi(r),(r,i)=>Vo(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let s={collectionId:r,parent:ht(i)};return rb(e).put(s)}return E.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[xb(t),""],!1,!0);return rb(e).loadAll(i).next(s=>{for(let a of s){if(a.collectionId!==t)break;r.push(_n(a.parent))}return r})}addFieldIndex(e,t){let r=eo(e),i=AF(t);delete i.indexId;let s=r.add(i);if(t.indexState){let a=As(e);return s.next(o=>{a.put(GE(o,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}else return s.next()}deleteFieldIndex(e,t){let r=eo(e),i=As(e),s=Is(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=eo(e),r=Is(e),i=As(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>i.deleteAll())}createTargetIndexes(e,t){return E.forEach(this.getSubTargets(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let a=new bu(r).buildTargetIndex();if(a!=null)return this.addFieldIndex(e,a)}}))}getDocumentsMatchingTarget(e,t){let r=Is(e),i=!0,s=new Map;return E.forEach(this.getSubTargets(t),a=>this.getFieldIndex(e,a).next(o=>{i&&(i=!!o),s.set(a,o)})).next(()=>{if(i){let a=X(),o=[];return E.forEach(s,(l,c)=>{x(nb,`Using index ${oM(l)} to execute ${yi(t)}`);let u=NP(c,l),d=OP(c,l),f=kP(c,l),v=xP(c,l),b=this.encodeBound(l,c,f),I=this.encodeBound(l,c,v),A=this.encodeValues(l,c,d),M=this.generateIndexRanges(l.indexId,u,b,f.inclusive,I,v.inclusive,A);return E.forEach(M,D=>r.loadFirst(D,t.limit).next(B=>{B.forEach(P=>{let j=F.fromSegments(P.documentKey);a.has(j)||(a=a.add(j),o.push(j))})}))}).next(()=>o)}else return E.resolve(null)})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(e.filters.length===0?t=[e]:t=$F(ue.create(e.filters,"and")).map(i=>Fm(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t),t)}generateIndexRanges(e,t,r,i,s,a,o){let l=(t!=null?t.length:1)*Math.max(r.length,s.length),c=l/(t!=null?t.length:1),u=[];for(let d=0;d<l;++d){let f=t?this.encodeSingleElement(t[d/c]):Xc,v=this.generateLowerBound(e,f,r[d%c],i),b=this.generateUpperBound(e,f,s[d%c],a),I=o.map(A=>this.generateLowerBound(e,f,A,!0));u.push(...this.createRange(v,b,I))}return u}generateLowerBound(e,t,r,i){let s=new oi(e,F.empty(),t,r);return i?s:s.successor()}generateUpperBound(e,t,r,i){let s=new oi(e,F.empty(),t,r);return i?s.successor():s}getFieldIndex(e,t){let r=new bu(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let a=null;for(let o of s)r.servedByIndex(o)&&(!a||o.fields.length>a.fields.length)&&(a=o);return a})}getIndexType(e,t){let r=2,i=this.getSubTargets(t);return E.forEach(i,s=>this.getFieldIndex(e,s).next(a=>{a?r!==0&&a.fields.length<MP(s)&&(r=1):r=0})).next(()=>PP(t)&&i.length>1&&r===2?1:r)}encodeDirectionalElements(e,t){let r=new ai;for(let i of fi(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let a=r.forKind(i.kind);qn.INSTANCE.writeIndexValue(s,a)}return r.encodedBytes()}encodeSingleElement(e){let t=new ai;return qn.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new ai;return qn.INSTANCE.writeIndexValue(mi(this.databaseId,t),r.forKind(aM(e))),r.encodedBytes()}encodeValues(e,t,r){if(r===null)return[];let i=[];i.push(new ai);let s=0;for(let a of fi(e)){let o=r[s++];for(let l of i)if(this.isInFilter(t,a.fieldPath)&&vo(o))i=this.expandIndexValues(i,a,o);else{let c=l.forKind(a.kind);qn.INSTANCE.writeIndexValue(o,c)}}return this.getEncodedBytes(i)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let i=[...e],s=[];for(let a of r.arrayValue.values||[])for(let o of i){let l=new ai;l.seed(o.encodedBytes()),qn.INSTANCE.writeIndexValue(a,l.forKind(t.kind)),s.push(l)}return s}isInFilter(e,t){return!!e.filters.find(r=>r instanceof te&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=eo(e),i=As(e);return(t?r.loadAll(_m,IDBKeyRange.bound(t,t)):r.loadAll()).next(s=>{let a=[];return E.forEach(s,o=>i.get([o.indexId,this.uid]).next(l=>{a.push(RF(o,l))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:J(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=eo(e),s=As(e);return this.getNextSequenceNumber(e).next(a=>i.loadAll(_m,IDBKeyRange.bound(t,t)).next(o=>E.forEach(o,l=>s.put(GE(l.indexId,this.uid,a,r)))))}updateIndexEntries(e,t){let r=new Map;return E.forEach(t,(i,s)=>{let a=r.get(i.collectionGroup);return(a?E.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),E.forEach(l,c=>this.getExistingIndexEntries(e,i,c).next(u=>{let d=this.computeIndexEntries(s,c);return u.isEqual(d)?E.resolve():this.updateEntries(e,s,c,u,d)}))))})}addIndexEntry(e,t,r,i){return Is(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(r,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,r,i){return Is(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.encodeDirectionalKey(r,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,r){let i=Is(e),s=new fe(Er);return i.iterate({index:Wb,range:IDBKeyRange.only([r.indexId,this.uid,this.encodeDirectionalKey(r,t)])},(a,o)=>{s=s.add(new oi(r.indexId,t,o.arrayValue,o.directionalValue))}).next(()=>s)}computeIndexEntries(e,t){let r=new fe(Er),i=this.encodeDirectionalElements(t,e);if(i==null)return r;let s=cy(t);if(s!=null){let a=e.data.field(s.fieldPath);if(vo(a))for(let o of a.arrayValue.values||[])r=r.add(new oi(t.indexId,e.key,this.encodeSingleElement(o),i))}else r=r.add(new oi(t.indexId,e.key,Xc,i));return r}updateEntries(e,t,r,i,s){x(nb,"Updating index entries for document '%s'",t.key);let a=[];return jM(i,s,Er,o=>{a.push(this.addIndexEntry(e,t,r,o))},o=>{a.push(this.deleteIndexEntry(e,t,r,o))}),E.waitFor(a)}getNextSequenceNumber(e){let t=1;return As(e).iterate({index:Kb,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,s,a)=>{a.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((a,o)=>Er(a,o)).filter((a,o,l)=>!o||Er(a,l[o-1])!==0);let i=[];i.push(e);for(let a of r){let o=Er(a,e),l=Er(a,t);if(o===0)i[0]=e.successor();else if(o>0&&l<0)i.push(a),i.push(a.successor());else if(l>0)break}i.push(t);let s=[];for(let a=0;a<i.length;a+=2){if(this.isRangeMatchable(i[a],i[a+1]))return[];let o=[i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,Xc,[]],l=[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,Xc,[]];s.push(IDBKeyRange.bound(o,l))}return s}isRangeMatchable(e,t){return Er(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(ib)}getMinOffset(e,t){return E.mapArray(this.getSubTargets(t),r=>this.getFieldIndex(e,r).next(i=>i||V())).next(ib)}};function rb(n){return Je(n,fo)}function Is(n){return Je(n,id)}function eo(n){return Je(n,fy)}function As(n){return Je(n,rd)}function ib(n){K(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;uy(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Ut(e.readTime,e.documentKey,t)}function XC(n,e,t){let r=n.store(Jt),i=n.store(na),s=[],a=IDBKeyRange.only(t.batchId),o=0,l=r.iterate({range:a},(u,d,f)=>(o++,f.delete()));s.push(l.next(()=>{K(o===1)}));let c=[];for(let u of t.mutations){let d=zb(e,u.key.path,t.batchId);s.push(i.delete(d)),c.push(u.key)}return E.waitFor(s).next(()=>c)}function Iu(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else if(n.noDocument)e=n.noDocument;else throw V();return JSON.stringify(e).length}var Au=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.documentKeysByBatchId={}}static forUser(e,t,r,i){K(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return br(e).iterate({index:li,range:r},(i,s,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=ks(e),a=br(e);return a.add({}).next(o=>{K(typeof o=="number");let l=new wo(o,t,r,i),c=vF(this.serializer,this.userId,l),u=[],d=new fe((f,v)=>J(f.canonicalString(),v.canonicalString()));for(let f of i){let v=zb(this.userId,f.key.path,o);d=d.add(f.key.path.popLast()),u.push(a.put(c)),u.push(s.put(v,mM))}return d.forEach(f=>{u.push(this.indexManager.addToCollectionParentIndex(e,f))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[o]=l.keys()}),E.waitFor(u).next(()=>l)})}lookupMutationBatch(e,t){return br(e).get(t).next(r=>r?(K(r.userId===this.userId),si(this.serializer,r)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?E.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.documentKeysByBatchId[t]=i,i}else return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return br(e).iterate({index:li,range:i},(a,o,l)=>{o.userId===this.userId&&(K(o.batchId>=r),s=si(this.serializer,o)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=Dr;return br(e).iterate({index:li,range:t,reverse:!0},(i,s,a)=>{r=s.batchId,a.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,Dr],[this.userId,Number.POSITIVE_INFINITY]);return br(e).loadAll(li,t).next(r=>r.map(i=>si(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=nu(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return ks(e).iterate({range:i},(a,o,l)=>{let[c,u,d]=a,f=_n(u);if(c!==this.userId||!t.path.isEqual(f)){l.done();return}return br(e).get(d).next(v=>{if(!v)throw V();K(v.userId===this.userId),s.push(si(this.serializer,v))})}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new fe(J),i=[];return t.forEach(s=>{let a=nu(this.userId,s.path),o=IDBKeyRange.lowerBound(a),l=ks(e).iterate({range:o},(c,u,d)=>{let[f,v,b]=c,I=_n(v);if(f!==this.userId||!s.path.isEqual(I)){d.done();return}r=r.add(b)});i.push(l)}),E.waitFor(i).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=nu(this.userId,r),a=IDBKeyRange.lowerBound(s),o=new fe(J);return ks(e).iterate({range:a},(l,c,u)=>{let[d,f,v]=l,b=_n(f);if(d!==this.userId||!r.isPrefixOf(b)){u.done();return}b.length===i&&(o=o.add(v))}).next(()=>this.lookupMutationBatches(e,o))}lookupMutationBatches(e,t){let r=[],i=[];return t.forEach(s=>{i.push(br(e).get(s).next(a=>{if(a===null)throw V();K(a.userId===this.userId),r.push(si(this.serializer,a))}))}),E.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return XC(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),E.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return E.resolve();let r=IDBKeyRange.lowerBound(pM(this.userId)),i=[];return ks(e).iterate({range:r},(s,a,o)=>{if(s[0]!==this.userId){o.done();return}else{let c=_n(s[1]);i.push(c)}}).next(()=>{K(i.length===0)})})}containsKey(e,t){return ZC(e,this.userId,t)}getMutationQueueMetadata(e){return e0(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:Dr,lastStreamToken:""})}};function ZC(n,e,t){let r=nu(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),a=!1;return ks(n).iterate({range:s,keysOnly:!0},(o,l,c)=>{let[u,d,f]=o;u===e&&d===i&&(a=!0),c.done()}).next(()=>a)}function JF(n,e){let t=!1;return e0(n).iterateSerial(r=>ZC(n,r,e).next(i=>(i&&(t=!0),E.resolve(!i)))).next(()=>t)}function br(n){return Je(n,Jt)}function ks(n){return Je(n,na)}function e0(n){return Je(n,Bo)}var tm=2,$s=class n{constructor(e){this.lastId=e}next(){return this.lastId+=tm,this.lastId}static forTargetCache(){return new n(2-tm)}static forSyncEngine(){return new n(1-tm)}};var ng=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new $s(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(t=>$.fromTimestamp(new Ce(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.saveMetadata(e,i)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Rs(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(r=>(K(r.targetCount>0),r.targetCount-=1,this.saveMetadata(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Rs(e).iterate((a,o)=>{let l=io(o);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>E.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Rs(e).iterate((r,i)=>{let s=io(i);t(s)})}retrieveMetadata(e){return sb(e).get(fu).next(t=>(K(t!==null),t))}saveMetadata(e,t){return sb(e).put(fu,t)}saveTargetData(e,t){return Rs(e).put(HC(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(t=>t.targetCount)}getTargetData(e,t){let r=yi(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Rs(e).iterate({range:i,index:jb},(a,o,l)=>{let c=io(o);Vo(t,c.target)&&(s=c,l.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=Ir(e);return t.forEach(a=>{let o=ht(a.path);i.push(s.put({targetId:r,path:o})),i.push(this.referenceDelegate.addReference(e,r,a))}),E.waitFor(i)}removeMatchingKeys(e,t,r){let i=Ir(e);return E.forEach(t,s=>{let a=ht(s.path);return E.waitFor([i.delete([r,a]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=Ir(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Ir(e),s=X();return i.iterate({range:r,keysOnly:!0},(a,o,l)=>{let c=_n(a[1]),u=new F(c);s=s.add(u)}).next(()=>s)}containsKey(e,t){let r=ht(t.path),i=IDBKeyRange.bound([r],[xb(r)],!1,!0),s=0;return Ir(e).iterate({index:hy,keysOnly:!0,range:i},([a,o],l,c)=>{a!==0&&(s++,c.done())}).next(()=>s>0)}getTargetDataForTarget(e,t){return Rs(e).get(t).next(r=>r?io(r):null)}};function Rs(n){return Je(n,ra)}function sb(n){return Je(n,Ii)}function Ir(n){return Je(n,ia)}var ab={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},jo=-1,t0=40*1024*1024,Bt=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};Bt.DEFAULT_COLLECTION_PERCENTILE=10;Bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;Bt.DEFAULT=new Bt(t0,Bt.DEFAULT_COLLECTION_PERCENTILE,Bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);Bt.DISABLED=new Bt(jo,0,0);var ob="LruGarbageCollector",lb=1*1024*1024,XF=1*60*1e3,ZF=5*60*1e3;function cb([n,e],[t,r]){let i=J(n,t);return i===0?J(e,r):i}var rg=class{constructor(e){this.maxElements=e,this.buffer=new fe(cb),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();cb(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},ig=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==jo&&this.scheduleGC(XF)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){x(ob,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>_(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){zr(t)?x(ob,"Ignoring IndexedDB error during garbage collection: ",t):yield Vr(t)}yield this.scheduleGC(ZF)}))}},sg=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return E.resolve(bt.INVALID);let r=new rg(t);return this.delegate.forEachTarget(e,i=>r.addElement(i.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,i=>r.addElement(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===jo?(x("LruGarbageCollector","Garbage collection skipped; disabled"),E.resolve(ab)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(x("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ab):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,i,s,a,o,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(x("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),i=this.params.maximumSequenceNumbersToCollect):i=d,a=Date.now(),this.nthSequenceNumber(e,i))).next(d=>(r=d,o=Date.now(),this.removeTargets(e,r,t))).next(d=>(s=d,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>{if(c=Date.now(),Ds()<=rn.DEBUG){let f=`LRU Garbage Collection
	Counted targets in ${a-u}ms
	Determined least recently used ${i} in ${o-a}ms
	Removed ${s} targets in ${l-o}ms
	Removed ${d} documents in ${c-l}ms
Total Duration: ${c-u}ms`;x("LruGarbageCollector",f)}return E.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:d})})}};function e2(n,e){return new sg(n,e)}var ag=class{constructor(e,t){this.db=e,this.garbageCollector=e2(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(r,i)=>t(i))}addReference(e,t,r){return Zc(e,r)}removeReference(e,t,r){return Zc(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Zc(e,t)}isPinned(e,t){return JF(e,t)}removeOrphanedDocuments(e,t){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],a=0;return this.forEachOrphanedDocument(e,(l,c)=>{if(c<=t){let u=this.isPinned(e,l).next(d=>{if(!d)return a++,i.getEntry(e,l).next(()=>(i.removeEntry(l,$.min()),Ir(e).delete(t2(l))))});s.push(u)}}).next(()=>E.waitFor(s)).next(()=>i.apply(e)).next(()=>a)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Zc(e,t)}forEachOrphanedDocument(e,t){let r=Ir(e),i=bt.INVALID,s;return r.iterate({index:hy},([a,o],{path:l,sequenceNumber:c})=>{a===0?(i!==bt.INVALID&&t(new F(_n(s)),i),i=c,s=l):i=bt.INVALID}).next(()=>{i!==bt.INVALID&&t(new F(_n(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function t2(n){return[0,ht(n.path)]}function n2(n,e){return{targetId:0,path:ht(n.path),sequenceNumber:e}}function Zc(n,e){return Ir(n).put(n2(e,n.currentSequenceNumber))}var Ru=class{constructor(){this.changes=new An(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ve.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?E.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var og=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return ni(e).put(r)}removeEntry(e,t,r){return ni(e).delete(r2(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=Ve.newInvalidDocument(t);return ni(e).iterate({index:ru,range:IDBKeyRange.only(to(t))},(i,s)=>{r=this.maybeDecodeDocument(t,s)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:Ve.newInvalidDocument(t)};return ni(e).iterate({index:ru,range:IDBKeyRange.only(to(t))},(i,s)=>{r={document:this.maybeDecodeDocument(t,s),size:Iu(s)}}).next(()=>r)}getEntries(e,t){let r=vt();return this.forEachDbEntry(e,t,(i,s)=>{let a=this.maybeDecodeDocument(i,s);r=r.insert(i,a)}).next(()=>r)}getSizedEntries(e,t){let r=vt(),i=new ve(F.comparator);return this.forEachDbEntry(e,t,(s,a)=>{let o=this.maybeDecodeDocument(s,a);r=r.insert(s,o),i=i.insert(s,Iu(a))}).next(()=>({documents:r,sizeMap:i}))}forEachDbEntry(e,t,r){if(t.isEmpty())return E.resolve();let i=new fe(hb);t.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(to(i.first()),to(i.last())),a=i.getIterator(),o=a.getNext();return ni(e).iterate({index:ru,range:s},(l,c,u)=>{let d=F.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;o&&hb(o,d)<0;)r(o,null),o=a.getNext();o&&o.isEqual(d)&&(r(o,c),o=a.hasNext()?a.getNext():null),o?u.skip(to(o)):u.done()}).next(()=>{for(;o;)r(o,null),o=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let a=t.path,o=[a.popLast().toArray(),a.lastSegment(),cd(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ni(e).loadAll(IDBKeyRange.bound(o,l,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let u=vt();for(let d of c){let f=this.maybeDecodeDocument(F.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);f.isFoundDocument()&&(Go(t,f)||i.has(f.key))&&(u=u.insert(f.key,f))}return u})}getAllFromCollectionGroup(e,t,r,i){let s=vt(),a=db(t,r),o=db(t,Ut.max());return ni(e).iterate({index:Gb,range:IDBKeyRange.bound(a,o,!0)},(l,c,u)=>{let d=this.maybeDecodeDocument(F.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(d.key,d),s.size===i&&u.done()}).next(()=>s)}newChangeBuffer(e){return new lg(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return ub(e).get(wm).next(t=>(K(!!t),t))}setMetadata(e,t){return ub(e).put(wm,t)}maybeDecodeDocument(e,t){if(t){let r=gF(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual($.min())))return r}return Ve.newInvalidDocument(e)}};function n0(n){return new og(n)}var lg=class extends Ru{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new An(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new fe((s,a)=>J(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{let o=this.documentStates.get(s);if(t.push(this.documentCache.removeEntry(e,s,o.readTime)),a.isValidDocument()){let l=zE(this.documentCache.serializer,a);i=i.add(s.path.popLast());let c=Iu(l);r+=c-o.size,t.push(this.documentCache.addEntry(e,s,l))}else if(r-=o.size,this.trackRemovals){let l=zE(this.documentCache.serializer,a.convertToNoDocument($.min()));t.push(this.documentCache.addEntry(e,s,l))}}),i.forEach(s=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.documentCache.updateMetadata(e,r)),E.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(r=>(this.documentStates.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:r,sizeMap:i})=>(i.forEach((s,a)=>{this.documentStates.set(s,{size:a,readTime:r.get(s).readTime})}),r))}};function ub(n){return Je(n,qo)}function ni(n){return Je(n,ed)}function to(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function r2(n,e){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],cd(e),t[t.length-1]]}function db(n,e){let t=e.documentKey.path.toArray();return[n,cd(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function hb(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=J(t[s],r[s]),i)return i;return i=J(t.length,r.length),i||(i=J(t[t.length-2],r[r.length-2]),i)?i:J(t[t.length-1],r[r.length-1])}var i2=16;var cg=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Du=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&lo(r.mutation,i,Ct.empty(),Ce.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,X()).next(()=>r))}getLocalViewOfDocuments(e,t,r=X()){let i=En();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let a=ro();return s.forEach((o,l)=>{a=a.insert(o,l.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=En();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,X()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,o)=>{t.set(a,o)})})}computeViews(e,t,r,i){let s=vt(),a=So(),o=YP();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof en)?s=s.insert(c.key,c):u!==void 0?(a.set(c.key,u.mutation.getFieldMask()),lo(u.mutation,c,u.mutation.getFieldMask(),Ce.now())):a.set(c.key,Ct.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>a.set(c,u)),t.forEach((c,u)=>{var d;return o.set(c,new cg(u,(d=a.get(c))!==null&&d!==void 0?d:null))}),o))}recalculateAndSaveOverlays(e,t){let r=So(),i=new ve((a,o)=>a-o),s=X();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let o of a)o.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||Ct.empty();u=o.applyToLocalView(c,u),r.set(l,u);let d=(i.get(o.batchId)||X()).add(l);i=i.insert(o.batchId,d)})}).next(()=>{let a=[],o=i.getReverseIterator();for(;o.hasNext();){let l=o.getNext(),c=l.key,u=l.value,d=_C();u.forEach(f=>{if(!s.has(f)){let v=NC(t.get(f),r.get(f));v!==null&&d.set(f,v),s=s.add(f)}}),a.push(this.documentOverlayCache.saveOverlays(e,c,d))}return E.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return qP(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):yy(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):E.resolve(En()),o=Bs,l=s;return a.next(c=>E.forEach(c,(u,d)=>(o<d.largestBatchId&&(o=d.largestBatchId),s.get(u)?E.resolve():this.remoteDocumentCache.getEntry(e,u).next(f=>{l=l.insert(u,f)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,X())).next(u=>({batchId:o,changes:wC(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new F(t)).next(r=>{let i=ro();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,a=ro();return this.indexManager.getCollectionParents(e,s).next(o=>E.forEach(o,l=>{let c=LP(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((d,f)=>{a=a.insert(d,f)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(a=>{s.forEach((l,c)=>{let u=c.getKey();a.get(u)===null&&(a=a.insert(u,Ve.newInvalidDocument(u)))});let o=ro();return a.forEach((l,c)=>{let u=s.get(l);u!==void 0&&lo(u.mutation,c,Ct.empty(),Ce.now()),Go(t,c)&&(o=o.insert(l,c))}),o})}};var ug=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return E.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,CF(t)),E.resolve()}getNamedQuery(e,t){return E.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,bF(t)),E.resolve()}};var dg=class{constructor(){this.overlays=new ve(F.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return E.resolve(this.overlays.get(t))}getOverlays(e,t){let r=En();return E.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),E.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),E.resolve()}getOverlaysForCollection(e,t,r){let i=En(),s=t.length+1,a=new F(t.child("")),o=this.overlays.getIteratorFrom(a);for(;o.hasNext();){let c=o.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return E.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new ve((c,u)=>c-u),a=this.overlays.getIterator();for(;a.hasNext();){let u=a.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let f=s.get(u.largestBatchId);f===null&&(f=En(),s=s.insert(u.largestBatchId,f)),f.set(u.getKey(),u)}}let o=En(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,f)=>o.set(d,f)),!(o.size()>=i)););return E.resolve(o)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new _o(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=X(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var Ro=class{constructor(){this.refsByKey=new fe(Ue.compareByKey),this.refsByTarget=new fe(Ue.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new Ue(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new Ue(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new F(new re([])),r=new Ue(t,e),i=new Ue(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],a=>{this.removeRef(a),s.push(a.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new F(new re([])),r=new Ue(t,e),i=new Ue(t,e+1),s=X();return this.refsByTarget.forEachInRange([r,i],a=>{s=s.add(a.key)}),s}containsKey(e){let t=new Ue(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},Ue=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return F.comparator(e.key,t.key)||J(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return J(e.targetOrBatchId,t.targetOrBatchId)||F.comparator(e.key,t.key)}};var hg=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new fe(Ue.compareByKey)}checkEmpty(e){return E.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new wo(s,t,r,i);this.mutationQueue.push(a);for(let o of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new Ue(o.key,s)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return E.resolve(a)}lookupMutationBatch(e,t){return E.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return E.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return E.resolve(this.mutationQueue.length===0?Dr:this.nextBatchId-1)}getAllMutationBatches(e){return E.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new Ue(t,0),i=new Ue(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],a=>{let o=this.findMutationBatch(a.targetOrBatchId);s.push(o)}),E.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new fe(J);return t.forEach(i=>{let s=new Ue(i,0),a=new Ue(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,a],o=>{r=r.add(o.targetOrBatchId)})}),E.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;F.isDocumentKey(s)||(s=s.child(""));let a=new Ue(new F(s),0),o=new fe(J);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(o=o.add(l.targetOrBatchId)),!0):!1},a),E.resolve(this.findMutationBatches(o))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");K(r===0),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return E.forEach(t.mutations,s=>{let a=new Ue(s.key,t.batchId);return i=i.delete(a),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new Ue(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return E.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,E.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function s2(){return new ve(F.comparator)}var fg=class{constructor(e){this.sizer=e,this.docs=s2(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,a=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return E.resolve(r?r.document.mutableCopy():Ve.newInvalidDocument(t))}getEntries(e,t){let r=vt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Ve.newInvalidDocument(i))}),E.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=vt(),a=t.path,o=new F(a.child("")),l=this.docs.getIteratorFrom(o);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!a.isPrefixOf(c.path))break;c.path.length>a.length+1||uy(Pb(u),r)<=0||!i.has(u.key)&&!Go(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return E.resolve(s)}getAllFromCollectionGroup(e,t,r,i){V()}forEachDocumentKey(e,t){return E.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new pg(this)}getSize(e){return E.resolve(this.size)}};function a2(n){return new fg(n)}var pg=class extends Ru{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),E.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var mg=class{constructor(e){this.persistence=e,this.targets=new An(t=>yi(t),Vo),this.lastRemoteSnapshotVersion=$.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Ro,this.targetCount=0,this.targetIdGenerator=$s.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),E.resolve()}getLastRemoteSnapshotVersion(e){return E.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return E.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),E.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),E.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new $s(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,E.resolve()}updateTargetData(e,t){return this.saveTargetData(t),E.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,E.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((a,o)=>{o.sequenceNumber<=t&&r.get(o.targetId)===null&&(this.targets.delete(a),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)}),E.waitFor(s).next(()=>i)}getTargetCount(e){return E.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return E.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),E.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),E.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),E.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return E.resolve(r)}containsKey(e,t){return E.resolve(this.references.containsKey(t))}};var o2="MemoryPersistence",Nu=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new bt(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new mg(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new eg,this.remoteDocumentCache=a2(r),this.serializer=new _u(t),this.bundleCache=new ug(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new dg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new hg(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){x(o2,"Starting transaction:",e);let i=new gg(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return E.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},gg=class extends du{constructor(e){super(),this.currentSequenceNumber=e}},Ou=class n{constructor(e){this.persistence=e,this.localViewReferences=new Ro,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw V()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),E.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),E.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),E.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(a=>this.orphanedDocuments.add(a.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return E.forEach(this.orphanedDocuments,i=>{let s=F.fromPath(i);return this.isReferenced(e,s).next(a=>{a||r.removeEntry(s,$.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return E.or([()=>E.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var yg=class{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,i){let s=new hu("createOrUpgrade",t);r<1&&i>=1&&(c2(e),u2(e),fb(e),h2(e));let a=E.resolve();return r<3&&i>=3&&(r!==0&&(m2(e),fb(e)),a=a.next(()=>y2(s))),r<4&&i>=4&&(r!==0&&(a=a.next(()=>d2(e,s))),a=a.next(()=>{v2(e)})),r<5&&i>=5&&(a=a.next(()=>this.removeAcknowledgedMutations(s))),r<6&&i>=6&&(a=a.next(()=>(p2(e),this.addDocumentGlobal(s)))),r<7&&i>=7&&(a=a.next(()=>this.ensureSequenceNumbers(s))),r<8&&i>=8&&(a=a.next(()=>this.createCollectionParentIndex(e,s))),r<9&&i>=9&&(a=a.next(()=>{g2(e)})),r<10&&i>=10&&(a=a.next(()=>this.rewriteCanonicalIds(s))),r<11&&i>=11&&(a=a.next(()=>{S2(e),T2(e)})),r<12&&i>=12&&(a=a.next(()=>{_2(e)})),r<13&&i>=13&&(a=a.next(()=>f2(e)).next(()=>this.rewriteRemoteDocumentCache(e,s)).next(()=>e.deleteObjectStore(ii))),r<14&&i>=14&&(a=a.next(()=>this.runOverlayMigration(e,s))),r<15&&i>=15&&(a=a.next(()=>w2(e))),r<16&&i>=16&&(a=a.next(()=>{t.objectStore(rd).clear()}).next(()=>{t.objectStore(id).clear()})),a}addDocumentGlobal(e){let t=0;return e.store(ii).iterate((r,i)=>{t+=Iu(i)}).next(()=>{let r={byteSize:t};return e.store(qo).put(wm,r)})}removeAcknowledgedMutations(e){let t=e.store(Bo),r=e.store(Jt);return t.loadAll().next(i=>E.forEach(i,s=>{let a=IDBKeyRange.bound([s.userId,Dr],[s.userId,s.lastAcknowledgedBatchId]);return r.loadAll(li,a).next(o=>E.forEach(o,l=>{K(l.userId===s.userId);let c=si(this.serializer,l);return XC(e,s.userId,c).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(ia),r=e.store(ii);return e.store(Ii).get(fu).next(s=>{let a=l=>t.put({targetId:0,path:ht(l),sequenceNumber:s.highestListenSequenceNumber}),o=[];return r.iterate((l,c)=>{let u=new re(l),d=l2(u);o.push(t.get(d).next(f=>f?E.resolve():a(u)))}).next(()=>E.waitFor(o))})}createCollectionParentIndex(e,t){e.createObjectStore(fo,{keyPath:EM});let r=t.store(fo),i=new Ao,s=a=>{if(i.add(a)){let o=a.lastSegment(),l=a.popLast();return r.put({collectionId:o,parent:ht(l)})}};return t.store(ii).iterate({keysOnly:!0},(a,o)=>{let l=new re(a);return s(l.popLast())}).next(()=>t.store(na).iterate({keysOnly:!0},([a,o,l],c)=>{let u=_n(o);return s(u.popLast())}))}rewriteCanonicalIds(e){let t=e.store(ra);return t.iterate((r,i)=>{let s=io(i),a=HC(this.serializer,s);return t.put(a)})}rewriteRemoteDocumentCache(e,t){let r=t.store(ii),i=[];return r.iterate((s,a)=>{let o=t.store(ed),l=E2(a).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};i.push(o.put(c))}).next(()=>E.waitFor(i))}runOverlayMigration(e,t){let r=t.store(Jt),i=n0(this.serializer),s=new Nu(Ou.factory,this.serializer.remoteSerializer);return r.loadAll().next(a=>{let o=new Map;return a.forEach(l=>{var c;let u=(c=o.get(l.userId))!==null&&c!==void 0?c:X();si(this.serializer,l).keys().forEach(f=>u=u.add(f)),o.set(l.userId,u)}),E.forEach(o,(l,c)=>{let u=new ze(c),d=Eu.forUser(this.serializer,u),f=s.getIndexManager(u),v=Au.forUser(u,this.serializer,f,s.referenceDelegate);return new Du(i,v,d,f).recalculateAndSaveOverlaysForDocumentKeys(new po(t,bt.INVALID),l).next()})})}};function l2(n){return[0,ht(n)]}function c2(n){n.createObjectStore(Fo)}function u2(n){n.createObjectStore(Bo,{keyPath:fM}),n.createObjectStore(Jt,{keyPath:Ub,autoIncrement:!0}).createIndex(li,Vb,{unique:!0}),n.createObjectStore(na)}function d2(n,e){return e.store(Jt).loadAll().next(r=>{n.deleteObjectStore(Jt),n.createObjectStore(Jt,{keyPath:Ub,autoIncrement:!0}).createIndex(li,Vb,{unique:!0});let s=e.store(Jt),a=r.map(o=>s.put(o));return E.waitFor(a)})}function h2(n){n.createObjectStore(ii)}function f2(n){let e=n.createObjectStore(ed,{keyPath:gM});e.createIndex(ru,yM),e.createIndex(Gb,vM)}function p2(n){n.createObjectStore(qo)}function fb(n){n.createObjectStore(ia,{keyPath:wM}).createIndex(hy,_M,{unique:!0}),n.createObjectStore(ra,{keyPath:SM}).createIndex(jb,TM,{unique:!0}),n.createObjectStore(Ii)}function m2(n){n.deleteObjectStore(ia),n.deleteObjectStore(ra),n.deleteObjectStore(Ii)}function g2(n){n.objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges")}function y2(n){let e=n.store(Ii),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:$.min().toTimestamp(),targetCount:0};return e.put(fu,t)}function v2(n){n.createObjectStore(qs,{keyPath:bM})}function S2(n){n.createObjectStore(td,{keyPath:CM})}function T2(n){n.createObjectStore(nd,{keyPath:IM})}function w2(n){n.createObjectStore(fy,{keyPath:AM,autoIncrement:!0}).createIndex(_m,RM,{unique:!1}),n.createObjectStore(rd,{keyPath:DM}).createIndex(Kb,NM,{unique:!1}),n.createObjectStore(id,{keyPath:OM}).createIndex(Wb,kM,{unique:!1})}function _2(n){let e=n.createObjectStore(sd,{keyPath:xM});e.createIndex(Em,MM,{unique:!1}),e.createIndex($b,PM,{unique:!1})}function E2(n){return n.document?new F(re.fromString(n.document.name).popFirst(5)):n.noDocument?F.fromSegments(n.noDocument.path):n.unknownDocument?F.fromSegments(n.unknownDocument.path):V()}var Cr="IndexedDbPersistence",nm=30*60*1e3,rm=5e3,b2=4e3,im="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",C2="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",I2="firestore_zombie",r0="main",vg=class n{constructor(e,t,r,i,s,a,o,l,c,u,d=i2){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=s,this.window=a,this.document=o,this.sequenceNumberSyncer=c,this.forceOwningTab=u,this.schemaVersion=d,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=f=>Promise.resolve(),!n.isAvailable())throw new N(C.UNIMPLEMENTED,C2);this.referenceDelegate=new ag(this,i),this.dbName=t+r0,this.serializer=new _u(l),this.simpleDb=new Or(this.dbName,this.schemaVersion,new yg(this.serializer)),this.targetCache=new ng(this.referenceDelegate,this.serializer),this.remoteDocumentCache=n0(this.serializer),this.bundleCache=new Qm,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,u===!1&&be(Cr,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new N(C.FAILED_PRECONDITION,im);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new bt(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=t=>_(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(t=>_(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(()=>_(this,null,function*(){this.started&&(yield this.updateClientMetadataAndTryBecomePrimary())})))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>eu(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(r=>{r||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(r=>this.isPrimary&&!r?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):r?this.acquireOrExtendPrimaryLease(e).next(()=>!0):!1)).catch(e=>{if(zr(e))return x(Cr,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return x(Cr,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return no(e).get(_s).next(r=>E.resolve(this.isLocalClient(r)))}removeClientMetadata(e){return eu(e).delete(this.clientId)}maybeGarbageCollectMultiClientState(){return _(this,null,function*(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,nm)){this.lastGarbageCollectionTime=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=Je(t,qs);return r.loadAll().next(i=>{let s=this.filterActiveClients(i,nm),a=i.filter(o=>s.indexOf(o)===-1);return E.forEach(a,o=>r.delete(o.clientId)).next(()=>a)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}})}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",b2,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return e?e.ownerId===this.clientId:!1}canActAsPrimary(e){return this.forceOwningTab?E.resolve(!0):no(e).get(_s).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,rm)&&!this.isClientZombied(r.ownerId)){if(this.isLocalClient(r)&&this.networkEnabled)return!0;if(!this.isLocalClient(r)){if(!r.allowTabSynchronization)throw new N(C.FAILED_PRECONDITION,im);return!1}}return this.networkEnabled&&this.inForeground?!0:eu(e).loadAll().next(s=>this.filterActiveClients(s,rm).find(o=>{if(this.clientId!==o.clientId){let l=!this.networkEnabled&&o.networkEnabled,c=!this.inForeground&&o.inForeground,u=this.networkEnabled===o.networkEnabled;if(l||c&&u)return!0}return!1})===void 0)}).next(r=>(this.isPrimary!==r&&x(Cr,`Client ${r?"is":"is not"} eligible for a primary lease.`),r))}shutdown(){return _(this,null,function*(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),yield this.simpleDb.runTransaction("shutdown","readwrite",[Fo,qs],e=>{let t=new po(e,bt.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()})}filterActiveClients(e,t){return e.filter(r=>this.isWithinAge(r.updateTimeMs,t)&&!this.isClientZombied(r.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>eu(e).loadAll().next(t=>this.filterActiveClients(t,nm).map(r=>r.clientId)))}get started(){return this._started}getMutationQueue(e,t){return Au.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new tg(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return Eu.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){x(Cr,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=GM(this.schemaVersion),a;return this.simpleDb.runTransaction(e,i,s,o=>(a=new po(o,this.listenSequence?this.listenSequence.next():bt.INVALID),t==="readwrite-primary"?this.verifyPrimaryLease(a).next(l=>l?!0:this.canActAsPrimary(a)).next(l=>{if(!l)throw be(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new N(C.FAILED_PRECONDITION,Lb);return r(a)}).next(l=>this.acquireOrExtendPrimaryLease(a).next(()=>l)):this.verifyAllowTabSynchronization(a).next(()=>r(a)))).then(o=>(a.raiseOnCommittedEvent(),o))}verifyAllowTabSynchronization(e){return no(e).get(_s).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,rm)&&!this.isClientZombied(r.ownerId)&&!this.isLocalClient(r)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!r.allowTabSynchronization))throw new N(C.FAILED_PRECONDITION,im)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return no(e).put(_s,t)}static isAvailable(){return Or.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=no(e);return t.get(_s).next(r=>this.isLocalClient(r)?(x(Cr,"Releasing primary lease."),t.delete(_s)):E.resolve())}isWithinAge(e,t){let r=Date.now(),i=r-t,s=r;return e<i?!1:e>s?(be(`Detected an update time that is in the future: ${e} > ${s}`),!1):!0}attachVisibilityHandler(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground=this.document.visibilityState==="visible")}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.windowUnloadHandler=()=>{this.markClientZombied();let t=/(?:Version|Mobile)\/1[456]/;Dd()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let r=((t=this.webStorage)===null||t===void 0?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return x(Cr,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return be(Cr,"Failed to get zombied client id.",r),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){be("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch{}}zombiedClientLocalStorageKey(e){return`${I2}_${this.persistenceKey}_${e}`}};function no(n){return Je(n,Fo)}function eu(n){return Je(n,qs)}function Cy(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function A2(n){return _(this,null,function*(){if(!Or.isAvailable())return Promise.resolve();let e=n+r0;yield Or.delete(e)})}var Iy="LocalStore",R2=5*60*1e6,Do=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new ve(J),this.targetIdByTarget=new An(s=>yi(s),Vo),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Du(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function i0(n,e,t,r){return new Do(n,e,t,r)}function s0(n,e){return _(this,null,function*(){let t=U(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(a=>(s=a,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(a=>{let o=[],l=[],c=X();for(let u of s){o.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of a){l.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:o,addedBatchIds:l}))})})})}function D2(n,e){let t=U(n),r=Ce.now(),i=e.reduce((o,l)=>o.add(l.key),X()),s,a;return t.persistence.runTransaction("Locally write mutations","readwrite",o=>{let l=vt(),c=X();return t.remoteDocuments.getEntries(o,i).next(u=>{l=u,l.forEach((d,f)=>{f.isValidDocument()||(c=c.add(d))})}).next(()=>t.localDocuments.getOverlayedDocuments(o,l)).next(u=>{s=u;let d=[];for(let f of e){let v=lL(f,s.get(f.key).overlayedDocument);v!=null&&d.push(new en(f.key,v,oC(v.value.mapValue),De.exists(!0)))}return t.mutationQueue.addMutationBatch(o,r,d,e)}).next(u=>{a=u;let d=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(o,u.batchId,d)})}).then(()=>({batchId:a.batchId,changes:wC(s)}))}function N2(n,e){let t=U(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return U2(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,O2(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function O2(n){let e=X();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function k2(n,e){let t=U(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>(K(s!==null),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function x2(n){let e=U(n);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t))}function a0(n){let e=U(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function M2(n,e){let t=U(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let o=[];e.targetChanges.forEach((u,d)=>{let f=i.get(d);if(!f)return;o.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,d).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,d)));let v=f.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?v=v.withResumeToken(Ye.EMPTY_BYTE_STRING,$.min()).withLastLimboFreeSnapshotVersion($.min()):u.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(u.resumeToken,r)),i=i.insert(d,v),P2(f,v,u)&&o.push(t.targetCache.updateTargetData(s,v))});let l=vt(),c=X();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&o.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),o.push(o0(s,a,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!r.isEqual($.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(d=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));o.push(u)}return E.waitFor(o).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function o0(n,e,t){let r=X(),i=X();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let a=vt();return t.forEach((o,l)=>{let c=s.get(o);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(o)),l.isNoDocument()&&l.version.isEqual($.min())?(e.removeEntry(o,l.readTime),a=a.insert(o,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),a=a.insert(o,l)):x(Iy,"Ignoring outdated watch update for ",o,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:a,existenceChangedKeys:i}})}function P2(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=R2?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function L2(n,e){return _(this,null,function*(){let t=U(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>E.forEach(e,i=>E.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>E.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(zr(r))x(Iy,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),a=s.snapshotVersion,o=s.withLastLimboFreeSnapshotVersion(a);t.targetDataByTarget=t.targetDataByTarget.insert(i,o)}}})}function F2(n,e){let t=U(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Dr),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function B2(n,e){let t=U(n);return t.persistence.runTransaction("read document","readonly",r=>t.localDocuments.getDocument(r,e))}function Hs(n,e){let t=U(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,E.resolve(i)):t.targetCache.allocateTargetId(r).next(a=>(i=new Ws(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function q2(n,e,t){let r=U(n),i=r.targetIdByTarget.get(t);return i!==void 0?E.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function Qs(n,e,t){return _(this,null,function*(){let r=U(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(zr(a))x(Iy,`Failed to update sequence numbers for target ${e}: ${a}`);else throw a}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function ud(n,e,t){let r=U(n),i=$.min(),s=X();return r.persistence.runTransaction("Execute query","readwrite",a=>q2(r,a,ft(e)).next(o=>{if(o)return i=o.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(a,o.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(a,e,t?i:$.min(),t?s:X())).next(o=>(u0(r,vC(e),o),{documents:o,remoteKeys:s})))}function U2(n,e,t,r){let i=t.batch,s=i.keys(),a=E.resolve();return s.forEach(o=>{a=a.next(()=>r.getEntry(e,o)).next(l=>{let c=t.docVersions.get(o);K(c!==null),l.version.compareTo(c)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),a.next(()=>n.mutationQueue.removeMutationBatch(e,i))}function V2(n,e){let t=U(n),r=U(t.mutationQueue);return t.persistence.runTransaction("Lookup mutation documents","readonly",i=>r.lookupMutationKeys(i,e).next(s=>s?t.localDocuments.getDocuments(i,s):E.resolve(null)))}function z2(n,e){U(U(n,Do).mutationQueue).removeCachedMutationKeys(e)}function G2(n){return U(U(n,Do).persistence).getActiveClients()}function l0(n,e){let t=U(n),r=U(t.targetCache),i=t.targetDataByTarget.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.getTargetDataForTarget(s,e).next(a=>a?a.target:null))}function c0(n,e){let t=U(n),r=t.collectionGroupReadTime.get(e)||$.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.remoteDocuments.getAllFromCollectionGroup(i,e,Mb(r,Bs),Number.MAX_SAFE_INTEGER)).then(i=>(u0(t,e,i),i))}function u0(n,e,t){let r=n.collectionGroupReadTime.get(e)||$.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}function j2(n){return ft(sa(re.fromString(`__bundle__/docs/${n}`)))}function K2(n,e,t,r){return _(this,null,function*(){let i=U(n),s=X(),a=vt();for(let c of t){let u=e.toDocumentKey(c.metadata.name);c.document&&(s=s.add(u));let d=e.toMutableDocument(c);d.setReadTime(e.toSnapshotVersion(c.metadata.readTime)),a=a.insert(u,d)}let o=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=yield Hs(i,j2(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>o0(c,o,a).next(u=>(o.apply(c),u)).next(u=>i.targetCache.removeMatchingKeysForTargetId(c,l.targetId).next(()=>i.targetCache.addMatchingKeys(c,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,u.changedDocuments,u.existenceChangedKeys)).next(()=>u.changedDocuments)))})}function W2(n,e){let t=U(n),r=Pe(e.createTime);return t.persistence.runTransaction("hasNewerBundle","readonly",i=>t.bundleCache.getBundleMetadata(i,e.id)).then(i=>!!i&&i.createTime.compareTo(r)>=0)}function $2(n,e){let t=U(n);return t.persistence.runTransaction("Save bundle","readwrite",r=>t.bundleCache.saveBundleMetadata(r,e))}function H2(n,e){let t=U(n);return t.persistence.runTransaction("Get named query","readonly",r=>t.bundleCache.getNamedQuery(r,e))}function Q2(r,i){return _(this,arguments,function*(n,e,t=X()){let s=yield Hs(n,ft(wy(e.bundledQuery))),a=U(n);return a.persistence.runTransaction("Save named query","readwrite",o=>{let l=Pe(e.readTime);if(s.snapshotVersion.compareTo(l)>=0)return a.bundleCache.saveNamedQuery(o,e);let c=s.withResumeToken(Ye.EMPTY_BYTE_STRING,l);return a.targetDataByTarget=a.targetDataByTarget.insert(c.targetId,c),a.targetCache.updateTargetData(o,c).next(()=>a.targetCache.removeMatchingKeysForTargetId(o,s.targetId)).next(()=>a.targetCache.addMatchingKeys(o,t,s.targetId)).next(()=>a.bundleCache.saveNamedQuery(o,e))})})}var Sg=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Y2=100;function J2(){return Dd()?8:Fb(ya())>0?6:4}var ku=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=Y2,this.relativeIndexReadCostPerDocument=J2()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new Sg;return this.executeFullCollectionScan(e,t,a).next(o=>{if(s.result=o,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,a,o.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(Ds()<=rn.DEBUG&&x("QueryEngine","SDK will not create cache indexes for query:",Ns(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),E.resolve()):(Ds()<=rn.DEBUG&&x("QueryEngine","Query:",Ns(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(Ds()<=rn.DEBUG&&x("QueryEngine","The SDK decides to create cache indexes for query:",Ns(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ft(t))):E.resolve())}performQueryUsingIndex(e,t){if(ME(t))return E.resolve(null);let r=ft(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=vu(t,null,"F"),r=ft(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let a=X(...s);return this.localDocumentsView.getDocuments(e,a).next(o=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,o);return this.needsRefill(t,c,a,l.readTime)?this.performQueryUsingIndex(e,vu(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return ME(t)||i.isEqual($.min())?E.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let a=this.applyQuery(t,s);return this.needsRefill(t,a,r,i)?E.resolve(null):(Ds()<=rn.DEBUG&&x("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ns(t)),this.appendRemainingResults(e,a,t,Mb(i,Bs)).next(o=>o))})}applyQuery(e,t){let r=new fe(SC(e));return t.forEach((i,s)=>{Go(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return Ds()<=rn.DEBUG&&x("QueryEngine","Using full collection scan to execute query:",Ns(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,Ut.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}};var d0="firestore_clients";function pb(n,e){return`${d0}_${n}_${e}`}var h0="firestore_mutations";function mb(n,e,t){let r=`${h0}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}var f0="firestore_targets";function sm(n,e){return`${f0}_${n}_${e}`}var X2="firestore_online_state";function Z2(n){return`${X2}_${n}`}var eB="firestore_bundle_loaded_v2";function tB(n){return`${eB}_${n}`}var nB="firestore_sequence_number";function rB(n){return`${nB}_${n}`}var wn="SharedClientState",xu=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static fromWebStorageEntry(e,t,r){let i=JSON.parse(r),s=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object"),a;return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(a=new N(i.error.code,i.error.message))),s?new n(e,t,i.state,a):(be(wn,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},co=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object"),s;return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new N(r.error.code,r.error.message))),i?new n(e,r.state,s):(be(wn,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Mu=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Sy();for(let a=0;i&&a<r.activeTargetIds.length;++a)i=iC(r.activeTargetIds[a]),s=s.add(r.activeTargetIds[a]);return i?new n(e,s):(be(wn,`Failed to parse client data for instance '${e}': ${t}`),null)}},Tg=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(be(wn,`Failed to parse online state: ${e}`),null)}},No=class{constructor(){this.activeTargetIds=Sy()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},uo=class{constructor(e,t,r,i,s){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new ve(J),this.started=!1,this.earlyEvents=[];let a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.localClientStorageKey=pb(this.persistenceKey,this.localClientId),this.sequenceNumberKey=rB(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new No),this.clientStateKeyRe=new RegExp(`^${d0}_${a}_([^_]*)$`),this.mutationBatchKeyRe=new RegExp(`^${h0}_${a}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=new RegExp(`^${f0}_${a}_(\\d+)$`),this.onlineStateKey=Z2(this.persistenceKey),this.bundleLoadedKey=tB(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}start(){return _(this,null,function*(){let e=yield this.syncEngine.getActiveClients();for(let r of e){if(r===this.localClientId)continue;let i=this.getItem(pb(this.persistenceKey,r));if(i){let s=Mu.fromWebStorageEntry(r,i);s&&(this.activeClients=this.activeClients.insert(s.clientId,s))}}this.persistClientState();let t=this.storage.getItem(this.onlineStateKey);if(t){let r=this.fromWebStorageOnlineState(t);r&&this.handleOnlineStateEvent(r)}for(let r of this.earlyEvents)this.handleWebStorageEvent(r);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(sm(this.persistenceKey,e));if(r){let i=co.fromWebStorageEntry(e,r);i&&(t=i.state)}}return this.localClientState.addQueryTarget(e),this.persistClientState(),t}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(sm(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.removeMutationState(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return x(wn,"READ",e,t),t}setItem(e,t){x(wn,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){x(wn,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(x(wn,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){be("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(()=>_(this,null,function*(){if(!this.started){this.earlyEvents.push(t);return}if(t.key!==null){if(this.clientStateKeyRe.test(t.key))if(t.newValue!=null){let r=this.fromWebStorageClientState(t.key,t.newValue);if(r)return this.handleClientStateEvent(r.clientId,r)}else{let r=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(r,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(r)return this.handleMutationBatchEvent(r)}}else if(this.queryTargetKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(r)return this.handleQueryTargetEvent(r)}}else if(t.key===this.onlineStateKey){if(t.newValue!==null){let r=this.fromWebStorageOnlineState(t.newValue);if(r)return this.handleOnlineStateEvent(r)}}else if(t.key===this.sequenceNumberKey){let r=iB(t.newValue);r!==bt.INVALID&&this.sequenceNumberHandler(r)}else if(t.key===this.bundleLoadedKey){let r=this.fromWebStoreBundleLoadedState(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.synchronizeWithChangedDocuments(i)))}}}))}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let i=new xu(this.currentUser,e,t,r),s=mb(this.persistenceKey,this.currentUser,e);this.setItem(s,i.toWebStorageJSON())}removeMutationState(e){let t=mb(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let i=sm(this.persistenceKey,e),s=new co(e,t,r);this.setItem(i,s.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return Mu.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return xu.fromWebStorageEntry(new ze(s),i,t)}fromWebStorageQueryTargetMetadata(e,t){let r=this.queryTargetKeyRe.exec(e),i=Number(r[1]);return co.fromWebStorageEntry(i,t)}fromWebStorageOnlineState(e){return Tg.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}handleMutationBatchEvent(e){return _(this,null,function*(){if(e.user.uid!==this.currentUser.uid){x(wn,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)})}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),i=this.extractActiveQueryTargets(this.activeClients),s=this.extractActiveQueryTargets(r),a=[],o=[];return s.forEach(l=>{i.has(l)||a.push(l)}),i.forEach(l=>{s.has(l)||o.push(l)}),this.syncEngine.applyActiveTargetsChange(a,o).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=Sy();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}};function iB(n){let e=bt.INVALID;if(n!=null)try{let t=JSON.parse(n);K(typeof t=="number"),e=t}catch(t){be(wn,"Failed to read sequence number from WebStorage",t)}return e}var Pu=class{constructor(){this.localState=new No,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new No,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var wg=class{addCallback(e){}shutdown(){}};var _g=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var tu=null;function sB(){return 268435456+Math.round(2147483648*Math.random())}function am(){return tu===null?tu=sB():tu++,"0x"+tu.toString(16)}function aB(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var oB="1.9.1",dt="GrpcConnection",lB=`gl-node/${process.versions.node} fire/${ta} grpc/${oB}`;function om(n,e,t,r){K(e===null||e.type==="OAuth");let i=new di.Metadata;return e&&e.headers.forEach((s,a)=>i.set(a,s)),t&&t.headers.forEach((s,a)=>i.set(a,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",lB),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var Eg=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){x(dt,"Creating Firestore stub.");let e=this.databaseInfo.ssl?di.credentials.createSsl():di.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let a=am(),o=this.ensureActiveStub(),l=om(this.databasePath,i,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},r);return aB(u=>(x(dt,`RPC '${e}' ${a} invoked with request:`,r),o[e](c,l,(d,f)=>{d?(x(dt,`RPC '${e}' ${a} failed with error:`,d),u(new N(au(d.code),d.message))):(x(dt,`RPC '${e}' ${a} completed with response:`,f),u(void 0,f))})))}invokeStreamingRPC(e,t,r,i,s,a){let o=am(),l=[],c=new Me;x(dt,`RPC '${e}' ${o} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),d=om(this.databasePath,i,s,this.databaseInfo.appId),f=Object.assign(Object.assign({},r),{database:this.databasePath}),v=u[e](f,d),b=!1;return v.on("data",I=>{x(dt,`RPC ${e} ${o} received result:`,I),l.push(I),a!==void 0&&l.length===a&&(b=!0,c.resolve(l))}),v.on("end",()=>{x(dt,`RPC '${e}' ${o} completed.`),b||(b=!0,c.resolve(l))}),v.on("error",I=>{x(dt,`RPC '${e}' ${o} failed with error:`,I);let A=au(I.code);c.reject(new N(A,I.message))}),c.promise}openStream(e,t,r){let i=am(),s=this.ensureActiveStub(),a=om(this.databasePath,t,r,this.databaseInfo.appId),o=s[e](a),l=!1,c=f=>{l||(l=!0,u.callOnClose(f),o.end())},u=new _g({sendFn:f=>{if(l)x(dt,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,f);else{x(dt,`RPC '${e}' stream ${i} sending:`,f);try{o.write(f)}catch(v){throw be("Failure sending:",f),be("Error:",v),v}}},closeFn:()=>{x(dt,`RPC '${e}' stream ${i} closed locally via close().`),c()}}),d=!1;return o.on("data",f=>{l||(x(dt,`RPC '${e}' stream ${i} received:`,f),d||(u.callOnConnected(),d=!0),u.callOnMessage(f))}),o.on("end",()=>{x(dt,`RPC '${e}' stream ${i} ended.`),c()}),o.on("error",f=>{if(!l){qt(dt,`RPC '${e}' stream ${i} error. Code:`,f.code,"Message:",f.message);let v=au(f.code);c(new N(v,f.message))}}),x(dt,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},p0={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},cB={nested:p0},uB=Object.freeze({__proto__:null,nested:p0,default:cB});var dB={longs:String,enums:String,defaults:!0,oneofs:!1};function hB(){let n=Nb.fromJSON(uB,dB);return di.loadPackageDefinition(n)}function fB(n){let e=hB();return new Eg(e,n)}function pB(){return new wg}function m0(){return process.env.USE_MOCK_PERSISTENCE==="YES"?window:null}function mB(){return null}function Ko(n){return new jm(n,!1)}var gB="ExponentialBackoff",yB=1e3,vB=1.5,SB=60*1e3,Oo=class{constructor(e,t,r=yB,i=vB,s=SB){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&x(gB,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var gb="PersistentStream",TB=60*1e3,wB=10*1e3,Lu=class{constructor(e,t,r,i,s,a,o,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=o,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.backoff=new Oo(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.state===4){this.performBackoff();return}this.auth()}stop(){return _(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,TB,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return _(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return _(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===C.RESOURCE_EXHAUSTED?(be(t.toString()),be("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===C.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new N(C.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,wB,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>_(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return x(gb,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(x(gb,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},bg=class extends Lu{constructor(e,t,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onMessage(e){this.backoff.reset();let t=xL(this.serializer,e),r=PL(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=$m(this.serializer),t.addTarget=WL(this.serializer,e);let r=jL(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=$m(this.serializer),t.removeTarget=e,this.sendRequest(t)}},Cg=class extends Lu{constructor(e,t,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s,this.handshakeComplete_=!1}get handshakeComplete(){return this.handshakeComplete_}start(){this.handshakeComplete_=!1,this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete_&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onMessage(e){if(K(!!e.streamToken),this.lastStreamToken=e.streamToken,this.handshakeComplete_){this.backoff.reset();let t=qL(e.writeResults,e.commitTime),r=Pe(e.commitTime);return this.listener.onMutationResult(r,t)}else return K(!e.writeResults||e.writeResults.length===0),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()}writeHandshake(){let e={};e.database=$m(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Io(this.serializer,r))};this.sendRequest(t)}};var Ig=class{},Ag=class extends Ig{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new N(C.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.invokeRPC(e,Wm(t,r),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new N(C.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,r,i,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.invokeStreamingRPC(e,Wm(t,r),i,a,o,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new N(C.UNKNOWN,a.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function _B(n,e,t,r){return new Ag(n,e,t,r)}function EB(n,e){return _(this,null,function*(){let t=U(n),r={writes:e.map(i=>Io(t.serializer,i))};yield t.invokeRPC("Commit",t.serializer.databaseId,re.emptyPath(),r)})}function bB(n,e){return _(this,null,function*(){let t=U(n),r={documents:e.map(o=>Co(t.serializer,o))},i=yield t.invokeStreamingRPC("BatchGetDocuments",t.serializer.databaseId,re.emptyPath(),r,e.length),s=new Map;i.forEach(o=>{let l=kL(t.serializer,o);s.set(l.key.toString(),l)});let a=[];return e.forEach(o=>{let l=s.get(o.toString());K(!!l),a.push(l)}),a})}function CB(n,e,t){let r=U(n);return r.verifyInitialized(),new Cg(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function IB(n,e,t){let r=U(n);return r.verifyInitialized(),new bg(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var AB="OnlineStateTracker",yb=1,vb=10*1e3,Rg=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",vb,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${vb/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=yb&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${yb} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(be(t),this.shouldWarnClientIsOffline=!1):x(AB,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var wi="RemoteStore",RB=10,Dg=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(a=>{r.enqueueAndForget(()=>_(this,null,function*(){Gr(this)&&(x(wi,"Restarting streams for network reachability change."),yield WB(this))}))}),this.onlineStateTracker=new Rg(r,i)}};function DB(n,e,t,r,i){return new Dg(n,e,t,r,i)}function NB(n){let e=U(n);return e.offlineCauses.delete(0),Wo(e)}function Wo(n){return _(this,null,function*(){if(Gr(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function OB(n){return _(this,null,function*(){let e=U(n);e.offlineCauses.add(0),yield aa(e),e.onlineStateTracker.set("Offline")})}function aa(n){return _(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function kB(n){return _(this,null,function*(){let e=U(n);x(wi,"RemoteStore shutting down."),e.offlineCauses.add(5),yield aa(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function dd(n,e){let t=U(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),Dy(t)?Ry(t):ca(t).isOpen()&&Ay(t,e))}function oa(n,e){let t=U(n),r=ca(t);t.listenTargets.delete(e),r.isOpen()&&g0(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():Gr(t)&&t.onlineStateTracker.set("Unknown"))}function Ay(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo($.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ca(n).watch(e)}function g0(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),ca(n).unwatch(e)}function Ry(n){n.watchChangeAggregator=new Gm({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),ca(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function Dy(n){return Gr(n)&&!ca(n).isStarted()&&n.listenTargets.size>0}function Gr(n){return U(n).offlineCauses.size===0}function y0(n){n.watchChangeAggregator=void 0}function xB(n){return _(this,null,function*(){n.onlineStateTracker.set("Online")})}function MB(n){return _(this,null,function*(){n.listenTargets.forEach((e,t)=>{Ay(n,e)})})}function PB(n,e){return _(this,null,function*(){y0(n),Dy(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),Ry(n)):n.onlineStateTracker.set("Unknown")})}function LB(n,e,t){return _(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof Tu&&e.state===2&&e.cause){try{yield BB(n,e)}catch(r){x(wi,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Fu(n,r)}return}if(e instanceof Fs?n.watchChangeAggregator.handleDocumentChange(e):e instanceof Su?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual($.min()))try{let r=yield a0(n.localStore);t.compareTo(r)>=0&&(yield FB(n,t))}catch(r){x(wi,"Failed to raise snapshot:",r),yield Fu(n,r)}})}function Fu(n,e,t){return _(this,null,function*(){if(zr(e))n.offlineCauses.add(1),yield aa(n),n.onlineStateTracker.set("Offline"),t||(t=()=>a0(n.localStore)),n.asyncQueue.enqueueRetryable(()=>_(this,null,function*(){x(wi,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield Wo(n)}));else throw e})}function v0(n,e){return e().catch(t=>Fu(n,t,e))}function FB(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken(Ye.EMPTY_BYTE_STRING,s.snapshotVersion)),g0(n,r);let a=new Ws(s.target,r,i,s.sequenceNumber);Ay(n,a)}),n.remoteSyncer.applyRemoteEvent(t)}function BB(n,e){return _(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function la(n){return _(this,null,function*(){let e=U(n),t=jr(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:Dr;for(;qB(e);)try{let i=yield F2(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,UB(e,i)}catch(i){yield Fu(e,i)}S0(e)&&T0(e)})}function qB(n){return Gr(n)&&n.writePipeline.length<RB}function UB(n,e){n.writePipeline.push(e);let t=jr(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function S0(n){return Gr(n)&&!jr(n).isStarted()&&n.writePipeline.length>0}function T0(n){jr(n).start()}function VB(n){return _(this,null,function*(){jr(n).writeHandshake()})}function zB(n){return _(this,null,function*(){let e=jr(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function GB(n,e,t){return _(this,null,function*(){let r=n.writePipeline.shift(),i=qm.from(r,e,t);yield v0(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield la(n)})}function jB(n,e){return _(this,null,function*(){e&&jr(n).handshakeComplete&&(yield KB(n,e)),S0(n)&&T0(n)})}function KB(n,e){return _(this,null,function*(){if(mL(e.code)){let t=n.writePipeline.shift();jr(n).inhibitBackoff(),yield v0(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield la(n)}})}function WB(n){return _(this,null,function*(){let e=U(n);e.offlineCauses.add(4),yield aa(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield Wo(e)})}function Sb(n,e){return _(this,null,function*(){let t=U(n);t.asyncQueue.verifyOperationInProgress(),x(wi,"RemoteStore received new credentials");let r=Gr(t);t.offlineCauses.add(3),yield aa(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield Wo(t)})}function Ng(n,e){return _(this,null,function*(){let t=U(n);e?(t.offlineCauses.delete(2),yield Wo(t)):e||(t.offlineCauses.add(2),yield aa(t),t.onlineStateTracker.set("Unknown"))})}function ca(n){return n.watchStream||(n.watchStream=IB(n.datastore,n.asyncQueue,{onConnected:xB.bind(null,n),onOpen:MB.bind(null,n),onClose:PB.bind(null,n),onWatchChange:LB.bind(null,n)}),n.onNetworkStatusChange.push(e=>_(this,null,function*(){e?(n.watchStream.inhibitBackoff(),Dy(n)?Ry(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),y0(n))}))),n.watchStream}function jr(n){return n.writeStream||(n.writeStream=CB(n.datastore,n.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:VB.bind(null,n),onClose:jB.bind(null,n),onHandshakeComplete:zB.bind(null,n),onMutationResult:GB.bind(null,n)}),n.onNetworkStatusChange.push(e=>_(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield la(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(x(wi,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var $B="AsyncQueue",Og=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Me,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let a=Date.now()+r,o=new n(e,t,a,i,s);return o.start(r),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new N(C.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function ua(n,e){if(be($B,`${e}: ${n}`),zr(n))return new N(C.UNAVAILABLE,`${e}: ${n}`);throw n}var Bu=class n{constructor(e){e?this.comparator=(t,r)=>e(t,r)||F.comparator(t.key,r.key):this.comparator=(t,r)=>F.comparator(t.key,r.key),this.keyedMap=ro(),this.sortedSet=new ve(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var qu=class{constructor(){this.changeMap=new ve(F.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):V()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},Ys=class n{constructor(e,t,r,i,s,a,o,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=o,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let a=[];return t.forEach(o=>{a.push({type:0,doc:o})}),new n(e,t,Bu.emptySet(t),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!zo(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var kg=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function HB(){return new xg}var xg=class{constructor(){this.queries=new An(e=>yC(e),zo),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}};function Ny(n,e){return _(this,null,function*(){let t=U(n),r=3,i=e.query,s=t.queries.get(i);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2):(s=new kg,r=e.listensToRemoteStore()?0:1);try{switch(r){case 0:s.viewSnap=yield t.onListen(i,!0);break;case 1:s.viewSnap=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i);break;default:break}}catch(a){let o=ua(a,`Initialization of query '${Ns(e.query)}' failed`);e.onError(o);return}t.queries.set(i,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&ky(t)})}function Oy(n,e){return _(this,null,function*(){let t=U(n),r=e.query,i=3,s=t.queries.get(r);if(s){let a=s.listeners.indexOf(e);a>=0&&(s.listeners.splice(a,1),s.listeners.length===0?i=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function QB(n,e){let t=U(n),r=!1;for(let i of e){let s=i.query,a=t.queries.get(s);if(a){for(let o of a.listeners)o.onViewSnapshot(i)&&(r=!0);a.viewSnap=i}}r&&ky(t)}function YB(n,e,t){let r=U(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function JB(n,e){let t=U(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let a of s.listeners)a.applyOnlineStateChange(e)&&(r=!0)}),r&&ky(t)}function XB(n,e){U(n).snapshotsInSyncListeners.add(e),e.next()}function ZB(n,e){U(n).snapshotsInSyncListeners.delete(e)}function ky(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var w0=function(n){return n.Default="default",n.Cache="cache",n}(w0||{}),ko=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Ys(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=Ys.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==w0.Cache}};var Mg=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=X(),i=X();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var Uu=class{constructor(e){this.serializer=e}toDocumentKey(e){return bn(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?VC(this.serializer,e.document,!1):Ve.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return Pe(e)}},Pg=class{constructor(e,t,r){this.bundleMetadata=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=_0(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;let r=re.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,r=new Uu(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.toDocumentKey(i.metadata.name);for(let a of i.metadata.queries){let o=(t.get(a)||X()).add(s);t.set(a,o)}}return t}complete(){return _(this,null,function*(){let e=yield K2(this.localStore,new Uu(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let r of this.queries)yield Q2(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}})}};function _0(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}function eq(n){return{taskState:"Success",documentsLoaded:n.totalDocuments,bytesLoaded:n.totalBytes,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Vu=class{constructor(e){this.key=e}},zu=class{constructor(e){this.key=e}},Gu=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=X(),this.mutatedKeys=X(),this.docComparator=SC(e),this.documentSet=new Bu(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new qu,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,a=i,o=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,d)=>{let f=i.get(u),v=Go(this.query,d)?d:null,b=f?this.mutatedKeys.has(f.key):!1,I=v?v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations:!1,A=!1;f&&v?f.data.isEqual(v.data)?b!==I&&(r.track({type:3,doc:v}),A=!0):this.shouldWaitForSyncedDocument(f,v)||(r.track({type:2,doc:v}),A=!0,(l&&this.docComparator(v,l)>0||c&&this.docComparator(v,c)<0)&&(o=!0)):!f&&v?(r.track({type:0,doc:v}),A=!0):f&&!v&&(r.track({type:1,doc:f}),A=!0,(l||c)&&(o=!0)),A&&(v?(a=a.add(v),I?s=s.add(u):s=s.delete(u)):(a=a.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let u=this.query.limitType==="F"?a.last():a.first();a=a.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{documentSet:a,changeSet:r,needsRefill:o,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let a=e.changeSet.getChanges();a.sort((d,f)=>tq(d.type,f.type)||this.docComparator(d.doc,f.doc)),this.applyTargetChange(r),i=i??!1;let o=t&&!i?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!i?1:0,u=c!==this.syncState;return this.syncState=c,a.length===0&&!u?{limboChanges:o}:{snapshot:new Ys(this.query,e.documentSet,s,a,e.mutatedKeys,c===0,u,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:o}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new qu,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=X(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new zu(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new Vu(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=X();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return Ys.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function tq(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return V()}};return t(n)-t(e)}var Kr="SyncEngine",Lg=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Fg=class{constructor(e){this.key=e,this.receivedDocument=!1}},Bg=class{constructor(e,t,r,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.syncEngineListener={},this.queryViewsByQuery=new An(o=>yC(o),zo),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new ve(F.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new Ro,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=$s.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function nq(n,e,t,r,i,s,a){let o=new Bg(n,e,t,r,i,s);return a&&(o._isPrimaryClient=!0),o}function rq(n,e,t=!0){return _(this,null,function*(){let r=hd(n),i,s=r.queryViewsByQuery.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.computeInitialSnapshot()):i=yield E0(r,e,t,!0),i})}function iq(n,e){return _(this,null,function*(){let t=hd(n);yield E0(t,e,!0,!1)})}function E0(n,e,t,r){return _(this,null,function*(){let i=yield Hs(n.localStore,ft(e)),s=i.targetId,a=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",o;return r&&(o=yield xy(n,e,s,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&dd(n.remoteStore,i),o})}function xy(n,e,t,r,i){return _(this,null,function*(){n.applyDocChanges=(d,f,v)=>mq(n,d,f,v);let s=yield ud(n.localStore,e,!0),a=new Gu(e,s.remoteKeys),o=a.computeDocChanges(s.documents),l=bo.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=a.applyChanges(o,n.isPrimaryClient,l);Ly(n,t,c.limboChanges);let u=new Lg(e,t,a);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function sq(n,e,t){return _(this,null,function*(){let r=U(n),i=r.queryViewsByQuery.get(e),s=r.queriesByTarget.get(i.targetId);if(s.length>1){r.queriesByTarget.set(i.targetId,s.filter(a=>!zo(a,e))),r.queryViewsByQuery.delete(e);return}r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Qs(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&oa(r.remoteStore,i.targetId),Js(r,i.targetId)}).catch(Vr))):(Js(r,i.targetId),yield Qs(r.localStore,i.targetId,!0))})}function aq(n,e){return _(this,null,function*(){let t=U(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),oa(t.remoteStore,r.targetId))})}function oq(n,e,t){return _(this,null,function*(){let r=By(n);try{let i=yield D2(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),fq(r,i.batchId,t),yield Wn(r,i.changes),yield la(r.remoteStore)}catch(i){let s=ua(i,"Failed to persist write");t.reject(s)}})}function b0(n,e){return _(this,null,function*(){let t=U(n);try{let r=yield M2(t.localStore,e);e.targetChanges.forEach((i,s)=>{let a=t.activeLimboResolutionsByTarget.get(s);a&&(K(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.receivedDocument=!0:i.modifiedDocuments.size>0?K(a.receivedDocument):i.removedDocuments.size>0&&(K(a.receivedDocument),a.receivedDocument=!1))}),yield Wn(t,r,e)}catch(r){yield Vr(r)}})}function Tb(n,e,t){let r=U(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,a)=>{let o=a.view.applyOnlineStateChange(e);o.snapshot&&i.push(o.snapshot)}),JB(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function lq(n,e,t){return _(this,null,function*(){let r=U(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let a=new ve(F.comparator);a=a.insert(s,Ve.newNoDocument(s,$.min()));let o=X().add(s),l=new Eo($.min(),new Map,new ve(J),a,o);yield b0(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),Fy(r)}else yield Qs(r.localStore,e,!1).then(()=>Js(r,e,t)).catch(Vr)})}function cq(n,e){return _(this,null,function*(){let t=U(n),r=e.batch.batchId;try{let i=yield N2(t.localStore,e);Py(t,r,null),My(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Wn(t,i)}catch(i){yield Vr(i)}})}function uq(n,e,t){return _(this,null,function*(){let r=U(n);try{let i=yield k2(r.localStore,e);Py(r,e,t),My(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Wn(r,i)}catch(i){yield Vr(i)}})}function dq(n,e){return _(this,null,function*(){let t=U(n);Gr(t.remoteStore)||x(Kr,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield x2(t.localStore);if(r===Dr){e.resolve();return}let i=t.pendingWritesCallbacks.get(r)||[];i.push(e),t.pendingWritesCallbacks.set(r,i)}catch(r){let i=ua(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function My(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function hq(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new N(C.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function fq(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new ve(J)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function Py(n,e,t){let r=U(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function Js(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||C0(n,i)})}function C0(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(oa(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),Fy(n))}function Ly(n,e,t){for(let r of t)r instanceof Vu?(n.limboDocumentRefs.addReference(r.key,e),pq(n,r)):r instanceof zu?(x(Kr,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||C0(n,r.key)):V()}function pq(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(x(Kr,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),Fy(n))}function Fy(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new F(re.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new Fg(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),dd(n.remoteStore,new Ws(ft(sa(t.path)),r,"TargetPurposeLimboResolution",bt.INVALID))}}function Wn(n,e,t){return _(this,null,function*(){let r=U(n),i=[],s=[],a=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((o,l)=>{a.push(r.applyDocChanges(l,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(l.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);let u=Mg.fromSnapshot(l.targetId,c);s.push(u)}}))}),yield Promise.all(a),r.syncEngineListener.onWatchChange(i),yield L2(r.localStore,s))})}function mq(n,e,t,r){return _(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield ud(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),a=r&&r.targetMismatches.get(e.targetId)!=null,o=e.view.applyChanges(i,n.isPrimaryClient,s,a);return Ly(n,e.targetId,o.limboChanges),o.snapshot})}function gq(n,e){return _(this,null,function*(){let t=U(n);if(!t.currentUser.isEqual(e)){x(Kr,"User change. New user:",e.toKey());let i=yield s0(t.localStore,e);t.currentUser=e,hq(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield Wn(t,i.affectedDocuments)}})}function yq(n,e){let t=U(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return X().add(r.key);{let i=X(),s=t.queriesByTarget.get(e);if(!s)return i;for(let a of s){let o=t.queryViewsByQuery.get(a);i=i.unionWith(o.view.syncedDocuments)}return i}}function vq(n,e){return _(this,null,function*(){let t=U(n),r=yield ud(t.localStore,e.query,!0),i=e.view.synchronizeWithPersistedState(r);return t.isPrimaryClient&&Ly(t,e.targetId,i.limboChanges),i})}function Sq(n,e){return _(this,null,function*(){let t=U(n);return c0(t.localStore,e).then(r=>Wn(t,r))})}function Tq(n,e,t,r){return _(this,null,function*(){let i=U(n),s=yield V2(i.localStore,e);if(s===null){x(Kr,"Cannot apply mutation batch with id: "+e);return}t==="pending"?yield la(i.remoteStore):t==="acknowledged"||t==="rejected"?(Py(i,e,r||null),My(i,e),z2(i.localStore,e)):V(),yield Wn(i,s)})}function wq(n,e){return _(this,null,function*(){let t=U(n);if(hd(t),By(t),e===!0&&t._isPrimaryClient!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield wb(t,r.toArray());t._isPrimaryClient=!0,yield Ng(t.remoteStore,!0);for(let s of i)dd(t.remoteStore,s)}else if(e===!1&&t._isPrimaryClient!==!1){let r=[],i=Promise.resolve();t.queriesByTarget.forEach((s,a)=>{t.sharedClientState.isLocalQueryTarget(a)?r.push(a):i=i.then(()=>(Js(t,a),Qs(t.localStore,a,!0))),oa(t.remoteStore,a)}),yield i,yield wb(t,r),_q(t),t._isPrimaryClient=!1,yield Ng(t.remoteStore,!1)}})}function _q(n){let e=U(n);e.activeLimboResolutionsByTarget.forEach((t,r)=>{oa(e.remoteStore,r)}),e.limboDocumentRefs.removeAllReferences(),e.activeLimboResolutionsByTarget=new Map,e.activeLimboTargetsByKey=new ve(F.comparator)}function wb(n,e,t){return _(this,null,function*(){let r=U(n),i=[],s=[];for(let a of e){let o,l=r.queriesByTarget.get(a);if(l&&l.length!==0){o=yield Hs(r.localStore,ft(l[0]));for(let c of l){let u=r.queryViewsByQuery.get(c),d=yield vq(r,u);d.snapshot&&s.push(d.snapshot)}}else{let c=yield l0(r.localStore,a);o=yield Hs(r.localStore,c),yield xy(r,I0(c),a,!1,o.resumeToken)}i.push(o)}return r.syncEngineListener.onWatchChange(s),i})}function I0(n){return gC(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Eq(n){let e=U(n);return G2(e.localStore)}function bq(n,e,t,r){return _(this,null,function*(){let i=U(n);if(i._isPrimaryClient){x(Kr,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let a=yield c0(i.localStore,vC(s[0])),o=Eo.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ye.EMPTY_BYTE_STRING);yield Wn(i,a,o);break}case"rejected":{yield Qs(i.localStore,e,!0),Js(i,e,r);break}default:V()}})}function Cq(n,e,t){return _(this,null,function*(){let r=hd(n);if(r._isPrimaryClient){for(let i of e){if(r.queriesByTarget.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){x(Kr,"Adding an already active target "+i);continue}let a=yield l0(r.localStore,i),o=yield Hs(r.localStore,a);yield xy(r,I0(a),o.targetId,!1,o.resumeToken),dd(r.remoteStore,o)}for(let i of t)r.queriesByTarget.has(i)&&(yield Qs(r.localStore,i,!1).then(()=>{oa(r.remoteStore,i),Js(r,i)}).catch(Vr))}})}function hd(n){let e=U(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=b0.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=yq.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=lq.bind(null,e),e.syncEngineListener.onWatchChange=QB.bind(null,e.eventManager),e.syncEngineListener.onWatchError=YB.bind(null,e.eventManager),e}function By(n){let e=U(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=cq.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=uq.bind(null,e),e}function Iq(n,e,t){let r=U(n);Aq(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}function Aq(n,e,t){return _(this,null,function*(){try{let r=yield e.getMetadata();if(yield W2(n.localStore,r))return yield e.close(),t._completeWith(eq(r)),Promise.resolve(new Set);t._updateProgress(_0(r));let s=new Pg(r,n.localStore,e.serializer),a=yield e.nextElement();for(;a;){let l=yield s.addSizedElement(a);l&&t._updateProgress(l),a=yield e.nextElement()}let o=yield s.complete();return yield Wn(n,o.changedDocs,void 0),yield $2(n.localStore,r),t._completeWith(o.progress),Promise.resolve(o.changedCollectionGroups)}catch(r){return qt(Kr,`Loading bundle failed with ${r}`),t._failWith(r),Promise.resolve(new Set)}})}var xo=class{constructor(){this.synchronizeTabs=!1}initialize(e){return _(this,null,function*(){this.serializer=Ko(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return i0(this.persistence,new ku,e.initialUser,this.serializer)}createPersistence(e){return new Nu(Ou.factory,this.serializer)}createSharedClientState(e){return new Pu}terminate(){return _(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var ju=class n extends xo{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return _(this,null,function*(){yield Id(n.prototype,this,"initialize").call(this,e),yield this.onlineComponentProvider.initialize(this,e),yield By(this.onlineComponentProvider.syncEngine),yield la(this.onlineComponentProvider.remoteStore),yield this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return i0(this.persistence,new ku,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new ig(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new Sm(t,this.persistence);return new vm(e.asyncQueue,r)}createPersistence(e){let t=Cy(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Bt.withCacheSize(this.cacheSizeBytes):Bt.DEFAULT;return new vg(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,m0(),mB(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Pu}},qg=class n extends ju{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return _(this,null,function*(){yield Id(n.prototype,this,"initialize").call(this,e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof uo&&(this.sharedClientState.syncEngine={applyBatchState:Tq.bind(null,t),applyTargetState:bq.bind(null,t),applyActiveTargetsChange:Cq.bind(null,t),getActiveClients:Eq.bind(null,t),synchronizeWithChangedDocuments:Sq.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.setPrimaryStateListener(r=>_(this,null,function*(){yield wq(this.onlineComponentProvider.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=m0();if(!uo.isAvailable(t))throw new N(C.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=Cy(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new uo(t,e.asyncQueue,r,e.clientId,e.initialUser)}},Mo=class{initialize(e,t){return _(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Tb(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=gq.bind(null,this.syncEngine),yield Ng(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return HB()}createDatastore(e){let t=Ko(e.databaseInfo.databaseId),r=fB(e.databaseInfo);return _B(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return DB(this.localStore,this.datastore,e.asyncQueue,t=>Tb(this.syncEngine,t,0),pB())}createSyncEngine(e,t){return nq(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return _(this,null,function*(){var e;yield kB(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};var Rq=10240;function Dq(n,e=Rq){let t=0;return{read(){return _(this,null,function*(){if(t<n.byteLength){let s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return _(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}function qy(n,e,t){if(!t)throw new N(C.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Uy(n,e,t,r){if(e===!0&&r===!0)throw new N(C.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function _b(n){if(!F.isDocumentKey(n))throw new N(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Eb(n){if(F.isDocumentKey(n))throw new N(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Nq(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function $o(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=Oq(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":V()}function Oq(n){return n.constructor?n.constructor.name:null}function ie(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new N(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=$o(n);throw new N(C.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function A0(n,e){if(e<=0)throw new N(C.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function kq(n,e){if(!(n instanceof Uint8Array))throw new N(C.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${$o(n)}`);return Dq(n,e)}var Xs=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.observer.error?this.scheduleEvent(this.observer.error,e):be("Uncaught Error in snapshot listener:",e.toString())}mute(){this.muted=!0}scheduleEvent(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var Ug=class{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}};var Vg=class{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new Me,this.buffer=new Uint8Array,this.textDecoder=gL(),this.nextElementImpl().then(r=>{r&&r.isBundleMetadata()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.payload)}`))},r=>this.metadata.reject(r))}close(){return this.reader.cancel()}getMetadata(){return _(this,null,function*(){return this.metadata.promise})}nextElement(){return _(this,null,function*(){return yield this.getMetadata(),this.nextElementImpl()})}nextElementImpl(){return _(this,null,function*(){let e=yield this.readLength();if(e===null)return null;let t=this.textDecoder.decode(e),r=Number(t);isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`);let i=yield this.readJsonString(r);return new Ug(JSON.parse(i),e.length+r)})}indexOfOpenBracket(){return this.buffer.findIndex(e=>e===123)}readLength(){return _(this,null,function*(){for(;this.indexOfOpenBracket()<0&&!(yield this.pullMoreDataToBuffer()););if(this.buffer.length===0)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}readJsonString(e){return _(this,null,function*(){for(;this.buffer.length<e;)(yield this.pullMoreDataToBuffer())&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}raiseError(e){throw this.reader.cancel(),new Error(`Invalid bundle format: ${e}`)}pullMoreDataToBuffer(){return _(this,null,function*(){let e=yield this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};function xq(n,e){return new Vg(n,e)}var zg=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return _(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new N(C.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield bB(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Br(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return _(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=F.fromPath(r);this.mutations.push(new To(i,this.precondition(i)))}),yield EB(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=$.min();else throw V();let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new N(C.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual($.min())?De.exists(!1):De.updateTime(t):De.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual($.min()))throw new N(C.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return De.updateTime(t)}else return De.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Gg=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.attemptsRemaining=r.maxAttempts,this.backoff=new Oo(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(()=>_(this,null,function*(){let e=new zg(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.handleTransactionError(i)}))}).catch(r=>{this.handleTransactionError(r)})}))}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);return Uo(t)||!t.catch||!t.then?(this.deferred.reject(Error("Transaction callback must return a Promise")),null):t}catch(t){return this.deferred.reject(t),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!MC(t)}return!1}};var qr="FirestoreClient",Mq=100,Pq=11,Lq=20,Fq=22,jg=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=ze.UNAUTHENTICATED,this.clientId=cu.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>_(this,null,function*(){x(qr,"Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(x(qr,"Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:Mq}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new N(C.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Me;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>_(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=ua(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function ou(n,e){return _(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),x(qr,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>_(this,null,function*(){r.isEqual(i)||(yield s0(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Kg(n,e){return _(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield Vy(n);x(qr,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Sb(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Sb(e.remoteStore,i)),n._onlineComponents=e})}function R0(n){return n.name==="FirebaseError"?n.code===C.FAILED_PRECONDITION||n.code===C.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===Fq||n.code===Lq||n.code===Pq:!0}function Vy(n){return _(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){x(qr,"Using user provided OfflineComponentProvider");try{yield ou(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!R0(t))throw t;qt("Error using user provided cache. Falling back to memory cache: "+t),yield ou(n,new xo)}}else x(qr,"Using default OfflineComponentProvider"),yield ou(n,new xo);return n._offlineComponents})}function fd(n){return _(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(x(qr,"Using user provided OnlineComponentProvider"),yield Kg(n,n._uninitializedComponentsProvider._online)):(x(qr,"Using default OnlineComponentProvider"),yield Kg(n,new Mo))),n._onlineComponents})}function D0(n){return Vy(n).then(e=>e.persistence)}function zy(n){return Vy(n).then(e=>e.localStore)}function N0(n){return fd(n).then(e=>e.remoteStore)}function Gy(n){return fd(n).then(e=>e.syncEngine)}function Bq(n){return fd(n).then(e=>e.datastore)}function Zs(n){return _(this,null,function*(){let e=yield fd(n),t=e.eventManager;return t.onListen=rq.bind(null,e.syncEngine),t.onUnlisten=sq.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=iq.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=aq.bind(null,e.syncEngine),t})}function qq(n){return n.asyncQueue.enqueue(()=>_(this,null,function*(){let e=yield D0(n),t=yield N0(n);return e.setNetworkEnabled(!0),NB(t)}))}function Uq(n){return n.asyncQueue.enqueue(()=>_(this,null,function*(){let e=yield D0(n),t=yield N0(n);return e.setNetworkEnabled(!1),OB(t)}))}function Vq(n){let e=new Me;return n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let t=yield Gy(n);return dq(t,e)})),e.promise}function zq(n,e,t,r){let i=new Xs(r),s=new ko(e,i,t);return n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let a=yield Zs(n);return Ny(a,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let a=yield Zs(n);return Oy(a,s)}))}}function Gq(n,e){let t=new Me;return n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let r=yield zy(n);return Hq(r,e,t)})),t.promise}function O0(n,e,t={}){let r=new Me;return n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let i=yield Zs(n);return Qq(i,n.asyncQueue,e,t,r)})),r.promise}function jq(n,e){let t=new Me;return n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let r=yield zy(n);return Yq(r,e,t)})),t.promise}function k0(n,e,t={}){let r=new Me;return n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let i=yield Zs(n);return Jq(i,n.asyncQueue,e,t,r)})),r.promise}function Kq(n,e){let t=new Me;return n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let r=yield Gy(n);return oq(r,e,t)})),t.promise}function Wq(n,e){let t=new Xs(e);return n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let r=yield Zs(n);return XB(r,t)})),()=>{t.mute(),n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let r=yield Zs(n);return ZB(r,t)}))}}function $q(n,e,t){let r=new Me;return n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){let i=yield Bq(n);new Gg(n.asyncQueue,i,t,e,r).run()})),r.promise}function Hq(n,e,t){return _(this,null,function*(){try{let r=yield B2(n,e);r.isFoundDocument()?t.resolve(r):r.isNoDocument()?t.resolve(null):t.reject(new N(C.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let i=ua(r,`Failed to get document '${e} from cache`);t.reject(i)}})}function Qq(n,e,t,r,i){let s=new Xs({next:o=>{e.enqueueAndForget(()=>Oy(n,a));let l=o.docs.has(t);!l&&o.fromCache?i.reject(new N(C.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&o.fromCache&&r&&r.source==="server"?i.reject(new N(C.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:o=>i.reject(o)}),a=new ko(sa(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return Ny(n,a)}function Yq(n,e,t){return _(this,null,function*(){try{let r=yield ud(n,e,!0),i=new Gu(e,r.remoteKeys),s=i.computeDocChanges(r.documents),a=i.applyChanges(s,!1);t.resolve(a.snapshot)}catch(r){let i=ua(r,`Failed to execute query '${e} against cache`);t.reject(i)}})}function Jq(n,e,t,r,i){let s=new Xs({next:o=>{e.enqueueAndForget(()=>Oy(n,a)),o.fromCache&&r.source==="server"?i.reject(new N(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(o)},error:o=>i.reject(o)}),a=new ko(t,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return Ny(n,a)}function Xq(n,e,t,r){let i=eU(t,Ko(e));n.asyncQueue.enqueueAndForget(()=>_(this,null,function*(){Iq(yield Gy(n),i,r)}))}function Zq(n,e){return n.asyncQueue.enqueue(()=>_(this,null,function*(){return H2(yield zy(n),e)}))}function eU(n,e){let t;return typeof n=="string"?t=PC().encode(n):t=n,xq(kq(t),e)}function tU(n,e){return n.timeoutSeconds===e.timeoutSeconds}function x0(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var nU="ComponentProvider",bb=new Map;function rU(n){let e=bb.get(n);e&&(x(nU,"Removing Datastore"),bb.delete(n),e.terminate())}function iU(n,e,t,r){return new Cm(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,x0(r.experimentalLongPollingOptions),r.useFetchStreams)}var M0="firestore.googleapis.com",Cb=!0,Ib=5,Ab=30,sU=!0,Ku=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new N(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=M0,this.ssl=Cb}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:Cb;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=t0;else{if(e.cacheSizeBytes!==jo&&e.cacheSizeBytes<lb)throw new N(C.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${lb}`);this.cacheSizeBytes=e.cacheSizeBytes}Uy("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=sU:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=x0((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),aU(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&tU(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function aU(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new N(C.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<Ib)throw new N(C.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${Ib})`);if(n.timeoutSeconds>Ab)throw new N(C.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${Ab})`)}}var _i=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ku({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new N(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new N(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ku(e),e.credentials!==void 0&&(this._authCredentials=nM(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return rU(this),Promise.resolve()}};function jy(n,e,t,r={}){var i;n=ie(n,_i);let s=n._getSettings(),a=`${e}:${t}`;if(s.host!==M0&&s.host!==a&&qt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let o,l;if(typeof r.mockUserToken=="string")o=r.mockUserToken,l=ze.MOCK_USER;else{o=wv(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new N(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new ze(c)}n._authCredentials=new cm(new lu(o,l))}}var Ze=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},ye=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Cn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Cn=class n extends Ze{constructor(e,t,r){super(e,t,sa(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ye(this.firestore,null,new F(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function Ky(n,e,...t){if(n=Ae(n),qy("collection","path",e),n instanceof _i){let r=re.fromString(e,...t);return Eb(r),new Cn(n,null,r)}else{if(!(n instanceof ye)&&!(n instanceof Cn))throw new N(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(re.fromString(e,...t));return Eb(r),new Cn(n.firestore,null,r)}}function P0(n,e){if(n=ie(n,_i),qy("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new N(C.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ze(n,null,BP(e))}function Ho(n,e,...t){if(n=Ae(n),arguments.length===1&&(e=cu.newId()),qy("doc","path",e),n instanceof _i){let r=re.fromString(e,...t);return _b(r),new ye(n,null,new F(r))}else{if(!(n instanceof ye)&&!(n instanceof Cn))throw new N(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(re.fromString(e,...t));return _b(r),new ye(n.firestore,n instanceof Cn?n.converter:null,new F(r))}}function Wy(n,e){return n=Ae(n),e=Ae(e),(n instanceof ye||n instanceof Cn)&&(e instanceof ye||e instanceof Cn)?n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter:!1}function $y(n,e){return n=Ae(n),e=Ae(e),n instanceof Ze&&e instanceof Ze?n.firestore===e.firestore&&zo(n._query,e._query)&&n.converter===e.converter:!1}var oU="AsyncQueue",Wg=class{constructor(){this.tail=Promise.resolve(),this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new Oo(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()}}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new Me;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return _(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(zr(e))x(oU,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=cU(r);throw be("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=Og.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&V()}verifyOperationInProgress(){}drain(){return _(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function lU(){return new Wg}function cU(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var $g=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Me,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var L0=jo,_e=class extends _i{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=lU(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||F0(this),this._firestoreClient.terminate()}};function c3(n,e){let t=typeof n=="object"?n:Rv(),r=typeof n=="string"?n:e||Im,i=Iv(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=Tv("firestore");s&&jy(i,...s)}return i}function je(n){return n._firestoreClient||F0(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function F0(n){var e,t,r;let i=n._freezeSettings(),s=iU(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new jg(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function B0(n,e){n=ie(n,_e),$0(n);let t=je(n);if(t._uninitializedComponentsProvider)throw new N(C.FAILED_PRECONDITION,"SDK cache is already specified.");qt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new Mo,s=new ju(i,r.cacheSizeBytes,e?.forceOwnership);return U0(t,i,s)}function q0(n){n=ie(n,_e),$0(n);let e=je(n);if(e._uninitializedComponentsProvider)throw new N(C.FAILED_PRECONDITION,"SDK cache is already specified.");qt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new Mo,i=new qg(r,t.cacheSizeBytes);return U0(e,r,i)}function U0(n,e,t){let r=new Me;return n.asyncQueue.enqueue(()=>_(this,null,function*(){try{yield ou(n,t),yield Kg(n,e),r.resolve()}catch(i){let s=i;if(!R0(s))throw s;qt("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function V0(n){if(n._initialized&&!n._terminated)throw new N(C.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Me;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>_(this,null,function*(){try{yield A2(Cy(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function z0(n){n=ie(n,_e);let e=je(n);return Vq(e)}function G0(n){n=ie(n,_e);let e=je(n);return qq(e)}function j0(n){n=ie(n,_e);let e=je(n);return Uq(e)}function K0(n,e){n=ie(n,_e);let t=je(n),r=new $g;return Xq(t,n._databaseId,e,r),r}function W0(n,e){n=ie(n,_e);let t=je(n);return Zq(t,e).then(r=>r?new Ze(n,null,r.query):null)}function $0(n){if(n._initialized||n._terminated)throw new N(C.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}function uU(n,e=!0){eM(Av),Cv(new tl("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),a=new _e(new um(t.getProvider("auth-internal")),new pm(t.getProvider("app-check-internal")),JM(s,r),s);return i=Object.assign({useFetchStreams:e},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Od(TE,wE,n),Od(TE,wE,"esm2017")}var Rn=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ye.fromBase64String(e))}catch(t){throw new N(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ye.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var tn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new N(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Le(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Gn=class{constructor(e){this._methodName=e}};var Ei=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new N(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new N(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return J(this._lat,e._lat)||J(this._long,e._long)}};var dU=/^__.*__$/,Hg=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new en(e,this.data,this.fieldMask,t,this.fieldTransforms):new Fr(e,this.data,t,this.fieldTransforms)}},Wu=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new en(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function H0(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw V()}}var $u=class n{constructor(e,t,r,i,s,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return Hu(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(H0(this.dataSource)&&dU.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},Qg=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Ko(e)}createContext(e,t,r,i=!1){return new $u({dataSource:e,methodName:t,targetDoc:r,path:Le.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Ri(n){let e=n._freezeSettings(),t=Ko(n._databaseId);return new Qg(n._databaseId,!!e.ignoreUndefinedProperties,t)}function pd(n,e,t,r,i,s={}){let a=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);Yy("Data must be an object, but it was:",a,r);let o=J0(r,a),l,c;if(s.merge)l=new Ct(a.fieldMask),c=a.fieldTransforms;else if(s.mergeFields){let u=[];for(let d of s.mergeFields){let f=ey(e,d,t);if(!a.contains(f))throw new N(C.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);Z0(u,f)||u.push(f)}l=new Ct(u),c=a.fieldTransforms.filter(d=>l.covers(d.field))}else l=null,c=a.fieldTransforms;return new Hg(new st(o),l,c)}var Po=class n extends Gn{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function Q0(n,e,t){return new $u({dataSource:3,targetDoc:e.settings.targetDoc,methodName:n._methodName,arrayElement:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var Yg=class n extends Gn{_toFieldTransform(e){return new vi(e.path,new Pr)}isEqual(e){return e instanceof n}},Jg=class n extends Gn{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=Q0(this,e,!0),r=this._elements.map(s=>Di(s,t)),i=new Vn(r);return new vi(e.path,i)}isEqual(e){return e instanceof n&&Nd(this._elements,e._elements)}},Xg=class n extends Gn{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=Q0(this,e,!0),r=this._elements.map(s=>Di(s,t)),i=new zn(r);return new vi(e.path,i)}isEqual(e){return e instanceof n&&Nd(this._elements,e._elements)}},Zg=class n extends Gn{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new Lr(e.serializer,CC(e.serializer,this._operand));return new vi(e.path,t)}isEqual(e){return e instanceof n&&this._operand===e._operand}};function Hy(n,e,t,r){let i=n.createContext(1,e,t);Yy("Data must be an object, but it was:",i,r);let s=[],a=st.empty();Ai(r,(l,c)=>{let u=Jy(e,l,t);c=Ae(c);let d=i.childContextForFieldPath(u);if(c instanceof Po)s.push(u);else{let f=Di(c,d);f!=null&&(s.push(u),a.set(u,f))}});let o=new Ct(s);return new Wu(a,o,i.fieldTransforms)}function Qy(n,e,t,r,i,s){let a=n.createContext(1,e,t),o=[ey(e,r,t)],l=[i];if(s.length%2!==0)throw new N(C.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<s.length;f+=2)o.push(ey(e,s[f])),l.push(s[f+1]);let c=[],u=st.empty();for(let f=o.length-1;f>=0;--f)if(!Z0(c,o[f])){let v=o[f],b=l[f];b=Ae(b);let I=a.childContextForFieldPath(v);if(b instanceof Po)c.push(v);else{let A=Di(b,I);A!=null&&(c.push(v),u.set(v,A))}}let d=new Ct(c);return new Wu(u,d,a.fieldTransforms)}function Y0(n,e,t,r=!1){let i=n.createContext(r?4:3,e);return Di(t,i)}function Di(n,e){if(n=Ae(n),X0(n))return Yy("Unsupported field value:",e,n),J0(n,e);if(n instanceof Gn)return fU(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return hU(n,e)}else return pU(n,e)}function J0(n,e){let t={};return Xb(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ai(n,(r,i)=>{let s=Di(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function hU(n,e){let t=[],r=0;for(let i of n){let s=Di(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function fU(n,e){if(!H0(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function pU(n,e){if(n=Ae(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return CC(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=Ce.fromDate(n);return{timestampValue:Ks(e.serializer,t)}}else if(n instanceof Ce){let t=new Ce(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:Ks(e.serializer,t)}}else{if(n instanceof Ei)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Rn)return{bytesValue:LC(e.serializer,n._byteString)};if(n instanceof ye){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:Ty(n.firestore._databaseId||e.databaseId,n._key.path)}}else throw e.createError(`Unsupported field value: ${$o(n)}`)}}function X0(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof Ce)&&!(n instanceof Ei)&&!(n instanceof Rn)&&!(n instanceof ye)&&!(n instanceof Gn)}function Yy(n,e,t){if(!X0(t)||!Nq(t)){let r=$o(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function ey(n,e,t){if(e=Ae(e),e instanceof tn)return e._internalPath;if(typeof e=="string")return Jy(n,e);throw Hu("Field path arguments must be of type string or ",n,!1,void 0,t)}var mU=new RegExp("[~\\*/\\[\\]]");function Jy(n,e,t){if(e.search(mU)>=0)throw Hu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new tn(...e.split("."))._internalPath}catch{throw Hu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Hu(n,e,t,r,i){let s=r&&!r.isEmpty(),a=i!==void 0,o=`Function ${e}() called with invalid data`;t&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new N(C.INVALID_ARGUMENT,o+n+l)}function Z0(n,e){return n.some(t=>t.isEqual(e))}var bi=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ye(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new ty(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(md("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},ty=class extends bi{data(){return super.data()}};function md(n,e){return typeof e=="string"?Jy(n,e):e instanceof tn?e._internalPath:e._delegate._internalPath}function eI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new N(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Lo=class{},Ci=class extends Lo{};function $n(n,e,...t){let r=[];e instanceof Lo&&r.push(e),r=r.concat(t),EU(r);for(let i of r)n=i._apply(n);return n}var Qu=class n extends Ci{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return uI(e._query,t),new Ze(e.firestore,e.converter,vy(e._query,t))}_parse(e){let t=Ri(e.firestore);return gU(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function tI(n,e,t){let r=e,i=md("where",n);return Qu._create(i,r,t)}var ny=class n extends Lo{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ue.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(wU(e._query,t),new Ze(e.firestore,e.converter,vy(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var ry=class n extends Ci{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=yU(e._query,this._field,this._direction);return new Ze(e.firestore,e.converter,VP(e._query,t))}};function nI(n,e="asc"){let t=e,r=md("orderBy",n);return ry._create(r,t)}var Yu=class n extends Ci{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new Ze(e.firestore,e.converter,vu(e._query,this._limit,this._limitType))}};function rI(n){return A0("limit",n),Yu._create("limit",n,"F")}function iI(n){return A0("limitToLast",n),Yu._create("limitToLast",n,"L")}var Ju=class n extends Ci{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=cI(e,this.type,this._docOrFields,this._inclusive);return new Ze(e.firestore,e.converter,zP(e._query,t))}};function sI(...n){return Ju._create("startAt",n,!0)}function aI(...n){return Ju._create("startAfter",n,!1)}var Xu=class n extends Ci{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=cI(e,this.type,this._docOrFields,this._inclusive);return new Ze(e.firestore,e.converter,GP(e._query,t))}};function oI(...n){return Xu._create("endBefore",n,!1)}function lI(...n){return Xu._create("endAt",n,!0)}function cI(n,e,t,r){if(t[0]=Ae(t[0]),t[0]instanceof bi)return vU(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Ri(n.firestore);return SU(n._query,n.firestore._databaseId,i,e,t,r)}}function gU(n,e,t,r,i,s,a){let o;if(i.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new N(C.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){Db(a,s);let c=[];for(let u of a)c.push(Rb(r,n,u));o={arrayValue:{values:c}}}else o=Rb(r,n,a)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&Db(a,s),o=Y0(t,e,a,s==="in"||s==="not-in");return te.create(i,s,o)}function yU(n,e,t){if(n.startAt!==null)throw new N(C.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new N(C.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new gi(e,t)}function vU(n,e,t,r,i){if(!r)throw new N(C.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${t}().`);let s=[];for(let a of zs(n))if(a.field.isKeyField())s.push(mi(e,r.key));else{let o=r.data.field(a.field);if(ad(o))throw new N(C.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(o!==null)s.push(o);else{let l=a.field.canonicalString();throw new N(C.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${l}' (used as the orderBy) does not exist.`)}}return new In(s,i)}function SU(n,e,t,r,i,s){let a=n.explicitOrderBy;if(i.length>a.length)throw new N(C.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let l=0;l<i.length;l++){let c=i[l];if(a[l].field.isKeyField()){if(typeof c!="string")throw new N(C.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!yy(n)&&c.indexOf("/")!==-1)throw new N(C.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);let d=n.path.child(re.fromString(c));if(!F.isDocumentKey(d))throw new N(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${d}' is not because it contains an odd number of segments.`);let f=new F(d);o.push(mi(e,f))}else{let d=Y0(t,r,c);o.push(d)}}return new In(o,s)}function Rb(n,e,t){if(t=Ae(t),typeof t=="string"){if(t==="")throw new N(C.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!yy(e)&&t.indexOf("/")!==-1)throw new N(C.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(re.fromString(t));if(!F.isDocumentKey(r))throw new N(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return mi(n,new F(r))}else{if(t instanceof ye)return mi(n,t._key);throw new N(C.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${$o(t)}.`)}}function Db(n,e){if(!Array.isArray(n)||n.length===0)throw new N(C.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function TU(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function uI(n,e){let t=_U(n.filters,TU(e.op));if(t!==null)throw t===e.op?new N(C.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new N(C.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function wU(n,e){let t=n,r=e.getFlattenedFilters();for(let i of r)uI(t,i),t=vy(t,i)}function _U(n,e){for(let t of n)for(let r of t.getFlattenedFilters())if(e.indexOf(r.op)>=0)return r.op;return null}function EU(n){let e=n.filter(r=>r instanceof ny).length,t=n.filter(r=>r instanceof Qu).length;if(e>1||e>0&&t>0)throw new N(C.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}var ea=class{convertValue(e,t="none"){switch(pi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ne(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(kr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw V()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Ai(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Ei(Ne(e.latitude),Ne(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=py(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(mo(e));default:return null}}convertTimestamp(e){let t=Un(e);return new Ce(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=re.fromString(e);K($C(r));let i=new xr(r.get(1),r.get(3)),s=new F(r.popFirst(5));return i.isEqual(t)||be(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function gd(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}var iy=class extends ea{constructor(e){super(),this.firestore=e}convertBytes(e){return new Rn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ye(this.firestore,null,t)}};function sy(n){return bU(n,["next","error","complete"])}function bU(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var jn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Vt=class extends bi{constructor(e,t,r,i,s,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new Ur(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(md("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Ur=class extends Vt{data(e={}){return super.data(e)}},nn=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new jn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Ur(this._firestore,this._userDataWriter,r.key,r,new jn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new N(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=CU(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function CU(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new Ur(n._firestore,n._userDataWriter,r.doc.key,r.doc,new jn(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new Ur(n._firestore,n._userDataWriter,r.doc.key,r.doc,new jn(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,a=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),a=t.indexOf(r.doc.key)),{type:IU(r.type),doc:i,oldIndex:s,newIndex:a}})}}function IU(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return V()}}function Xy(n,e){return n instanceof Vt&&e instanceof Vt?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof nn&&e instanceof nn?n._firestore===e._firestore&&$y(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot):!1}function dI(n){n=ie(n,ye);let e=ie(n.firestore,_e),t=je(e);return O0(t,n._key).then(r=>nv(e,n,r))}var Kn=class extends ea{constructor(e){super(),this.firestore=e}convertBytes(e){return new Rn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ye(this.firestore,null,t)}};function hI(n){n=ie(n,ye);let e=ie(n.firestore,_e),t=je(e),r=new Kn(e);return Gq(t,n._key).then(i=>new Vt(e,r,n._key,i,new jn(i!==null&&i.hasLocalMutations,!0),n.converter))}function fI(n){n=ie(n,ye);let e=ie(n.firestore,_e),t=je(e);return O0(t,n._key,{source:"server"}).then(r=>nv(e,n,r))}function pI(n){n=ie(n,Ze);let e=ie(n.firestore,_e),t=je(e),r=new Kn(e);return eI(n._query),k0(t,n._query).then(i=>new nn(e,r,n,i))}function mI(n){n=ie(n,Ze);let e=ie(n.firestore,_e),t=je(e),r=new Kn(e);return jq(t,n._query).then(i=>new nn(e,r,n,i))}function gI(n){n=ie(n,Ze);let e=ie(n.firestore,_e),t=je(e),r=new Kn(e);return k0(t,n._query,{source:"server"}).then(i=>new nn(e,r,n,i))}function Zy(n,e,t){n=ie(n,ye);let r=ie(n.firestore,_e),i=gd(n.converter,e,t),s=Ri(r),o=pd(s,"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,De.none());return da(r,[o])}function ev(n,e,t,...r){n=ie(n,ye);let i=ie(n.firestore,_e),s=Ri(i);e=Ae(e);let a;typeof e=="string"||e instanceof tn?a=Qy(s,"updateDoc",n._key,e,t,r):a=Hy(s,"updateDoc",n._key,e);let o=a.toMutation(n._key,De.exists(!0));return da(i,[o])}function yI(n){let e=ie(n.firestore,_e),t=[new Br(n._key,De.none())];return da(e,t)}function vI(n,e){let t=ie(n.firestore,_e),r=Ho(n),i=gd(n.converter,e),s=Ri(n.firestore),o=pd(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,De.exists(!1));return da(t,[o]).then(()=>r)}function tv(n,...e){var t,r,i;n=Ae(n);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]=="object"&&!sy(e[a])&&(s=e[a],a++);let o={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(sy(e[a])){let f=e[a];e[a]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[a+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[a+2]=(i=f.complete)===null||i===void 0?void 0:i.bind(f)}let l,c,u;if(n instanceof ye)c=ie(n.firestore,_e),u=sa(n._key.path),l={next:f=>{e[a]&&e[a](nv(c,n,f))},error:e[a+1],complete:e[a+2]};else{let f=ie(n,Ze);c=ie(f.firestore,_e),u=f._query;let v=new Kn(c);l={next:b=>{e[a]&&e[a](new nn(c,v,f,b))},error:e[a+1],complete:e[a+2]},eI(n._query)}let d=je(c);return zq(d,u,o,l)}function SI(n,e){n=ie(n,_e);let t=je(n),r=sy(e)?e:{next:e};return Wq(t,r)}function da(n,e){let t=je(n);return Kq(t,e)}function nv(n,e,t){let r=t.docs.get(e._key),i=new Kn(n);return new Vt(n,i,e._key,r,new jn(t.hasPendingWrites,t.fromCache),e.converter)}var AU={maxAttempts:5};function RU(n){if(n.maxAttempts<1)throw new N(C.INVALID_ARGUMENT,"Max attempts must be at least 1")}var Zu=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ri(e)}set(e,t,r){this._verifyNotCommitted();let i=Rr(e,this._firestore),s=gd(i.converter,t,r),a=pd(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(a.toMutation(i._key,De.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Rr(e,this._firestore);t=Ae(t);let a;return typeof t=="string"||t instanceof tn?a=Qy(this._dataReader,"WriteBatch.update",s._key,t,r,i):a=Hy(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,De.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Rr(e,this._firestore);return this._mutations=this._mutations.concat(new Br(t._key,De.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new N(C.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Rr(n,e){if(n=Ae(n),n.firestore!==e)throw new N(C.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var ay=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Ri(e)}get(e){let t=Rr(e,this._firestore),r=new iy(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return V();let s=i[0];if(s.isFoundDocument())return new bi(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new bi(this._firestore,r,t._key,null,t.converter);throw V()})}set(e,t,r){let i=Rr(e,this._firestore),s=gd(i.converter,t,r),a=pd(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,a),this}update(e,t,r,...i){let s=Rr(e,this._firestore);t=Ae(t);let a;return typeof t=="string"||t instanceof tn?a=Qy(this._dataReader,"Transaction.update",s._key,t,r,i):a=Hy(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,a),this}delete(e){let t=Rr(e,this._firestore);return this._transaction.delete(t._key),this}};var oy=class extends ay{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Rr(e,this._firestore),r=new Kn(this._firestore);return super.get(e).then(i=>new Vt(this._firestore,r,t._key,i._document,new jn(!1,!1),t.converter))}};function TI(n,e,t){n=ie(n,_e);let r=Object.assign(Object.assign({},AU),t);RU(r);let i=je(n);return $q(i,s=>e(new oy(n,s)),r)}function wI(){return new Po("deleteField")}function _I(){return new Yg("serverTimestamp")}function EI(...n){return new Jg("arrayUnion",n)}function bI(...n){return new Xg("arrayRemove",n)}function CI(n){return new Zg("increment",n)}uU("node");var DU="@firebase/firestore-compat",NU="0.3.31";function lv(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new N("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function II(){if(typeof Uint8Array>"u")throw new N("unimplemented","Uint8Arrays are not available in this environment.")}function AI(){if(!Zb())throw new N("unimplemented","Blobs are unavailable in Firestore in this environment.")}var yd=class n{constructor(e){this._delegate=e}static fromBase64String(e){return AI(),new n(Rn.fromBase64String(e))}static fromUint8Array(e){return II(),new n(Rn.fromUint8Array(e))}toBase64(){return AI(),this._delegate.toBase64()}toUint8Array(){return II(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function rv(n){return OU(n,["next","error","complete"])}function OU(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var iv=class{enableIndexedDbPersistence(e,t){return B0(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return q0(e._delegate)}clearIndexedDbPersistence(e){return V0(e._delegate)}},vd=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof xr||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&qt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){jy(this._delegate,e,t,r)}enableNetwork(){return G0(this._delegate)}disableNetwork(){return j0(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,Uy("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return z0(this._delegate)}onSnapshotsInSync(e){return SI(this._delegate,e)}get app(){if(!this._appCompat)throw new N("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new pa(this,Ky(this._delegate,e))}catch(t){throw pt(t,"collection()","Firestore.collection()")}}doc(e){try{return new Dn(this,Ho(this._delegate,e))}catch(t){throw pt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new xi(this,P0(this._delegate,e))}catch(t){throw pt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return TI(this._delegate,t=>e(new Sd(this,t)))}batch(){return je(this._delegate),new Td(new Zu(this._delegate,e=>da(this._delegate,e)))}loadBundle(e){return K0(this._delegate,e)}namedQuery(e){return W0(this._delegate,e).then(t=>t?new xi(this,t):null)}},ha=class extends ea{constructor(e){super(),this.firestore=e}convertBytes(e){return new yd(new Rn(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Dn.forKey(t,this.firestore,null)}};function kU(n){Ob(n)}var Sd=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new ha(e)}get(e){let t=Ni(e);return this._delegate.get(t).then(r=>new Oi(this._firestore,new Vt(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=Ni(e);return r?(lv("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Ni(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Ni(e);return this._delegate.delete(t),this}},Td=class{constructor(e){this._delegate=e}set(e,t,r){let i=Ni(e);return r?(lv("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Ni(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Ni(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},fa=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new Ur(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new ki(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new ha(e),t),i.set(t,s)),s}};fa.INSTANCES=new WeakMap;var Dn=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ha(e)}static forPath(e,t,r){if(e.length%2!==0)throw new N("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new ye(t._delegate,r,new F(e)))}static forKey(e,t,r){return new n(t,new ye(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new pa(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new pa(this.firestore,Ky(this._delegate,e))}catch(t){throw pt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=Ae(e),e instanceof ye?Wy(this._delegate,e):!1}set(e,t){t=lv("DocumentReference.set",t);try{return t?Zy(this._delegate,e,t):Zy(this._delegate,e)}catch(r){throw pt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?ev(this._delegate,e):ev(this._delegate,e,t,...r)}catch(i){throw pt(i,"updateDoc()","DocumentReference.update()")}}delete(){return yI(this._delegate)}onSnapshot(...e){let t=RI(e),r=DI(e,i=>new Oi(this.firestore,new Vt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return tv(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=hI(this._delegate):e?.source==="server"?t=fI(this._delegate):t=dI(this._delegate),t.then(r=>new Oi(this.firestore,new Vt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(fa.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function pt(n,e,t){return n.message=n.message.replace(e,t),n}function RI(n){for(let e of n)if(typeof e=="object"&&!rv(e))return e;return{}}function DI(n,e){var t,r;let i;return rv(n[0])?i=n[0]:rv(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Oi=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Dn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Xy(this._delegate,e._delegate)}},ki=class extends Oi{data(e){let t=this._delegate.data(e);return this._delegate._converter||kb(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},xi=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ha(e)}where(e,t,r){try{return new n(this.firestore,$n(this._delegate,tI(e,t,r)))}catch(i){throw pt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,$n(this._delegate,nI(e,t)))}catch(r){throw pt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,$n(this._delegate,rI(e)))}catch(t){throw pt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,$n(this._delegate,iI(e)))}catch(t){throw pt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,$n(this._delegate,sI(...e)))}catch(t){throw pt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,$n(this._delegate,aI(...e)))}catch(t){throw pt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,$n(this._delegate,oI(...e)))}catch(t){throw pt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,$n(this._delegate,lI(...e)))}catch(t){throw pt(t,"endAt()","Query.endAt()")}}isEqual(e){return $y(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=mI(this._delegate):e?.source==="server"?t=gI(this._delegate):t=pI(this._delegate),t.then(r=>new Qo(this.firestore,new nn(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=RI(e),r=DI(e,i=>new Qo(this.firestore,new nn(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return tv(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(fa.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},sv=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new ki(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Qo=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new xi(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new ki(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new sv(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new ki(this._firestore,r))})}isEqual(e){return Xy(this._delegate,e._delegate)}},pa=class n extends xi{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Dn(this.firestore,e):null}doc(e){try{return e===void 0?new Dn(this.firestore,Ho(this._delegate)):new Dn(this.firestore,Ho(this._delegate,e))}catch(t){throw pt(t,"doc()","CollectionReference.doc()")}}add(e){return vI(this._delegate,e).then(t=>new Dn(this.firestore,t))}isEqual(e){return Wy(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(fa.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Ni(n){return ie(n,ye)}var av=class n{constructor(...e){this._delegate=new tn(...e)}static documentId(){return new n(Le.keyField().canonicalString())}isEqual(e){return e=Ae(e),e instanceof tn?this._delegate._internalPath.isEqual(e._internalPath):!1}};var ov=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=_I();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=wI();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=EI(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=bI(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=CI(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var xU={Firestore:vd,GeoPoint:Ei,Timestamp:Ce,Blob:yd,Transaction:Sd,WriteBatch:Td,DocumentReference:Dn,DocumentSnapshot:Oi,Query:xi,QueryDocumentSnapshot:ki,QuerySnapshot:Qo,CollectionReference:pa,FieldPath:av,FieldValue:ov,setLogLevel:kU,CACHE_SIZE_UNLIMITED:L0};function MU(n,e){n.INTERNAL.registerComponent(new tl("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},xU)))}function PU(n){MU(n,(e,t)=>new vd(e,t,new iv)),n.registerVersion(DU,NU,"node")}PU(kd);function LU(n,e=pv){return new fv(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function NI(n,e){return LU(n,e)}function FU(n,e){return NI(n,e).pipe(el(void 0),Xo(),zt(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function dv(n,e){return NI(n,e).pipe(zt(t=>({payload:t,type:"query"})))}var wd=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=xI(r,t);return new Ed(i,s,this.afs)}snapshotChanges(){return FU(this.ref,this.afs.schedulers.outsideAngular).pipe(It)}valueChanges(e={}){return this.snapshotChanges().pipe(zt(({payload:t})=>e.idField?Cd(Jo({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return ma(this.ref.get(e)).pipe(It)}};function _d(n,e){return dv(n,e).pipe(el(void 0),Xo(),zt(t=>{let[r,i]=t,s=i.payload.docChanges(),a=s.map(o=>({type:o.type,payload:o}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((o,l)=>{let c=s.find(d=>d.doc.ref.isEqual(o.ref)),u=r?.payload.docs.find(d=>d.ref.isEqual(o.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(o.metadata)||!c&&u&&JSON.stringify(u.metadata)===JSON.stringify(o.metadata)||a.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:o}})}),a}))}function OI(n,e,t){return _d(n,t).pipe(Zo((r,i)=>BU(r,i.map(s=>s.payload),e),[]),mv(),zt(r=>r.map(i=>({type:i.type,payload:i}))))}function BU(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=qU(n,r))}),n}function cv(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function qU(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return cv(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return cv(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return cv(n,e.oldIndex,1);break}return n}function kI(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Ed=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=_d(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(zt(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(el(void 0),Xo(),Rd(([r,i])=>i.length>0||!r),zt(([,r])=>r),It)}auditTrail(e){return this.stateChanges(e).pipe(Zo((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=kI(e);return OI(this.query,t,this.afs.schedulers.outsideAngular).pipe(It)}valueChanges(e={}){return dv(this.query,this.afs.schedulers.outsideAngular).pipe(zt(t=>t.payload.docs.map(r=>e.idField?Cd(Jo({},r.data()),{[e.idField]:r.id}):r.data())),It)}get(e){return ma(this.query.get(e)).pipe(It)}add(e){return this.ref.add(e)}doc(e){return new wd(this.ref.doc(e),this.afs)}},uv=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?_d(this.query,this.afs.schedulers.outsideAngular).pipe(It):_d(this.query,this.afs.schedulers.outsideAngular).pipe(zt(t=>t.filter(r=>e.indexOf(r.type)>-1)),Rd(t=>t.length>0),It)}auditTrail(e){return this.stateChanges(e).pipe(Zo((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=kI(e);return OI(this.query,t,this.afs.schedulers.outsideAngular).pipe(It)}valueChanges(e={}){return dv(this.query,this.afs.schedulers.outsideAngular).pipe(zt(r=>r.payload.docs.map(i=>e.idField?Jo({[e.idField]:i.id},i.data()):i.data())),It)}get(e){return ma(this.query.get(e)).pipe(It)}},UU=new ga("angularfire2.enableFirestorePersistence"),VU=new ga("angularfire2.firestore.persistenceSettings"),zU=new ga("angularfire2.firestore.settings"),GU=new ga("angularfire2.firestore.use-emulator");function xI(n,e=t=>t){return{query:e(n),ref:n}}var q3=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,a,o,l,c,u,d,f,v,b,I,A,M,D){this.schedulers=l;let B=xv(t,o,r),P=u;d&&Vv(B,o,f,b,I,A,v,M),[this.firestore,this.persistenceEnabled$]=Mv(`${B.name}.firestore`,"AngularFirestore",B.name,()=>{let j=o.runOutsideAngular(()=>B.firestore());if(s&&j.settings(s),P&&j.useEmulator(...P),i&&!Sv(a)){let Q=()=>{try{return ma(j.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(T){return typeof console<"u"&&console.warn(T),Ad(!1)}};return[j,o.runOutsideAngular(Q)]}else return[j,Ad(!1)]},[s,P,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:a}=xI(i,r),o=this.schedulers.ngZone.run(()=>s);return new Ed(o,a,this)}collectionGroup(t,r){let i=r||(a=>a),s=this.firestore.collectionGroup(t);return new uv(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new wd(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(Ke(Ov),Ke(kv,8),Ke(UU,8),Ke(zU,8),Ke(yv),Ke(vv),Ke(Nv),Ke(VU,8),Ke(GU,8),Ke(zv,8),Ke(Pv,8),Ke(Lv,8),Ke(Fv,8),Ke(Bv,8),Ke(qv,8),Ke(Uv,8),Ke(Dv,8))};static \u0275prov=gv({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();export{c3 as a,q3 as b};
